(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ee179ab0"],{"0e62":function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"app-container"},[i("div",{staticClass:"aux-card"},[i("div",{staticClass:"header"},[t._m(0),i("div",{staticClass:"dflex"},[i("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["goods-units-edit"],expression:"['goods-units-edit']"}],attrs:{type:"primary",icon:"el-icon-plus"},on:{click:t.append}},[t._v("新增单位")])],1)]),i("div",{staticClass:"padding"},[i("el-tree",{staticClass:"Unit-tree",attrs:{data:t.dataList,"icon-class":"e","node-key":"_id","default-expand-all":!1,"expand-on-click-node":!0,"highlight-current":!1,draggable:t.$hasPermission(["goods-units-edit"]),"allow-drag":t.allowDrag,"allow-drop":t.allowDrop},on:{"node-drop":t.nodeDropComplate},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.node,s=e.data;return i("div",{staticClass:"tree-node"},[i("div",{staticClass:"left-icon"},[i("i",{staticClass:"el-icon-dish"})]),t.editMode&&t.editRowId==s._id?i("div",{staticClass:"right-content dflex-s",on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.voidStop(e)}}},[i("el-input",{ref:"editInput",staticStyle:{width:"300px"},attrs:{placeholder:"填写单位名称",clearable:""},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.submitEdit(n,s)}},model:{value:t.editValue,callback:function(e){t.editValue=e},expression:"editValue"}}),i("el-button",{staticClass:"padding-lr margin-left",attrs:{type:"success",icon:"el-icon-check",round:"",size:"small"},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.submitEdit(n,s)}}},[t._v("确认")]),i("el-button",{staticClass:"padding-lr",attrs:{type:"default",icon:"el-icon-yes",round:"",size:"small"},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.cancelEdit(n,s)}}},[t._v("取消")])],1):i("div",{staticClass:"right-content dflex-b"},[i("div",[t._v(t._s(s.name))]),i("div",{staticClass:"opt-btn"},[i("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["goods-units-edit"],expression:"['goods-units-edit']"}],attrs:{type:"success",round:"",size:"small",plain:"",icon:"el-icon-edit-outline"},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.editItem(n,s)}}},[t._v("修改")]),i("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["goods-units-delete"],expression:"['goods-units-delete']"}],attrs:{type:"danger",round:"",size:"small",plain:"",icon:"el-icon-delete"},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.deleteItem(n,s)}}},[t._v("删除")])],1)])])}}])})],1)])])},s=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"left"},[i("span",{staticClass:"title"},[t._v("商品单位")]),i("span",{staticClass:"ft-xs ft-grey"},[t._v("(支持拖拽排序)")])])}],a=i("2197"),o={name:"GoodsUnits",data(){return{dataList:[],expandedKeys:[],editMode:!1,editRowId:"",editValue:""}},mounted(){this.fetchUnit()},methods:{fetchUnit(){Object(a["a"])("goods/listGoodsUnit",{},{functionName:"xunda"}).then(t=>{this.dataList=t.data,this.$store.dispatch("dictionary/setGoodsUnits",t.data||[])})},append(){const t={_id:"",name:""};this.dataList.push(t),this.editItem("",t)},editItem(t,e){this.editMode=!0,this.editValue=e.name,this.editRowId=e._id,this.$nextTick(()=>{setTimeout(()=>{this.$refs.editInput&&this.$refs.editInput.focus()},300)})},clearEdit(){this.editMode=!1,this.editValue="",this.editRowId=""},submitEdit(t,e){const i=this.editValue;if(i===e.name)return;const n={id:e._id,name:i,sort:100};Object(a["a"])("goods/saveGoodsUnit",n,{functionName:"xunda"}).then(t=>{this.fetchUnit(),this.clearEdit()})},cancelEdit(t,e){e._id||this.remove(t,e),this.clearEdit()},deleteItem(t,e){const i=()=>{Object(a["a"])("goods/deleteGoodsUnit",{id:e._id},{functionName:"xunda"}).then(i=>{this.remove(t,e)})};this.$confirm("确定要删除该商品单位？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>i())},remove(t,e){const i=t.parent,n=i.data.children||i.data,s=n.findIndex(t=>t._id===e._id);n.splice(s,1)},voidStop(){},allowDrag(t){return!!t.data._id&&!this.editMode},allowDrop(t,e,i){return"inner"!==i},nodeDropComplate(t,e,i,n){Object(a["a"])("goods/dragSortUnit",{dragId:t.data._id,dropId:e.data._id,type:i},{functionName:"xunda"}).then(t=>{this.fetchUnit(),this.$message.success("商品单位顺序调整完成")})}}},d=o,l=(i("453c"),i("2877")),r=Object(l["a"])(d,n,s,!1,null,null,null);e["default"]=r.exports},"453c":function(t,e,i){"use strict";i("e6a1")},e6a1:function(t,e,i){}}]);