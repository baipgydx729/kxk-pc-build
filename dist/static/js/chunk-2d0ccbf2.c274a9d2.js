(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0ccbf2"],{"4ef1":function(e,o,t){"use strict";t.r(o);var s=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",{staticClass:"app-container"},[t("div",{staticClass:"aux-card"},[t("div",{staticClass:"header"},[e._m(0),t("div",{staticClass:"right"},[t("el-button",{attrs:{type:"default",icon:"el-icon-tickets"},on:{click:function(o){return e.$common.closePage()}}},[e._v("取消")]),t("el-button",{attrs:{type:"primary",icon:"el-icon-document-checked"},on:{click:e.handleSave}},[e._v("保存 (Ctrl+S)")])],1)]),t("div",{staticClass:"margin-top-sm"},[t("el-form",{ref:"baseForm",attrs:{"label-width":"90px","label-align":"left",inline:!0}},[t("div",{staticClass:"dflex-s"},[t("el-form-item",{attrs:{label:"选择客户"}},[t("AuxStoreSelect",{staticStyle:{width:"300px"},on:{change:e.changeStoreSelect},model:{value:e.baseForm.store_id,callback:function(o){e.$set(e.baseForm,"store_id",o)},expression:"baseForm.store_id"}})],1),t("el-form-item",{attrs:{label:"业务日期"}},[t("el-date-picker",{staticStyle:{width:"300px"},attrs:{type:"datetime","value-format":"timestamp"},model:{value:e.baseForm.orders_date,callback:function(o){e.$set(e.baseForm,"orders_date",o)},expression:"baseForm.orders_date"}})],1)],1)])],1),t("OrdersGoodsTable",{ref:"goodsTable",on:{change:e.changeOrdersGoodsCompleted}})],1),t("el-card",{staticClass:"aux-card margin-top",attrs:{shadow:"none","body-style":{padding:"12px"}}},[t("el-form",{ref:"baseForm",attrs:{"label-width":"80px","label-align":"left",inline:!0}},[t("el-form-item",{attrs:{label:"整单优惠"}},[t("el-input",{attrs:{oninput:"value=value.match(/^\\d+(?:\\.\\d{0,2})?/)",placeholder:"整单优惠"},on:{blur:e.changeOrdersDiscountMoney},model:{value:e.baseForm.orders_discount_money,callback:function(o){e.$set(e.baseForm,"orders_discount_money",o)},expression:"baseForm.orders_discount_money"}},[t("template",{slot:"append"},[e._v("元")])],2)],1),t("el-form-item",{attrs:{label:"其他费用"}},[t("el-input",{attrs:{oninput:"value=value.match(/^\\d+(?:\\.\\d{0,2})?/)",placeholder:"其他费用"},on:{change:e.changeOrdersCompleted},model:{value:e.baseForm.orders_extend_fee,callback:function(o){e.$set(e.baseForm,"orders_extend_fee",o)},expression:"baseForm.orders_extend_fee"}},[t("template",{slot:"append"},[e._v("元")])],2)],1),t("el-form-item",{attrs:{label:"订单金额"}},[t("el-input",{attrs:{disabled:"",placeholder:"金额"},model:{value:e.baseForm.orders_total_money,callback:function(o){e.$set(e.baseForm,"orders_total_money",o)},expression:"baseForm.orders_total_money"}},[t("template",{slot:"append"},[e._v("元")])],2)],1)],1),t("div",{staticClass:"dflex-e padding-tb border-top"},[t("span",{staticClass:"padding-left"},[e._v("整单优惠："+e._s(e.baseForm.orders_discount_money))]),t("span",{staticClass:"padding-left"},[e._v("其他费用："+e._s(e.baseForm.orders_extend_fee))]),t("span",{staticClass:"padding-left"},[e._v("订单金额："+e._s(e.baseForm.orders_total_money))])])],1),t("el-card",{staticClass:"aux-card margin-top",attrs:{shadow:"none","body-style":{padding:"12px"}}},[t("div",{attrs:{slot:"header"},slot:"header"},[t("span",[e._v("订单备注")])]),t("el-input",{attrs:{type:"textarea",placeholder:"请输入内容",maxlength:"600","show-word-limit":""},model:{value:e.baseForm.orders_remark,callback:function(o){e.$set(e.baseForm,"orders_remark",o)},expression:"baseForm.orders_remark"}})],1)],1)},r=[function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",{staticClass:"left"},[t("span",{staticClass:"title"},[e._v("销售预订单")])])}],a=t("b7ac"),d=t("2051"),n=t("2197"),i={name:"SalesPrepareCreate",components:{OrdersGoodsTable:a["a"],AuxStoreSelect:d["a"]},data(){return{permission:"sales-prepare-create",ordersId:"",baseForm:{orders_date:(new Date).getTime(),orders_no:"",store_id:"",store:{_id:"",name:"",contact:"",telephone:"",sale_grade:0},orders_goods:[],sale_manid:"",orders_remark:"",create_remark:"",create_uname:"",goods_total_count:0,goods_original_money:0,goods_discount_money:0,goods_total_money:0,orders_discount_money:0,orders_extend_fee:0,orders_total_money:0}}},computed:{},mounted(){const{storeId:e,id:o,type:t}=this.$route.query||{};e&&(this.baseForm.store_id=e),o&&(this.ordersId=o,this.fetchDetail()),"copyAdd"===t&&(this.ordersId="")},methods:{fetchDetail(){Object(n["a"])("prepare/getOrders",{ordersId:this.ordersId},{functionName:"xunda"}).then(e=>{this.initOrdersData(e.data)})},initOrdersData(e){const o={};o.store_id=e.store_id,o.store=e.store,o.orders_date=e.orders_date,o.orders_no=e.orders_no,o.orders_remark=e.orders_remark,o.create_remark=e.create_remark,o.create_uname=e.create_uname,o.sale_manid=e.sale_manid||"",o.orders_total_money=(e.orders_total_money>0?e.orders_total_money/100:0).toFixed(2),o.orders_extend_fee=(e.orders_extend_fee>0?e.orders_extend_fee/100:0).toFixed(2),o.orders_discount_money=(e.orders_discount_money>0?e.orders_discount_money/100:0).toFixed(2),o.goods_total_count=e.goods_total_count||e.orders_goods_count,o.goods_original_money=e.goods_original_money>0?(e.goods_original_money/100).toFixed(2):o.ordersTotalMoney,o.goods_discount_money=e.goods_discount_money>0?(e.goods_discount_money/100).toFixed(2):0,o.goods_total_money=e.goods_total_money>0?(e.goods_total_money/100).toFixed(2):o.goodsOriginalMoney,o.orders_goods=e.orders_goods.map(e=>{const o=Object.assign({},e);return o.goods_ori_price=((e.goods_ori_price||o.goods_price)/100).toFixed(2),o.total_ori_money=((e.total_ori_money||o.total_money)/100).toFixed(2),o.total_ori_money=((e.total_ori_money||o.total_money)/100).toFixed(2),o.total_money=(e.total_money/100).toFixed(2),o.goods_price=(e.goods_price/100).toFixed(2),o}),this.$refs.goodsTable.initData(o.orders_goods),this.baseForm=o},changeStoreSelect(e){this.baseForm.store_id=e._id,this.baseForm.store={_id:e._id,name:e.name,contact:e.contact,telephone:e.telephone}},changeOrdersDiscountMoney(){this.baseForm.orders_discount_money=Math.min(this.baseForm.orders_discount_money,this.baseForm.goods_total_money),this.changeOrdersGoodsCompleted()},changeOrdersGoodsCompleted(){const{goodsTotalCount:e=0,goodsOriginalMoney:o=0,goodsDiscountMoney:t=0,goodsTotalMoney:s=0}=this.$refs.goodsTable.getSummaryData();this.baseForm.goods_total_count=e,this.baseForm.goods_original_money=o,this.baseForm.goods_discount_money=t,this.baseForm.goods_total_money=s,this.changeOrdersCompleted()},changeOrdersCompleted(){this.baseForm.orders_discount_money=(Number(this.baseForm.orders_discount_money)||0).toFixed(2),this.baseForm.orders_extend_fee=(Number(this.baseForm.orders_extend_fee)||0).toFixed(2),this.baseForm.orders_total_money=(Number(this.baseForm.goods_total_money)+Number(this.baseForm.orders_extend_fee)-Number(this.baseForm.orders_discount_money)).toFixed(2)},validateForm(){if(!this.baseForm.store_id)return void this.$message.error("请选择客户");const e=this.$refs.goodsTable.getListData();if(0!==e.length)return!0;this.$message.error("商品清单为空")},handleSave(){this.validateForm()&&this.submitForm()},async submitForm(){const e={ordersId:this.ordersId,data:this.getOrdersData()};Object(n["a"])("prepare/saveOrders",e,{functionName:"xunda"}).then(e=>{this.$message("保存成功"),setTimeout(()=>this.$router.push({name:"SalesPrepareDetail",params:{ordersId:e.data}}),300),this.$common.closePage()},e=>{this.$message.error(e.message)})},getOrdersData(){const e=Object.assign({},this.baseForm,{orders_type:1,orders_date:this.baseForm.orders_date,store_id:this.baseForm.store_id,store:this.baseForm.store,orders_remark:this.baseForm.orders_remark,orders_goods:this.getOrdersGoods(),goods_total_count:this.baseForm.goods_total_count,goods_original_money:100*this.baseForm.goods_original_money,goods_discount_money:100*this.baseForm.goods_discount_money,goods_total_money:100*this.baseForm.goods_total_money,orders_discount_money:100*this.baseForm.orders_discount_money,orders_extend_fee:100*this.baseForm.orders_extend_fee,orders_total_money:100*this.baseForm.orders_total_money});return this.ordersId||(e.orders_no="XYD"+this.$common.format(new Date,"yyyyMMddhhmmssS")),e},getOrdersGoods(){const e=this.$refs.goodsTable.getListData();return e.map(e=>{const o=Object.assign({},e,{goods_ori_price:100*e.goods_ori_price,total_ori_money:100*e.total_ori_money,goods_price:100*e.goods_price,total_money:100*e.total_money});return o})}}},_=i,m=t("2877"),l=Object(m["a"])(_,s,r,!1,null,null,null);o["default"]=l.exports}}]);