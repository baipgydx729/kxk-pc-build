(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2ac78115"],{"1e94":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"min-container"},[a("el-form",{ref:"goodsForm",attrs:{model:t.formData,rules:t.rules,"label-width":"90px"}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:17}},[a("div",{staticClass:"aux-card"},[a("div",{staticClass:"header"},[a("div",{staticClass:"left"},[a("span",{staticClass:"title"},[t._v("基本信息")])]),a("div",{staticClass:"right"},[a("el-button",{on:{click:t.resetForm}},[t._v("重置")]),a("el-button",{attrs:{loading:t.submitLoading,type:"primary",icon:"el-icon-save"},on:{click:t.submitForm}},[t._v("保存信息")])],1)]),a("div",{staticClass:"padding padding-lr-lg"},[a("el-row",{attrs:{type:"flex",align:"top"}},[a("el-form-item",{staticClass:"flex1",attrs:{label:"商品名称",prop:"name"}},[a("el-input",{style:{width:"100%"},attrs:{placeholder:"请填写商品名称",clearable:""},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1),a("div",{staticClass:"padding"}),a("el-form-item",{staticClass:"flex1",attrs:{label:"商品编号",prop:"code"}},[a("el-input",{style:{width:"100%"},attrs:{placeholder:"请填写商品编号或条码",clearable:""},model:{value:t.formData.code,callback:function(e){t.$set(t.formData,"code",e)},expression:"formData.code"}},[a("el-button",{attrs:{slot:"append"},on:{click:t.buildGoodCode},slot:"append"},[t._v("自动生成")])],1)],1)],1),a("el-row",{attrs:{type:"flex",align:"top"}},[a("el-form-item",{staticClass:"flex1",attrs:{label:"商品单位",prop:"unit"}},[t.unitMulti||t.formData.unit_list.length>1?a("div",{on:{click:function(e){return t.openMoreUnitSet(!0)}}},[a("el-input",{style:{width:"100%"},attrs:{value:t.compUintsDesc,readonly:"",placeholder:"商品单位",clearable:""}})],1):a("div",[a("el-select",{style:{width:"100%"},attrs:{placeholder:"请选择商品单位",filterable:"",clearable:""},on:{change:t.changeGoodsBaseUnit},model:{value:t.formData.unit,callback:function(e){t.$set(t.formData,"unit",e)},expression:"formData.unit"}},t._l(t.dictionary.goodsUnits,(function(t,e){return a("el-option",{key:e,attrs:{label:t.name,value:t.name}})})),1)],1),a("el-checkbox",{attrs:{label:"启用多单位",indeterminate:!1,disabled:t.formData.unit_list.length>1},on:{change:t.openMoreUnitSet},model:{value:t.unitMulti,callback:function(e){t.unitMulti=e},expression:"unitMulti"}})],1),a("div",{staticClass:"padding"}),a("el-form-item",{staticClass:"flex1",attrs:{label:"规格/属性",prop:"spec"}},[t.specMulti||t.formData.spec_list.length>0?a("div",{on:{click:function(e){return t.openMoreSpecSet(!0)}}},[a("el-input",{style:{width:"100%"},attrs:{value:t.compSpecDesc,readonly:"",placeholder:"商品单位/属性",clearable:""}})],1):a("el-input",{style:{width:"100%"},attrs:{placeholder:"请填写商品规格/属性",clearable:""},model:{value:t.formData.spec,callback:function(e){t.$set(t.formData,"spec",e)},expression:"formData.spec"}}),a("el-checkbox",{attrs:{label:"启用多规格/属性",indeterminate:!1,disabled:t.formData.spec_list.length>0},on:{change:t.openMoreSpecSet},model:{value:t.specMulti,callback:function(e){t.specMulti=e},expression:"specMulti"}})],1)],1),a("el-row",{attrs:{type:"flex",align:"top"}},[a("el-form-item",{staticClass:"flex1",attrs:{label:"商品分类",prop:"cids"}},[a("AuxCategoryPicker",{model:{value:t.formData.cids,callback:function(e){t.$set(t.formData,"cids",e)},expression:"formData.cids"}})],1),a("div",{staticClass:"padding"}),a("el-form-item",{staticClass:"flex1",attrs:{label:"启用商品",prop:"state"}},[a("el-select",{style:{width:"100%"},attrs:{placeholder:"请选择启用状态",clearable:""},model:{value:t.formData.state,callback:function(e){t.$set(t.formData,"state",e)},expression:"formData.state"}},t._l(t.$constant.BASE_STATES,(function(t,e){return a("el-option",{key:e,attrs:{label:t.name,value:t.value}})})),1)],1)],1),a("el-row",{attrs:{type:"flex",align:"top"}},[a("el-form-item",{staticClass:"flex1",attrs:{label:"备注信息",prop:"remark"}},[a("el-input",{attrs:{type:"textarea",placeholder:"请填写商品备注",rows:"2",maxlength:"300","show-word-limit":""},model:{value:t.formData.remark,callback:function(e){t.$set(t.formData,"remark",e)},expression:"formData.remark"}})],1)],1)],1)]),a("div",{staticClass:"aux-card margin-top"},[a("div",{staticClass:"header"},[a("div",{staticClass:"left"},[a("span",{staticClass:"title"},[t._v("价格设置")])])]),t._l(t.compUnitList,(function(e,s){return a("div",{key:e.unit,staticClass:"padding-bottom"},[t.compUnitList.length>1?a("div",{staticClass:"dflex padding-sm"},[a("div",{},[t._v("单位："+t._s(e.unit+(e.unit_desc||"")))]),s>0?a("div",{staticClass:"dflex margin-left-sm"},[a("el-switch",{attrs:{"active-color":"#1890FF","inactive-color":"#ccc"},on:{change:function(a){return t.changeEnablePriceSet(e)}},model:{value:e.enablePriceSet,callback:function(a){t.$set(e,"enablePriceSet",a)},expression:"item.enablePriceSet"}}),a("el-tooltip",{attrs:{effect:"dark",content:"1.开启后将按用户自定义的价格进行计价核算。2.关闭后单品价格将按基本单位价格乘以换算比例进行计价核算。",placement:"top"}},[a("span",{staticClass:"dflex margin-left-sm"},[t._v(" 开启自定义价格 "),a("i",{staticClass:"el-icon-warning-outline fs margin-left-xs"})])])],1):t._e()]):t._e(),0===s||e.enablePriceSet?a("div",[a("el-table",{ref:"unitPriceTable",refInFor:!0,staticClass:"aux-table",attrs:{data:t.getUnitPriceList(e),border:"",stripe:""}},[t.formData.spec_list.length>0?[a("el-table-column",{attrs:{width:"44",align:"center",label:"#"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.$index+1))]}}],null,!0)}),a("el-table-column",{attrs:{width:"180",align:"center",label:"单品名"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.name))]}}],null,!0)})]:t._e(),a("el-table-column",{attrs:{align:"left",label:"批发价(元)"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{staticClass:"tar",attrs:{oninput:"value=value.match(/^\\d+(?:\\.\\d{0,2})?/)",onfocus:"this.select();",placeholder:"填写批发价"},on:{blur:function(a){return t.changeUnitItemPrice(e.row,"price")}},model:{value:e.row.price,callback:function(a){t.$set(e.row,"price",a)},expression:"scope.row.price"}})]}}],null,!0)},[a("div",{staticClass:"dflex-b",attrs:{slot:"header"},slot:"header"},[a("div",{staticClass:"dflex"},[t._v("批发价(元)")]),a("el-button",{staticClass:"padding-tb-xs fwb",attrs:{type:"text"},on:{click:function(a){return t.batchPriceSet(e,"price")}}},[t._v("批量")])],1)]),a("el-table-column",{attrs:{align:"left",label:"零售价(元)"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{staticClass:"tar",attrs:{oninput:"value=value.match(/^\\d+(?:\\.\\d{0,2})?/)",onfocus:"this.select();",placeholder:"填写市场价"},on:{blur:function(a){return t.changeUnitItemPrice(e.row,"market_price")}},model:{value:e.row.market_price,callback:function(a){t.$set(e.row,"market_price",a)},expression:"scope.row.market_price"}})]}}],null,!0)},[a("div",{staticClass:"dflex-b",attrs:{slot:"header"},slot:"header"},[a("div",{staticClass:"dflex"},[t._v("零售价(元)")]),a("el-button",{staticClass:"padding-tb-xs fwb",attrs:{type:"text"},on:{click:function(a){return t.batchPriceSet(e,"market_price")}}},[t._v("批量")])],1)]),a("el-table-column",{attrs:{align:"left",label:"进货价(元)"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{staticClass:"tar",attrs:{oninput:"value=value.match(/^\\d+(?:\\.\\d{0,2})?/)",onfocus:"this.select();",placeholder:"填写进货价"},on:{blur:function(a){return t.changeUnitItemPrice(e.row,"bid_price")}},model:{value:e.row.bid_price,callback:function(a){t.$set(e.row,"bid_price",a)},expression:"scope.row.bid_price"}})]}}],null,!0)},[a("div",{staticClass:"dflex-b",attrs:{slot:"header"},slot:"header"},[a("div",{staticClass:"dflex"},[a("span",[t._v("进货价(元)")]),a("el-tooltip",{attrs:{effect:"dark",content:"用于进货时价格参考、还有商品成本核算, 仅内部可见",placement:"top"}},[a("i",{staticClass:"el-icon-warning-outline fs margin-left-xs"})])],1),a("el-button",{staticClass:"padding-tb-xs fwb",attrs:{type:"text"},on:{click:function(a){return t.batchPriceSet(e,"bid_price")}}},[t._v("批量")])],1)]),a("el-table-column",{attrs:{align:"left",label:"最低售价(元)"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{staticClass:"tar",attrs:{oninput:"value=value.match(/^\\d+(?:\\.\\d{0,2})?/)",onfocus:"this.select();",placeholder:"最低售价"},on:{blur:function(a){return t.changeUnitItemPrice(e.row,"min_price")}},model:{value:e.row.min_price,callback:function(a){t.$set(e.row,"min_price",a)},expression:"scope.row.min_price"}})]}}],null,!0)},[a("div",{staticClass:"dflex-b",attrs:{slot:"header"},slot:"header"},[a("div",{staticClass:"dflex"},[a("span",[t._v("最低售价(元)")]),a("el-tooltip",{attrs:{effect:"dark",content:"设置商品的最低销售价，当销售订单实际销售价低于最低售价时，订单将不允许保存。设置为0元时表示不限制。",placement:"top"}},[a("i",{staticClass:"el-icon-warning-outline fs margin-left-xs"})])],1),a("el-button",{staticClass:"padding-tb-xs fwb",attrs:{type:"text"},on:{click:function(a){return t.batchPriceSet(e,"min_price")}}},[t._v("批量")])],1)])],2)],1):t._e()])}))],2),a("div",{staticClass:"aux-card margin-top"},[a("div",{staticClass:"header"},[a("div",{staticClass:"left"},[a("span",{staticClass:"title"},[t._v("商品描述")])])]),a("div",{staticClass:"padding"},[a("el-input",{attrs:{type:"textarea",placeholder:"请填写商品描述",rows:"3",maxlength:"1200","show-word-limit":""},model:{value:t.formData.desc,callback:function(e){t.$set(t.formData,"desc",e)},expression:"formData.desc"}})],1)]),a("div",{staticClass:"aux-card margin-top"},[a("div",{staticClass:"header"},[a("div",{staticClass:"left dflex"},[a("span",{staticClass:"title"},[t._v("期初库存")]),a("span",{staticClass:"padding-left-sm"},[a("el-switch",{attrs:{"active-color":"#1890FF","inactive-color":"#ccc"},on:{change:t.changeEnableStockSet},model:{value:t.enableStockSet,callback:function(e){t.enableStockSet=e},expression:"enableStockSet"}}),a("span",{staticClass:"padding-left-sm"},[t._v("开启期初库存设置")])],1),a("el-tooltip",{attrs:{effect:"dark",content:"初次添加商品时，如果您的仓库中已有商品库存，录入期初库存后，可以使后续成本价、毛利等值的计算更准确",placement:"top"}},[a("i",{staticClass:"el-icon-warning-outline fs margin-left-xs"})])],1)]),t.enableStockSet?[a("div",[a("el-alert",{attrs:{title:"注：该功能仅在初次设置库存时生效，如果库存商品已存在，则本次设置的库存数据不会生效。请谨慎填写！",type:"warning","show-icon":""}})],1),a("div",{staticClass:"padding-sm dflex-b"},[a("el-button-group",t._l(t.warehouseList,(function(e){return a("el-button",{key:e._id,attrs:{size:"small",type:t.activeWarehouse==e._id?"primary":"default",plain:""},on:{click:function(a){return t.changeWarehouse(e._id)}}},[t._v(t._s(e.name))])})),1)],1),a("div",{staticClass:"padding-bottom"},[a("el-table",{ref:"stockTable",staticClass:"aux-table",attrs:{data:t.compStockList,border:"",stripe:""}},[t.formData.spec_list.length>0?[a("el-table-column",{attrs:{width:"44",align:"center",label:"#"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.$index+1))]}}],null,!1,811300409)}),a("el-table-column",{attrs:{width:"180",align:"center",label:"单品名"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.name))]}}],null,!1,1895023226)})]:t._e(),a("el-table-column",{attrs:{align:"right",label:"期初库存量"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{staticClass:"tar",attrs:{oninput:"value=value.match(/^\\d+(?:\\.\\d{0,2})?/)",onfocus:"this.select();",placeholder:"填写期初库存量"},on:{blur:function(a){return t.changeStockInput(e.row,"stock_num")}},model:{value:e.row.stock_num,callback:function(a){t.$set(e.row,"stock_num",a)},expression:"scope.row.stock_num"}})]}}],null,!1,1288143404)},[a("div",{staticClass:"dflex-b",attrs:{slot:"header"},slot:"header"},[a("div",{staticClass:"dflex"},[t._v("期初库存量")]),a("el-button",{staticClass:"padding-tb-xs fwb",attrs:{type:"text"},on:{click:function(e){return t.batchStockSet("stock_num")}}},[t._v("批量")])],1)]),a("el-table-column",{attrs:{align:"right",label:"期初成本价"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{staticClass:"tar",attrs:{oninput:"value=value.match(/^\\d+(?:\\.\\d{0,2})?/)",onfocus:"this.select();",placeholder:"填写期初成本价"},on:{blur:function(a){return t.changeStockInput(e.row,"cost_price")}},model:{value:e.row.cost_price,callback:function(a){t.$set(e.row,"cost_price",a)},expression:"scope.row.cost_price"}})]}}],null,!1,3164813539)},[a("div",{staticClass:"dflex-b",attrs:{slot:"header"},slot:"header"},[a("div",{staticClass:"dflex"},[t._v("期初成本价")]),a("el-button",{staticClass:"padding-tb-xs fwb",attrs:{type:"text"},on:{click:function(e){return t.batchStockSet("cost_price")}}},[t._v("批量")])],1)]),a("el-table-column",{attrs:{align:"right",label:"期初总金额"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{staticClass:"tar",attrs:{oninput:"value=value.match(/^\\d+(?:\\.\\d{0,2})?/)",onfocus:"this.select();",placeholder:"填写期初总金额"},on:{blur:function(a){return t.changeStockInput(e.row,"cost_amount")}},model:{value:e.row.cost_amount,callback:function(a){t.$set(e.row,"cost_amount",a)},expression:"scope.row.cost_amount"}})]}}],null,!1,4017156191)},[a("div",{staticClass:"dflex-b",attrs:{slot:"header"},slot:"header"},[a("div",{staticClass:"dflex"},[t._v("期初总金额")]),a("el-button",{staticClass:"padding-tb-xs fwb",attrs:{type:"text"},on:{click:function(e){return t.batchStockSet("cost_amount")}}},[t._v("批量")])],1)])],2)],1)]:t._e()],2)]),a("el-col",{attrs:{span:7}},[a("div",{staticClass:"aux-card"},[a("div",{staticClass:"header"},[a("div",{staticClass:"left"},[a("span",{staticClass:"title"},[t._v("辅助属性")])])]),a("div",{staticClass:"padding padding-lr-lg"},[a("el-form-item",{attrs:{label:"商品品牌",prop:"brand_id"}},[a("AuxBrandSelect",{on:{change:t.changeGoodsBrand},model:{value:t.formData.brand_id,callback:function(e){t.$set(t.formData,"brand_id",e)},expression:"formData.brand_id"}})],1),a("el-form-item",{attrs:{label:"商品重量",prop:"weight"}},[a("el-input",{style:{width:"100%"},attrs:{placeholder:"请填写商品重量",oninput:"value=value.match(/^\\d+(?:\\.\\d{0,2})?/)",clearable:""},model:{value:t.formData.weight,callback:function(e){t.$set(t.formData,"weight",t._n(e))},expression:"formData.weight"}},[a("template",{slot:"append"},[t._v("kg")])],2)],1),a("el-form-item",{attrs:{label:"保 质 期",prop:"warranty"}},[a("el-input",{style:{width:"100%"},attrs:{placeholder:"请填写商品保质期",oninput:"value=value.match(/^\\d+(?:\\.\\d{0,2})?/)",clearable:""},model:{value:t.formData.warranty,callback:function(e){t.$set(t.formData,"warranty",t._n(e))},expression:"formData.warranty"}},[a("template",{slot:"append"},[t._v("天")])],2)],1),a("el-form-item",{attrs:{label:"供 应 商",prop:"supplier_id"}},[a("AuxSupplierSelect",{on:{change:t.changeSupplier},model:{value:t.formData.supplier_id,callback:function(e){t.$set(t.formData,"supplier_id",e)},expression:"formData.supplier_id"}})],1),a("el-form-item",{attrs:{label:"生 产 商",prop:"producer"}},[a("el-input",{style:{width:"100%"},attrs:{placeholder:"请填写商品生产商",clearable:""},model:{value:t.formData.producer,callback:function(e){t.$set(t.formData,"producer",e)},expression:"formData.producer"}})],1)],1)])])],1)],1),a("GoodsMultiUnitDialog",{ref:"goodsMultiUnitDialog",on:{submit:t.submitMoreUnit}}),a("GoodsMultiSpecDialog",{ref:"goodsMultiSpecDialog",on:{submit:t.submitMoreSpec,cancel:t.cancelMoreSpec}})],1)},i=[],n=a("2f62"),l=a("2197"),o=a("e5bb"),r=a("e177"),c=a.n(r),u=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{staticClass:"unit-box-dialog",attrs:{title:"多单位设置",visible:t.visible,width:"30%"},on:{"update:visible":function(e){t.visible=e}}},[a("div",[a("el-alert",{attrs:{title:"注：辅助单位被业务单据引用后，辅助单位名称及换算关系将不允许修改",type:"success","show-icon":""}})],1),a("el-form",{ref:"unitForm",attrs:{model:t.formData,"label-width":"100px",size:"small"}},[a("div",{staticClass:"padding"},[a("el-form-item",{attrs:{label:"基本单位",prop:"baseUnit",rules:{required:!0,message:"请选择默认单位",trigger:["blur","change"]}}},[a("el-select",{attrs:{placeholder:"选择基本单位",clearable:""},model:{value:t.formData.baseUnit,callback:function(e){t.$set(t.formData,"baseUnit",e)},expression:"formData.baseUnit"}},t._l(t.compUnits,(function(t){return a("el-option",{key:t.name,attrs:{label:t.name,value:t.name}})})),1)],1),t._l(t.formData.moreUnits,(function(e,s){return a("el-form-item",{key:e.unit,attrs:{label:"辅助单位",prop:"moreUnits."+s,rules:{required:!0,validator:t.validator,trigger:"blur"}}},[a("div",{staticClass:"dflex"},[a("el-select",{staticStyle:{width:"120px"},attrs:{placeholder:"选择单位",clearable:""},model:{value:e.unit,callback:function(a){t.$set(e,"unit",a)},expression:"item.unit"}},t._l(t.compMoreUnits,(function(t){return a("el-option",{key:t.name,attrs:{label:t.name,value:t.name,disabled:t.disabled}})})),1),a("span",{staticClass:"padding-lr-sm"},[t._v("=")]),a("el-input",{staticStyle:{width:"120px"},attrs:{placeholder:"填写数量",oninput:"value=value.match(/^\\d+(?:\\.\\d{0,2})?/)"},model:{value:e.scale,callback:function(a){t.$set(e,"scale",a)},expression:"item.scale"}},[a("template",{slot:"append"},[t._v(t._s(t.formData.baseUnit))])],2),a("el-button",{staticClass:"margin-left-sm",attrs:{size:"mini",type:"default",icon:"el-icon-delete",circle:""},on:{click:function(a){return a.preventDefault(),t.removeItem(e,s)}}})],1)])})),a("el-form-item",[a("el-button",{attrs:{icon:"el-icon-plus",disabled:t.formData.moreUnits.length>=t.limit},on:{click:t.addItem}},[t._v("新增辅助单位")])],1)],2)]),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.visible=!1}}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.submitForm("unitForm")}}},[t._v("确 定")])],1)],1)},d=[],m={name:"GoodsMultiUnitDialog",data(){return{visible:!1,limit:3,formData:{baseUnit:"",moreUnits:[]}}},computed:{...Object(n["b"])(["dictionary"]),selectUnits(){const t=this.formData.moreUnits.map(t=>t.unit);return[this.formData.baseUnit].concat(t)},compUnits(){return this.dictionary.goodsUnits},compMoreUnits(){return this.dictionary.goodsUnits.filter(t=>!this.selectUnits.includes(t.unit))}},methods:{open({baseUnit:t,unitList:e=[]}){this.formData.baseUnit=t,this.formData.moreUnits=[...e.filter(t=>1!==Number(t.scale))],this.visible=!0},addItem(){this.formData.moreUnits.length>=this.limit||this.formData.moreUnits.push({unit:"",scale:""})},removeItem(t,e){this.formData.moreUnits.splice(e,1)},validator(t,e,a){e.unit?e.scale?1!==Number(e.scale)?a():a(new Error("换算数量不能为1")):a(new Error("填写换算数量")):a(new Error("请选择辅助单位"))},submitForm(t){const e=this.formData.baseUnit,a=[{unit:this.formData.baseUnit,scale:1}];this.formData.moreUnits.forEach(t=>{t.unit_desc=`(=${t.scale}${e})`,a.push(t)});const s=a.map(t=>t.unit+(t.unit_desc||"")).join(" / ");this.$refs[t].validate(t=>{if(!t)return!1;this.visible=!1,this.$emit("submit",{baseUnit:e,unitList:a,unitDesc:s})})},resetForm(t){this.$refs[t].resetFields()}}},p=m,h=(a("b8d8"),a("2877")),f=Object(h["a"])(p,u,d,!1,null,null,null),b=f.exports,_=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-drawer",{attrs:{visible:t.visible,"show-close":!1,"with-header":!1,"wrapper-closable":!1,direction:"rtl",size:"540px"},on:{"update:visible":function(e){t.visible=e}}},[a("div",{staticClass:"padding dflex-b border-bottom"},[a("div",{staticClass:"fs fwb"},[t._v("规格/属性设置")]),a("div",{},[a("el-button",{attrs:{type:"default"},on:{click:t.handleCancel}},[t._v("取消")]),a("el-button",{staticClass:"margin-left-sm",attrs:{type:"primary"},on:{click:t.handleSubmit}},[t._v("确认提交")])],1)]),a("div",{staticClass:"padding"},[a("div",{staticClass:"padding-bottom-sm"},[a("div",{staticClass:"dflex-b"},[a("span",{staticClass:"fs-sm ft-grey"},[t._v("选择常用规格/属性")]),a("div",{},[a("el-button",{attrs:{type:"text",size:"sm"},on:{click:function(e){return t.$common.toPage("/goods/goods-props")}}},[t._v("管理属性")])],1)]),a("div",{staticClass:"padding-tb-sm dflex"},t._l(t.dictionary.goodsProps,(function(e,s){return a("div",{key:s,staticClass:"margin-right-sm",on:{click:function(a){return t.addConstSpec(e)}}},[a("el-button",{staticClass:"ft-grey"},[t._v(t._s(e.name))])],1)})),0)]),a("div",{},[a("div",{staticClass:"dflex-b padding-tb-sm"},[a("span",{staticClass:"fs-sm ft-grey"},[t._v("自定义规格/属性")])]),t._l(t.specList,(function(e,s){return a("div",{key:s},[a("AuxGoodsPropsBox",{on:{remove:function(a){return t.removeSpecItem(e,s)}},model:{value:t.specList[s],callback:function(e){t.$set(t.specList,s,e)},expression:"specList[index]"}})],1)})),t.specList.length<3?a("el-button",{staticClass:"au-icon-add",attrs:{type:"primary",plain:""},on:{click:t.addNewSpec}},[t._v("添加新规格/属性")]):t._e()],2)])])},g=[],v=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"aux-goods-spec-box margin-bottom"},[a("div",{staticClass:"dflex-b border-bottom"},[a("div",{staticClass:"dflex padding-lr"},[a("span",{staticClass:"padding-tb-sm fwb fs"},[t._v(t._s(t.formData.name||"属性名称"))]),a("span",{staticClass:"padding-sm el-icon-edit fs-lg ft-primary",on:{click:t.editName}})]),a("div",{staticClass:"padding",on:{click:function(e){return t.$emit("remove")}}},[a("span",{staticClass:"el-icon-delete fs-lg"})])]),t.formData.values.length>0?a("div",{staticClass:"padding flex-box",staticStyle:{"padding-bottom":"0"}},t._l(t.formData.values,(function(e,s){return a("div",{key:s,staticClass:"flex-item dflex-b"},[a("div",{staticClass:"flex1 tac padding-xs ft-primary",on:{click:function(a){return t.editItem(e,s)}}},[t._v(t._s(e))]),a("div",{staticClass:"el-icon-close fs ft-base padding-xs padding-lr-sm",on:{click:function(a){return t.removeItem(e,s)}}})])})),0):t._e(),a("div",{staticClass:"padding dflex-b"},[t.inputVisible?a("div",{staticClass:"dflex"},[a("el-input",{attrs:{size:"small",placeholder:"请输入属性值"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.inputConfirm(e)}},model:{value:t.inputValue,callback:function(e){t.inputValue=e},expression:"inputValue"}}),a("el-button",{staticClass:"margin-left-sm",attrs:{type:"primary",size:"small",round:""},on:{click:t.inputConfirm}},[t._v("确认")]),a("el-button",{staticClass:"margin-left-xs",attrs:{size:"small",plain:"",round:""},on:{click:function(e){t.inputVisible=!1}}},[t._v("取消")])],1):a("el-button",{staticClass:"el-icon-plus",attrs:{size:"small",plain:""},on:{click:function(e){t.inputVisible=!0}}},[t._v("添加属性值")])],1)])},k=[],D={name:"AuxGoodsPropsBox",props:{value:{type:Object,default:()=>({code:"",name:"",values:[]})}},data(){return{formData:{code:"",name:"",values:[]},inputVisible:!1,inputValue:""}},watch:{value:{handler(t){this.formData={code:t.code,name:t.name,values:[...t.values]}},immediate:!0}},methods:{editName(){this.$prompt("","修改属性名称",{inputValue:this.formData.name,inputPlaceholder:"请填写属性名称"}).then(({value:t})=>{this.formData.name=t,this.$emit("input",this.formData)})},editItem(t,e){this.$prompt("","修改属性值",{inputValue:t||"",inputPlaceholder:"请填写属性值"}).then(({value:t})=>{this.$set(this.formData.values,e,t),this.$emit("input",this.formData)})},inputConfirm(){this.formData.values.push(this.inputValue),this.inputValue="",this.inputVisible=!1,this.$emit("input",this.formData)},removeItem(t,e){this.$confirm("确认删除该属性值吗？","提示",{type:"warning"}).then(()=>{this.formData.values.splice(e,1),this.$emit("input",this.formData)})}}},x=D,C=(a("ebc5"),Object(h["a"])(x,v,k,!1,null,null,null)),w=C.exports,S={components:{AuxGoodsPropsBox:w},data(){return{visible:!1,specList:[]}},computed:{...Object(n["b"])(["dictionary"])},methods:{open({specList:t=[]}){this.specList=[...t],this.visible=!0,this.$store.dispatch("dictionary/loadGoodsProps")},close(){this.visible=!1},addConstSpec(t){if(this.specList.length>=3)return;const e=this.specList.findIndex(e=>e.code===t.code);-1===e&&this.specList.push({name:t.name,code:t.code,values:[...t.values]})},addNewSpec(){this.$prompt("","新增规格/属性",{inputPlaceholder:"请填写属性名称"}).then(({value:t})=>{this.specList.push({name:t,values:[]})})},removeSpecItem(t,e){this.$confirm("确认删除该规格/属性吗？","提示",{type:"warning"}).then(()=>{this.specList.splice(e,1)})},validatForm(t){t.specList.forEach(t=>{if(!t.name)throw new Error("规格名称不能为空");if(0===t.values.length)throw new Error("每个规格下至少填写一个具体规格")})},getPostData(){return{specList:this.specList}},handleCancel(){this.$emit("cancel"),this.close()},handleSubmit(){try{const t=this.getPostData();this.validatForm(t),this.$emit("submit",t),this.close()}catch(t){this.$message.error(t.message)}}}},y=S,$=Object(h["a"])(y,_,g,!1,null,null,null),U=$.exports,L=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-cascader",{staticClass:"w-full",attrs:{options:t.treeList,props:{expandTrigger:"hover"},clearable:"",placeholder:"选择商品分类"},on:{change:t.change,focus:t.initLoad},model:{value:t.modelValue,callback:function(e){t.modelValue=e},expression:"modelValue"}})},P=[],M={name:"AuxPickerCategory",props:{value:{type:Array,default:()=>[]}},data(){return{dataList:[],treeList:[],modelValue:[]}},watch:{value:{handler(t,e){this.modelValue=t,this.initLoad()},immediate:!0}},methods:{initLoad(){0===this.dataList.length&&this.fetchData()},fetchData(){Object(l["a"])("goods/listCategoryAll",{},{functionName:"xunda"}).then(t=>{const e=(t.data||[]).map(t=>(t.label=t.name,t.value=t._id,t));this.dataList=e,e.forEach(t=>{t.pid=t.pid||""}),this.treeList=this.buildTree(e,"")})},buildTree(t,e){const a=t.filter(t=>e==t.pid).map(t=>Object.assign({},t));return a.forEach(e=>{const a=this.buildTree(t,e._id);a&&a.length>0&&(e.children=a)}),a},change(t){this.$nextTick(()=>{this.$emit("input",t);const e=this.dataList.filter(e=>t.includes(e.value));this.$emit("change",e)})}}},E=M,F=Object(h["a"])(E,L,P,!1,null,null,null),I=F.exports,N=a("d262"),j=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-select",{staticClass:"w-full",attrs:{filterable:"",placeholder:"请选择商品品牌",clearable:!0},on:{change:t.change,focus:t.initLoad},model:{value:t.modelValue,callback:function(e){t.modelValue=e},expression:"modelValue"}},t._l(t.dataList,(function(t){return a("el-option",{key:t._id,attrs:{label:t.brand_name,value:t._id}})})),1)},O=[],V={name:"AuxSelectSupplier",props:{value:{type:[String,Array],default:()=>""},multi:Boolean},data(){return{loading:!1,dataList:[],modelValue:""}},watch:{value:{handler(t,e){this.modelValue=t,0==this.dataList.length&&t&&this.fetchData()},immediate:!0}},methods:{initLoad(){this.dataList.length>0||this.fetchData()},fetchData(t=""){Object(l["a"])("goods/listGoodsBrand",{pageSize:50,simple:!0,keyword:t},{functionName:"xunda"}).then(t=>{this.loading=!1,this.dataList=t.data||[]})},remoteMethod(t){t&&""!==t?(this.loading=!0,this.$common.debounce(()=>this.fetchData(t),200)()):this.dataList=[]},change(){this.$nextTick(()=>{if(this.$emit("input",this.modelValue),!this.multi){const t=this.dataList.filter(t=>t._id==this.modelValue);t.length>0&&this.$emit("change",t[0])}})}}},G=V,A=Object(h["a"])(G,j,O,!1,null,null,null),W=A.exports;window.Decimal=o["a"];var B={name:"GoodsCreate",components:{GoodsMultiUnitDialog:b,GoodsMultiSpecDialog:U,AuxCategoryPicker:I,AuxSupplierSelect:N["a"],AuxBrandSelect:W},props:[],data(){return{unitMulti:!1,unitOptions:{baseUnit:"",moreUnits:[]},specMulti:!1,goodsId:"",formData:{name:"",code:"",img:"",imgs:[],cid:"",cids:[],unit:"",unit_list:[],unit_desc:"",spec:"",spec_list:[],price:"",min_price:"",bid_price:"",market_price:"",sku_datas:[{scale:1,unit:"件",price:0,min_price:0,prices:0,bid_price:0,market_price:0}],brand_id:"",brand_name:"",weight:"",warranty:"",supplier_id:"",supplier_name:"",producer:"",state:1,remark:"",desc:"",stock_datas:[]},rules:{name:[{required:!0,message:"请填写商品名称",trigger:"blur"}],code:[{required:!0,message:"请填写商品编号",trigger:"blur"}],unit:[{required:!0,message:"请选择商品单位",trigger:"blur"}],cids:[{required:!0,message:"请选择商品分类",trigger:"change"}],state:[{required:!0,message:"请选择启用状态",trigger:"change"}]},submitLoading:!1,enableStockSet:!1,activeWarehouse:"",warehouseList:[]}},computed:{...Object(n["b"])(["dictionary"]),compUintsDesc(){if(this.formData.unit_desc)return this.formData.unit_desc;const t=this.formData.unit,e=this.formData.unit_list.map(e=>e.unit+(1!==e.scale?`(=${e.scale}${t})`:""));return e.join(" / ")},compSpecDesc(){const t=(this.formData.spec_list||[]).map(t=>`${t.name}(${t.values.length})`);return t.join(" | ")},compUnitList(){const t=this.formData.unit_list||[];return 0===t.length&&t.push({unit:this.formData.unit,scale:1}),t},compStockList(){const t=this.formData.stock_datas||[];return t.filter(t=>t.warehouse_id===this.activeWarehouse)}},created(){const{id:t,type:e}=this.$route.query||{};t&&(this.goodsId=t,this.fetchGoodsData()),"copyAdd"===e&&(this.goodsId=""),this.$store.dispatch("dictionary/loadGoodsUnits")},mounted(){},methods:{fetchGoodsData(){Object(l["a"])("goods/getInfo",{goodsId:this.goodsId},{functionName:"xunda"}).then(t=>{const{unit:e,price:a,bid_price:s,market_price:i,min_price:n=0,unit_list:l=[],spec_list:r=[],sku_datas:c=[],stock_datas:u=[],unit_prices:d=[]}=t.data,m=Object.assign(t.data),p=["price","market_price","bid_price","min_price"],h={unit:e,price:a,bid_price:s,market_price:i,min_price:n,scale:1},f=c.length>0?c:d.length>0?d:[h];[h].concat(f).forEach(t=>(p.forEach(e=>{const a=t[e];t[e]=o["a"].div(a||0,100).toFixed(2)}),t)),l.forEach(t=>{t.enablePriceSet=f.filter(e=>e.unit===t.unit).length>0}),m.unit_list=l,m.spec_list=r,m.sku_datas=f,u&&u.length>0&&(u.forEach(t=>{t.cost_price=o["a"].div(t.cost_price||0,100).toFixed(2)}),m.stock_datas=u),delete m["_id"],this.formData=m})},buildGoodCode(){this.formData.code=c()().format("YYMMDDHHmmss")},getUnitPriceList(t){const e=this.formData.sku_datas||[];return e.filter(e=>e.unit===t.unit)},changeGoodsBaseUnit(t){const e=this.formData.unit_list||[];e.length>0&&this.$set(e,0,Object.assign(e[0],{unit:t}));const a=this.formData.sku_datas||[];if(a.length>0){const e=a[0].unit;a.filter(t=>t.unit===e).forEach(e=>e.unit=t)}},changeGoodsBrand(t){this.formData.brand_name=t.brand_name},changeSupplier(t){this.formData.supplier_name=t.supplier_name},openMoreUnitSet(t){t&&this.$refs.goodsMultiUnitDialog.open({baseUnit:this.formData.unit,unitList:this.formData.unit_list})},submitMoreUnit({baseUnit:t,unitList:e,unitDesc:a}){t!==this.formData.unit&&(this.formData.unit=t,this.changeGoodsBaseUnit(t)),this.formData.unit_desc=a,this.formData.unit_list=e,this.unitMulti=e.length>1;const s=e.map(t=>t.unit);this.formData.sku_datas=(this.formData.sku_datas||[]).filter(t=>s.includes(t.unit)),this.formData.stock_datas.forEach(e=>e.unit=t)},openMoreSpecSet(t){t&&this.$refs.goodsMultiSpecDialog.open({specList:this.formData.spec_list})},submitMoreSpec({specList:t}){0===t.length?(this.formData.spec="",this.formData.spec_list=[],this.specMulti=!1):1===t.length&&1===t[0].values.length?(this.formData.spec=t[0].values[0],this.formData.spec_list=[],this.specMulti=!1):(this.formData.spec="",this.formData.spec_list=[...t],this.specMulti=!0),this.initSpecPrices(),this.initStockDatas(this.activeWarehouse)},initSpecPrices(){const t=this.formData.spec_list,e=this.formData.sku_datas,a=t.filter(t=>t.values.length>0).map(t=>t.values);if(0===a.length)return void(this.formData.sku_datas=[e[0]]);const s=this.formData.unit,i=e.filter(t=>t.unit===s),n=this.$common.toCartesian(a),l={},o=n.map(t=>t.join("/"));i.filter(t=>o.includes(t.name)).forEach(t=>{l[t.name]=t});const r=n.map(t=>{const e=t.join("/");return l[e]?l[e]:{name:e,skus:t,unit:s,img:"",code:"",price:"",bid_price:"",market_price:"",min_price:""}});this.formData.sku_datas=r},cancelMoreSpec(){0===this.formData.spec_list.length&&(this.specMulti=!1)},changeUnitItemPrice(t,e){t[e]=Number(t[e]).toFixed(2)},batchPriceSet(t,e){this.$prompt("请输入价格（单位：元）","批量设置",{inputPlaceholder:"请填写",inputPattern:/^\d+(?:\.\d{0,2})?/,inputErrorMessage:"价格不正确"}).then(({value:a})=>{const s=this.formData.sku_datas||[],i=s.filter(e=>e.unit===t.unit);i.forEach(t=>{t[e]=Number(a).toFixed(2)})})},changeEnablePriceSet(t){t.enablePriceSet?this.initUnitPrices(t):this.deleteUnitPrices(t)},initUnitPrices(t){const e=["price","market_price","bid_price","min_price"],a=this.formData.unit,s=this.formData.sku_datas||[],i=s.filter(t=>t.unit===a),n=i.map(a=>{const s=Object.assign({},a,{unit:t.unit,scale:Number(t.scale)});return delete s.sku_id,e.forEach(e=>{const a=s[e];a&&this.$set(s,e,Number(a*t.scale).toFixed(2))}),s});s.push(...n)},deleteUnitPrices(t){this.formData.sku_datas=this.formData.sku_datas.filter(e=>e.unit!==t.unit)},changeEnableStockSet(){const t=this.enableStockSet;t?this.loadWarehouseData(()=>{this.changeWarehouse(this.activeWarehouse)}):this.formData.stock_datas=[]},loadWarehouseData(t=(()=>{})){Object(l["a"])("stock/listWarehouse",{pageSize:20,simple:!0},{functionName:"xunda"}).then(e=>{this.warehouseList=e.data||[],this.warehouseList.length>0&&(this.activeWarehouse=this.warehouseList[0]._id),t()})},initStockDatas(t){const e=this.formData.unit,a=this.formData.spec_list;if(0===a.length){const a={warehouse_id:t,unit:e,cost_price:"",cost_amount:"",stock_num:""};return void this.formData.stock_datas.push(a)}const s=a.filter(t=>t.values.length>0).map(t=>t.values),i=this.$common.toCartesian(s),n=i.map(a=>{const s=a.join("/");return{warehouse_id:t,name:s,skus:a,unit:e,cost_price:"",cost_amount:"",stock_num:""}});this.formData.stock_datas.push(...n)},changeWarehouse(t){this.activeWarehouse=t,this.$nextTick(()=>{const e=this.formData.stock_datas.filter(e=>e.warehouse_id===t);e.length>0||this.initStockDatas(t)})},batchStockSet(t){const e=this.activeWarehouse;"stock_num"===t?this.$prompt("请输入期初库存量","批量设置",{inputPlaceholder:"请填写",inputPattern:/^\d+(?:\.\d{0,2})?/,inputErrorMessage:"价格不正确"}).then(({value:a})=>{const s=this.formData.stock_datas||[],i=s.filter(t=>t.warehouse_id===e);i.forEach(e=>{e[t]=Number(a)}),this.changeStockCompleted(t)}):this.$prompt("请输入期初金额","批量设置",{inputPlaceholder:"请填写",inputPattern:/^\d+(?:\.\d{0,2})?/,inputErrorMessage:"金额不正确"}).then(({value:a})=>{const s=this.formData.stock_datas||[],i=s.filter(t=>t.warehouse_id===e);i.forEach(e=>{e[t]=Number(a).toFixed(2)}),this.changeStockCompleted(t)})},changeStockInput(t,e){t.stock_num=Number(t.stock_num||1),"stock_num"!==e&&"cost_price"!==e||(t.cost_price=Number(t.cost_price||0).toFixed(2),t.cost_amount=(t.stock_num*t.cost_price).toFixed(2)),"cost_amount"===e&&(t.cost_amount=Number(t.cost_amount||0).toFixed(2),t.cost_price=Number(t.cost_amount/t.stock_num).toFixed(2))},changeStockCompleted(t){const e=this.formData.stock_datas||[];0!==e.length&&e.forEach(e=>{"stock_num"!==t&&"cost_price"!==t||(e.cost_price=Number(e.cost_price||0).toFixed(2),e.cost_amount=(e.stock_num*e.cost_price).toFixed(2)),"cost_amount"===t&&(e.cost_amount=Number(e.cost_amount||0).toFixed(2),e.cost_price=Number(e.cost_amount/e.stock_num).toFixed(2))})},validatData(t){t.sku_datas.forEach((t,e)=>{if(!t.price||Number(t.price)<=0)throw new Error(`单位[${t.unit}]-单品名[${t.name||"无"}]，金额必需大于零`)})},submitForm(){this.submitLoading=!0;try{this.$refs["goodsForm"].validate(t=>{if(!t)return void(this.submitLoading=!1);const e=this.getPostData();this.validatData(e),Object(l["a"])("goods/saveGoods",e,{functionName:"xunda"}).then(t=>{this.submitLoading=!1,this.$message.success("保存成功"),this.$router.push({path:"./goods-list"})},t=>{this.submitLoading=!1})})}catch(t){this.submitLoading=!1,this.$message.error(t.message||t)}},getPostData(){const t=["price","market_price","bid_price","min_price"],e=(this.formData.unit||"").trim(),a=Object.assign({},this.formData,{goods_id:this.goodsId});a.unit_list&&0!==a.unit_list.length||(a.unit_list=[{unit:e,scale:1}]);let s=a.sku_datas||[];const i=s.filter(t=>t.unit===e);if(i.length>1){const t=i.map(t=>Number(t.price)),e=Math.max(...t),s=Math.min(...t),n=s===e?s:s+"~"+e;a.price_range_text=n}s=s.map(e=>{const a=Object.assign({},e);return t.forEach(t=>{const s=e[t];a[t]=o["a"].mul(Number(s||0),100).toFixed(1)}),this.goodsId||(delete a.sku_id,delete a._id),a});const n={unit:e},l=s[0];t.forEach(t=>{const e=l[t];n[t]=e}),Object.assign(a,n),a.unit_prices=[],a.sku_datas=s;const r=a.stock_datas||[];return this.enableStockSet&&r.length>0?(r.forEach(t=>{t.cost_price=Number(o["a"].mul(Number(t.cost_price||0),100))}),a.stock_datas=r):a.stock_datas=[],a},resetForm(){this.$refs["goodsForm"].resetFields()}}},z=B,T=(a("b60d"),Object(h["a"])(z,s,i,!1,null,null,null));e["default"]=T.exports},"7bde":function(t,e,a){},a4f6:function(t,e,a){},b60d:function(t,e,a){"use strict";a("a4f6")},b8d8:function(t,e,a){"use strict";a("7bde")},d90f:function(t,e,a){},ebc5:function(t,e,a){"use strict";a("d90f")}}]);