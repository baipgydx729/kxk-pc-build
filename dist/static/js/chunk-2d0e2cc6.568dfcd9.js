(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0e2cc6"],{"7fde":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("div",{staticClass:"aux-card"},[a("div",{staticClass:"header"},[a("div",{staticClass:"left title"},[e._v(" 收款单详情 "),e.detail.state?e._e():a("span",{staticClass:"ft-danger"},[e._v("（订单待审核）")])]),a("div",{staticClass:"right"},[e.detail.state?e._e():a("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["receipt-orders-approve"],expression:"['receipt-orders-approve']"}],attrs:{type:"primary",loading:e.approveLoading,plain:"",icon:"el-icon-check"},on:{click:e.handleApproveOrders}},[e._v("审核通过")]),a("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["receipt-orders-delete"],expression:"['receipt-orders-delete']"}],attrs:{type:"danger",plain:"",icon:"el-icon-delete"},on:{click:e.handleDeleteOrders}},[e._v("作废")])],1)]),a("div",{staticClass:"padding"},[a("el-form",{ref:"baseForm",attrs:{"label-width":"130px","label-align":"left",size:"small",inline:!0}},[a("el-alert",{attrs:{type:e.detail.state?"success":"info","show-icon":"",close:!1}},[a("el-form-item",{attrs:{label:"收款单号:","label-width":"86px"}},[e._v(e._s(e.detail.receipt_no))]),a("el-form-item",{attrs:{label:"收款类别:"}},[e._v(e._s(e._f("formatTypeName")(e.detail.settle_type,e.$constant.SETTLE_ORDERS_TYPES)))]),a("el-form-item",{attrs:{label:"收款时间:"}},[e._v(e._s(e._f("formatDate")(e.detail.receipt_date)))]),a("el-form-item",{attrs:{label:"制单人:"}},[e._v(e._s(e.detail.create_uname))]),a("el-form-item",{attrs:{label:"审核人:"}},[e._v(e._s(e.detail.approved_name))])],1),a("div",[a("el-form-item",{attrs:{label:"收款金额:"}},[e._v(e._s(e._f("cent2yuan")(e.detail.receipt_money)))]),a("el-form-item",{attrs:{label:"优惠金额:"}},[e._v(e._s(e._f("cent2yuan")(e.detail.discount_money)))])],1),a("div",[a("el-form-item",{attrs:{label:"收款账户:"}},[e._v(e._s(e.getAccountText(e.detail)))])],1),e.detail.payer_id?a("div",[a("el-form-item",{attrs:{label:"付款方:"}},[e._v(e._s(e.detail.payer_name))])],1):e._e(),a("div",[a("el-form-item",{attrs:{label:"备注:"}},[e._v(e._s(e.detail.remark))])],1)],1)],1)]),a("div",{staticClass:"aux-card margin-top"},[e._m(0),a("el-table",{staticClass:"aux-table",attrs:{data:e.detail.orders_list,border:"","show-summary":"","summary-method":e.summaryMethod}},[a("el-table-column",{attrs:{width:"60",align:"center",label:"#"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.$index+1))]}}])}),a("el-table-column",{attrs:{width:"220",align:"left",label:"订单号",prop:"orders_no"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticClass:"link-hover pointer",on:{click:function(a){return e.toOrdersPage(t.row)}}},[e._v(e._s(t.row.orders_no))])]}}])}),a("el-table-column",{attrs:{width:"180",align:"left",label:"开单时间",prop:"orders_date"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("formatDate")(t.row.orders_date)))]}}])}),a("el-table-column",{attrs:{width:"160",align:"center",label:"业务类型"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e._f("formatTypeName")(t.row.orders_type||e.compOrdersType,e.$constant.ORDERS_TYPES)))])]}}])}),a("el-table-column",{attrs:{width:"160",align:"right",label:"订单金额",prop:"should_settle_money"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("cent2yuan")(t.row.should_settle_money||t.row.orders_total_money)))]}}])}),a("el-table-column",{attrs:{width:"160",align:"right",label:"本次核销金额",prop:"settle_money"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("cent2yuan")(t.row.settle_money)))]}}])}),a("el-table-column",{attrs:{width:"160",align:"center",label:"本次结算状态",prop:"settle_state"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("formatTypeName")(t.row.settle_state,e.$constant.SETTLE_STATES)))]}}])}),a("el-table-column",{attrs:{align:"left",label:"备注"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.remark))]}}])})],1)],1)])},s=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"header"},[a("div",{staticClass:"left title"},[e._v("源单明细")])])}],l=(a("13d5"),a("2197")),n={data(){return{permission:"receipt-orders-query",approveLoading:!1,receiptId:"",detail:{payer_type:"",payer_id:"",payer_name:"",settle_type:"",receipt_no:"",receipt_date:"",orders_list:[],orders_count:0,orders_total_money:0,receipt_money:0,discount_money:0,unsettle_money:0,curr_owing_money:0}}},computed:{compOrdersType(){const e=this.$constant.SETTLE_ORDERS_TYPES.filter(e=>e.value===this.detail.settle_type);return e.length>0?e[0].refOrdersType:""}},created(){const{id:e}=this.$route.params;this.receiptId=e,this.fetachData()},methods:{fetachData(){Object(l["a"])("settle/getReceiptOrdersDetail",{receiptId:this.receiptId},{functionName:"xunda"}).then(e=>{this.detail=e.data})},summaryMethod({columns:e,data:t}){const a=[];return e.forEach((e,r)=>{if(0===r)return void(a[r]="合计");if(!["settle_money","orders_total_money"].includes(e.property))return void(a[r]=" ");const s=t.map(t=>Number(t[e.property]));s.every(e=>isNaN(e))?a[r]="":(a[r]=s.reduce((e,t)=>e+t,0),["settle_money","orders_total_money"].includes(e.property)&&(a[r]=(a[r]/100).toFixed(2)))}),a},handleApproveOrders(){this.$confirm("请仔细核对收款金额及明细项，是否审核通过？","审核提示",{confirmButtonText:"审核通过",cancelButtonText:"取消",type:"warning"}).then(()=>{this.approveLoading=!0,Object(l["a"])("settle/approvedReceiptOrders",{receiptId:this.receiptId},{functionName:"xunda"}).then(e=>{this.$message.success("操作成功"),this.approveLoading=!1,setTimeout(()=>this.fetachData(),500)},e=>{this.approveLoading=!1})})},handleDeleteOrders(){this.$confirm("确定要作废该收款单？","确认提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{Object(l["a"])("settle/deleteReceiptOrders",{receiptId:this.receiptId},{functionName:"xunda"}).then(e=>{this.$message.success("操作成功"),setTimeout(()=>this.$common.closePage(),500)})})},toOrdersPage(e){const t=this.$common.getKeyValue(this.$constant.ORDERS_TYPES,this.compOrdersType,"value","detailUrl");t&&this.$router.push({path:t+"/"+e.orders_id})},getAccountText(e){return e.account_name?e.account_name:this.$common.getTypeName(this.$constant.PAYMENT_TYPES,e.receipt_type)}}},o=n,i=a("2877"),c=Object(i["a"])(o,r,s,!1,null,null,null);t["default"]=c.exports}}]);