(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6fb23752"],{"36ee":function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"app-container"},[i("div",{staticClass:"aux-card"},[i("div",{staticClass:"header"},[e._m(0),i("div",{staticClass:"dflex"},[i("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["goods-category-edit"],expression:"['goods-category-edit']"}],attrs:{type:"primary",icon:"el-icon-plus"},on:{click:function(t){return e.append()}}},[e._v("新增分类")])],1)]),i("div",{staticClass:"padding"},[i("el-tree",{staticClass:"category-tree",attrs:{data:e.treeList,"default-expanded-keys":e.expandedKeys,"icon-class":"e","node-key":"_id","default-expand-all":!1,"expand-on-click-node":!0,"highlight-current":!1,draggable:e.$hasPermission(["goods-category-edit"]),"allow-drag":e.allowDrag,"allow-drop":e.allowDrop},on:{"node-drop":e.nodeDropComplate},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.node,a=t.data;return i("div",{staticClass:"tree-node"},[i("div",{staticClass:"left-icon"},[i("i",{class:n.isLeaf?"el-icon-folder-remove":"el-icon-folder-add"})]),e.editMode&&e.editRowId==a._id?i("div",{staticClass:"right-content dflex-s",on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.voidStop(t)}}},[i("el-input",{ref:"editInput",staticStyle:{width:"300px"},attrs:{placeholder:"填写分类名称",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submitEdit(n,a)}},model:{value:e.editValue,callback:function(t){e.editValue=t},expression:"editValue"}}),i("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["goods-category-edit"],expression:"['goods-category-edit']"}],staticClass:"padding-lr margin-left",attrs:{type:"success",icon:"el-icon-check",round:"",size:"small"},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.submitEdit(n,a)}}},[e._v("确认")]),i("el-button",{staticClass:"padding-lr",attrs:{type:"default",icon:"el-icon-yes",round:"",size:"small"},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.cancelEdit(n,a)}}},[e._v("取消")])],1):i("div",{staticClass:"right-content dflex-b"},[i("div",[e._v(e._s(a.label))]),i("div",{staticClass:"opt-btn"},[a.pid?e._e():i("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["goods-category-edit"],expression:"['goods-category-edit']"}],attrs:{type:"primary",plain:"",round:"",size:"small",icon:"el-icon-circle-plus-outline"},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.append(a)}}},[e._v("新增子分类")]),i("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["goods-category-edit"],expression:"['goods-category-edit']"}],attrs:{type:"success",round:"",size:"small",plain:"",icon:"el-icon-edit-outline"},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.editItem(n,a)}}},[e._v("修改")]),i("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["goods-category-delete"],expression:"['goods-category-delete']"}],attrs:{type:"danger",round:"",size:"small",plain:"",icon:"el-icon-delete"},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.deleteItem(n,a)}}},[e._v("删除")])],1)])])}}])})],1)])])},a=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"left"},[i("span",{staticClass:"title"},[e._v("商品分类")]),i("span",{staticClass:"ft-xs ft-grey"},[e._v("(支持拖拽分类排序)")])])}],o=(i("d3b7"),i("159b"),i("b0c0"),i("d81d"),i("4de4"),i("c740"),i("a434"),i("2197")),d={data:function(){return{cateParentId:"",treeList:[],expandedKeys:[],editMode:!1,editRowId:"",editValue:""}},mounted:function(){this.fetchCategory()},methods:{fetchCategory:function(){var e=this;Object(o["a"])("goods/listCategoryAll",{},{functionName:"xunda"}).then((function(t){var i=t.data||[];i.forEach((function(e){e.pid=e.pid||"",e.label=e.name})),e.treeList=e.buildTree(i,"")}))},buildTree:function(e,t){var i=this,n=e.filter((function(e){return t==e.pid})).map((function(e){return Object.assign({},e)}));return n.forEach((function(t){t.editMode=!1;var n=i.buildTree(e,t._id);n&&n.length>0&&(t.children=n)})),n},append:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={_id:"",pid:e._id||"",children:[]};e._id?(this.expandedKeys=[e.pid],e.children||this.$set(e,"children",[]),e.children.push(t)):this.treeList.push(t),this.editItem("",t)},editItem:function(e,t){var i=this;this.editMode=!0,this.editValue=t.name,this.editRowId=t._id,this.$nextTick((function(){setTimeout((function(){i.$refs.editInput&&i.$refs.editInput.focus()}),300)}))},clearEdit:function(){this.editMode=!1,this.editValue="",this.editRowId=""},submitEdit:function(e,t){var i=this,n=this.editValue;if(n!==t.name){var a={cid:t._id,name:n,pid:t.pid,sort:100};Object(o["a"])("goods/saveGoodsCategory",a,{functionName:"xunda"}).then((function(e){i.expandedKeys=[t.pid],i.fetchCategory(),i.clearEdit()}))}},cancelEdit:function(e,t){t._id||this.remove(e,t),this.clearEdit()},deleteItem:function(e,t){var i=this,n=function(){Object(o["a"])("goods/deleteGoodsCategory",{cid:t._id},{functionName:"xunda"}).then((function(n){i.remove(e,t)}))};this.$confirm("确定要删除该分类？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){return n()}))},remove:function(e,t){var i=e.parent,n=i.data.children||i.data,a=n.findIndex((function(e){return e._id===t._id}));n.splice(a,1)},voidStop:function(){},allowDrag:function(e){return!!e.data._id},allowDrop:function(e,t,i){var n=this,a=function(e){n.timer&&clearTimeout(n.timer),n.timer=setTimeout((function(){n.$message.error(e)}),300)};return"inner"!==i&&(e.data.pid===t.data.pid||(a("仅支持在同一级调整顺序"),!1))},nodeDropComplate:function(e,t,i,n){var a=this;this.expandedKeys=[],e.data.pid&&(this.expandedKeys=[e.data.pid]),Object(o["a"])("goods/dragSortCategory",{parentId:e.data.pid||"",dragCateId:e.data._id,dropCateId:t.data._id,type:i},{functionName:"xunda"}).then((function(e){a.fetchCategory(),a.$message.success("分类顺序调整完成")}))}}},s=d,r=(i("4848"),i("2877")),c=Object(r["a"])(s,n,a,!1,null,null,null);t["default"]=c.exports},"420f":function(e,t,i){},4848:function(e,t,i){"use strict";i("420f")}}]);