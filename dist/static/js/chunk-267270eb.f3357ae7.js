(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-267270eb"],{"5f65":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("div",{staticClass:"aux-card"},[a("div",{staticClass:"header"},[e._m(0),a("div",{staticClass:"right"},[a("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["sales-orders-create"],expression:"['sales-orders-create']"}],attrs:{type:"primary",icon:"el-icon-plus"},on:{click:function(t){return e.$common.toPage("./orders-create/")}}},[e._v("销售开单")]),a("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["sales-orders-export"],expression:"['sales-orders-export']"}],attrs:{loading:e.exportLoading,icon:"el-icon-download"},on:{click:e.handleExportData}},[e._v("导出数据")])],1)]),a("div",{staticClass:"filter-container margin-top-sm"},[a("el-form",{ref:"baseForm",attrs:{"label-width":"100px","label-align":"right"}},[e.showMoreFilter?e._e():a("div",{staticClass:"dflex-b padding-lr"},[a("div",{staticClass:"dflex-s flex1"},[a("el-select",{staticStyle:{width:"120px"},attrs:{clear:!1},model:{value:e.reqData.state,callback:function(t){e.$set(e.reqData,"state",t)},expression:"reqData.state"}},e._l(e.compStates,(function(e){return a("el-option",{key:e.value,attrs:{label:e.name,value:e.value}})})),1),a("el-date-picker",{staticClass:"margin-left-sm",staticStyle:{width:"300px"},attrs:{type:"daterange","range-separator":" - ","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.reqData.dateRange,callback:function(t){e.$set(e.reqData,"dateRange",t)},expression:"reqData.dateRange"}}),a("el-input",{staticClass:"margin-left-sm",staticStyle:{width:"300px"},attrs:{placeholder:"请输入单号搜索"},on:{confirm:e.fetchDataList},model:{value:e.reqData.ordersNo,callback:function(t){e.$set(e.reqData,"ordersNo",t)},expression:"reqData.ordersNo"}}),a("el-button",{staticClass:"margin-left-sm",attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.handleSearch}},[e._v("查 询")])],1),a("div",{staticStyle:{"text-align":"right"}},[a("el-button",{attrs:{type:"text"},on:{click:function(t){e.showMoreFilter=!e.showMoreFilter}}},[e._v(" 更多筛选 "),a("i",{staticClass:"el-icon-arrow-down"})])],1)]),e.showMoreFilter?a("div",{staticClass:"padding-lr"},[a("div",{staticClass:"row dflex-b"},[a("el-form-item",{attrs:{label:"下单时间"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"daterange","range-separator":" - ","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.reqData.dateRange,callback:function(t){e.$set(e.reqData,"dateRange",t)},expression:"reqData.dateRange"}})],1),a("el-form-item",{attrs:{label:"选择客户"}},[a("AuxStoreSelect",{model:{value:e.reqData.storeId,callback:function(t){e.$set(e.reqData,"storeId",t)},expression:"reqData.storeId"}})],1),a("el-form-item",{attrs:{label:"订单号"}},[a("el-input",{attrs:{placeholder:"请输入单号搜索"},model:{value:e.reqData.ordersNo,callback:function(t){e.$set(e.reqData,"ordersNo",t)},expression:"reqData.ordersNo"}})],1)],1),a("div",{staticClass:"row dflex-b"},[a("el-form-item",{attrs:{label:"商品信息"}},[a("AuxGoodsSelect",{model:{value:e.reqData.goodsId,callback:function(t){e.$set(e.reqData,"goodsId",t)},expression:"reqData.goodsId"}})],1),a("el-form-item",{attrs:{label:"出货仓库"}},[a("AuxWarehouseSelect",{attrs:{multi:""},model:{value:e.reqData.warehouseIds,callback:function(t){e.$set(e.reqData,"warehouseIds",t)},expression:"reqData.warehouseIds"}})],1),a("el-form-item",{attrs:{label:"业务员"}},[a("AuxMemberSelect",{attrs:{multi:""},model:{value:e.reqData.userIds,callback:function(t){e.$set(e.reqData,"userIds",t)},expression:"reqData.userIds"}})],1)],1),a("div",{staticClass:"row dflex-b"},[a("el-form-item",{attrs:{label:"下单区域"}},[a("AuxAreaPicker",{model:{value:e.reqData.areaIds,callback:function(t){e.$set(e.reqData,"areaIds",t)},expression:"reqData.areaIds"}})],1),a("div"),a("div")],1),a("div",{staticClass:"row"},[a("el-form-item",{attrs:{label:"单据状态"}},[a("AuxMultiCheckbox",{attrs:{"local-data":e.$constant.ORDERS_STATES},model:{value:e.reqData.state,callback:function(t){e.$set(e.reqData,"state",t)},expression:"reqData.state"}})],1),a("el-form-item",{attrs:{label:"结算状态"}},[a("AuxMultiCheckbox",{attrs:{"local-data":e.settleState},model:{value:e.reqData.settleState,callback:function(t){e.$set(e.reqData,"settleState",t)},expression:"reqData.settleState"}})],1)],1),a("div",{},[a("el-button",{attrs:{type:"default"},on:{click:function(t){e.showMoreFilter=!e.showMoreFilter}}},[e._v("取消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.handleSearch}},[e._v("执行查询")])],1)]):e._e()])],1),a("el-menu",{staticClass:"el-menu-big",attrs:{"default-active":e.activeIndex,mode:"horizontal"},on:{select:e.handleTabSelect}},e._l(e.compStates,(function(t){return a("el-menu-item",{key:t.code,attrs:{index:t.code}},[e._v(e._s(t.name))])})),1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.dataLoading,expression:"dataLoading"}],staticClass:"aux-table",attrs:{data:e.dataList,border:"",fit:"",stripe:""}},[a("el-table-column",{attrs:{type:"selection",width:"55",align:"center",fixed:""}}),a("el-table-column",{attrs:{width:"200",align:"left",label:"销售单号",fixed:""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("router-link",{attrs:{to:"orders-detail/"+t.row._id}},[a("span",{staticClass:"link-hover"},[e._v(e._s(t.row.orders_no))])])]}}])}),a("el-table-column",{attrs:{width:"180",align:"left",label:"下单时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("formatDate")(t.row.orders_date)))]}}])}),a("el-table-column",{attrs:{width:"180",align:"left",label:"客户名称","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.receiver.name))])]}}])}),a("el-table-column",{attrs:{width:"100",align:"center",label:"商品件数"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v("x"+e._s(t.row.goods_total_count||t.row.total_goods_count||t.row.orders_goods_count))])]}}])}),a("el-table-column",{attrs:{width:"120",align:"right",label:"订单金额"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("cent2yuan")(t.row.orders_total_money)))]}}])}),a("el-table-column",{attrs:{width:"120",align:"center",label:"收款状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("formatTypeName")(t.row.settle_state||0,e.settleState)))]}}])}),a("el-table-column",{attrs:{width:"120",align:"right",label:"收款金额"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("cent2yuan")(t.row.settle_money)))]}}])}),a("el-table-column",{attrs:{width:"120",align:"center",label:"订单状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("formatKeyValue")(t.row.state,e.$constant.ORDERS_STATES,"value","next"))+" ")]}}])}),a("el-table-column",{attrs:{width:"120",align:"center",label:"经办人"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.create_uname))]}}])}),a("el-table-column",{attrs:{align:"left",label:"备注","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.orders_remark))]}}])}),a("el-table-column",{attrs:{width:"120",align:"center",label:"操作",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.$common.toPage("./orders-detail/"+t.row._id)}}},[e._v("详情")]),!t.row.state||t.row.state<1?a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.$common.toPage("./orders-create?type=edit&id="+t.row._id)}}},[e._v("编辑")]):e._e()]}}])})],1),a("div",{staticClass:"padding-sm dflex-c"},[a("el-pagination",{attrs:{background:"","page-size":e.pagination.pageSize,total:e.pagination.totalCount,"current-page":e.pagination.pageNo,"page-sizes":[10,15,20,30,50],layout:"total, prev, pager, next, sizes","hide-on-single-page":""},on:{"size-change":e.changePageSize,"current-change":e.changePageNo}})],1)],1),a("el-dialog",{attrs:{title:"确认导出",visible:e.exportDialog.visible,width:"30%"},on:{"update:visible":function(t){return e.$set(e.exportDialog,"visible",t)}}},[a("div",{staticClass:"padding-lr-sm"},[e._v("即将导出销售单数据。如需导出明细数据，请勾选下方复选框。")]),a("div",{staticClass:"padding-lr-sm padding-top"},[a("div",{staticClass:"padding-bottom-sm"},[a("el-checkbox",{model:{value:e.exportDialog.hasDetail,callback:function(t){e.$set(e.exportDialog,"hasDetail",t)},expression:"exportDialog.hasDetail"}},[e._v(" 需要导出订单销售明细 "),a("span",{staticClass:"ft-grey"},[e._v("（注：可能耗时较长）")])])],1),a("div",[a("el-checkbox",{model:{value:e.exportDialog.hasCostProfit,callback:function(t){e.$set(e.exportDialog,"hasCostProfit",t)},expression:"exportDialog.hasCostProfit"}},[e._v(" 需要导出订单成本/利润 "),a("span",{staticClass:"ft-grey"},[e._v("（注：仅管理员可以导出）")])])],1)]),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"default"},on:{click:function(t){e.exportDialog.visible=!1}}},[e._v("取消")]),a("el-button",{attrs:{type:"primary",loading:e.exportLoading},on:{click:e.confirmExportData}},[e._v("导出数据")])],1)])],1)},o=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"left"},[a("span",{staticClass:"title"},[e._v("销售订单")])])}],s=(a("4de4"),a("d3b7"),a("e177")),l=a.n(s),i=a("2197"),r=a("a1b8"),c=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"dflex-s"},[a("el-checkbox",{staticClass:"padding-right-lg",attrs:{indeterminate:e.isIndeterminate},on:{change:e.handleCheckAllChange},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}},[e._v("全选")]),a("el-checkbox-group",{on:{change:e.change},model:{value:e.values,callback:function(t){e.values=t},expression:"values"}},e._l(e.dataList,(function(t){return a("el-checkbox",{key:t.value,attrs:{label:t.name}},[e._v(e._s(t.name))])})),1)],1)},d=[],u=(a("d81d"),a("b0c0"),a("ddb0"),{name:"AuxMutilCheckbox",props:{value:Array,localData:{type:Array,default:[]}},data:function(){return{checkAll:!1,dataList:[],values:[],isIndeterminate:!0}},watch:{localData:{immediate:!0,handler:function(e,t){Array.isArray(e)&&t!==e&&(this.dataList=this.localData.map((function(e){return e.text=e.name,e})))}}},methods:{handleCheckAllChange:function(e){this.values=e?this.dataList:[],this.isIndeterminate=!1},handleCheckedCitiesChange:function(e){var t=e.length;this.checkAll=t===this.dataList.length,this.isIndeterminate=t>0&&t<this.cities.length},inputAll:function(e){"all"==e[0]?(this.values=this.dataList.map((function(e){return e.value})),this.$emit("input",[])):(this.values=[],this.$emit("input",this.values))},change:function(e){this.values.length==this.dataList.length?(this.all.push("all"),this.$emit("input",[])):(this.all=[],this.$emit("input",this.values))}}}),f=u,h=a("2877"),p=Object(h["a"])(f,c,d,!1,null,null,null),m=p.exports,g=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-select",{staticClass:"w-full",attrs:{placeholder:"输入商品名称/编码查询",filterable:"",clearable:"",remote:"","remote-method":e.remoteMethod,loading:e.loading},on:{change:e.change,focus:e.initLoad},model:{value:e.modelValue,callback:function(t){e.modelValue=t},expression:"modelValue"}},e._l(e.dataList,(function(t){return a("el-option",{key:t.value,attrs:{label:t.name,value:t.value}},[a("div",{staticClass:"dflex-b"},[a("div",[a("span",[e._v(e._s(t.name))]),a("span",{staticClass:"fs-xs ft-grey"},[e._v("- "+e._s(t.code))])]),a("div",{staticClass:"padding-left-lg fs-xs ft-grey"},[(t.spec_list||[]).length>0?a("div",[e._v(" 多规格: "),e._l(t.spec_list,(function(t,n){return a("span",{key:n},[e._v(e._s(t.name+"("+t.values.length+")")+";")])}))],2):t.spec?a("div",[e._v("规格: "+e._s(t.spec))]):e._e()])])])})),1)],1)},v=[],b=(a("a434"),a("c031")),x={name:"AuxSelectGoods",props:{value:{type:[String,Array],default:function(){return""}}},data:function(){return{loading:!1,dataList:[],modelValue:""}},methods:{initLoad:function(){if(!(this.dataList.length>0)){var e=Object(b["d"])();e.length>0?this.dataList=e.splice(0,15).map((function(e){return e.name=e.name||"",e.value=e.goods_id,e})):this.fetchData()}},fetchData:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.loading=!0,Object(i["a"])("goods/list",{pageSize:10,simple:!0,keyword:t},{functionName:"xunda"}).then((function(t){e.loading=!1;var a=(t.data||[]).map((function(e){return e.name=e.name||"",e.value=e.goods_id,e}));Object(b["f"])(a),e.dataList=a}))},remoteMethod:function(e){var t=this;e&&""!==e?(this.loading=!0,clearTimeout(this.timer),this.timer=setTimeout((function(){return t.fetchData(e)}),200)):this.dataList=[]},change:function(){var e=this;this.$nextTick((function(){e.$emit("input",e.modelValue),e.$emit("change",{goodsId:e.modelValue,goods:Object(b["b"])(e.modelValue)})}))}}},_=x,w=Object(h["a"])(_,g,v,!1,null,null,null),D=w.exports,k=a("2051"),y=a("b866"),S=a("c3dd"),C=a("f63d"),q={name:"SalesOrdersList",components:{AuxMultiCheckbox:m,AuxGoodsSelect:D,AuxStoreSelect:k["a"],AuxMemberSelect:y["a"],AuxWarehouseSelect:S["a"],AuxAreaPicker:C["a"]},data:function(){return{permission:"sales-orders-query",states:[{name:"全 部",code:"all",value:""},{name:"待审核",code:"unApproval",value:0},{name:"待出库",code:"unStock",value:1,module:"stock"},{name:"待发货",code:"unSend",value:2,module:"stock"},{name:"待签收",code:"unSign",value:3},{name:"已完成",code:"complated",value:9}],settleState:[{name:"未收款",value:0},{name:"部分收款",value:1},{name:"已收款",value:9}],activeIndex:"all",showMoreFilter:!1,dataLoading:!1,dataList:[],pagination:{totalCount:1,pageSize:10,pageNo:1},reqData:{dateRange:[],ordersNo:"",storeId:"",goodsId:"",userIds:[],warehouseIds:[],areaIds:[],state:[],settleState:[]},exportLoading:!1,exportDialog:{visible:!1,hasDetail:!1,hasCostProfit:!1}}},computed:{compStates:function(){var e=this;return this.states.filter((function(t){return e.$hasModule(t.module)}))}},mounted:function(){this.fetchDataList()},methods:{fetchDataList:function(){var e=this;this.dataLoading=!0;var t=Object.assign({},this.getReqData(),this.pagination);Object(i["a"])("orders/listOrders",t,{functionName:"xunda"}).then((function(t){e.dataList=t.data||[],1===e.pagination.pageNo&&(e.pagination.totalCount=t.totalCount),e.dataLoading=!1}))},getReqData:function(){var e=Object.assign({},this.reqData),t=this.reqData.dateRange||[];return t.length>0&&(e.startDay=l()(t[0]).valueOf(),e.endDay=l()(t[1]).valueOf()),e},handleSearch:function(){this.fetchDataList()},handleTabSelect:function(e){var t=this.$common.getKeyValue(this.states,e,"code","value");this.reqData.state=t,this.pagination.pageNo=1,this.fetchDataList()},changePageNo:function(e){this.pagination.pageNo=e,this.fetchDataList()},changePageSize:function(e){this.pagination.pageNo=1,this.pagination.pageSize=e,this.fetchDataList()},handleExportData:function(){this.exportDialog.visible=!0},confirmExportData:function(){var e=this;this.exportLoading=!0;var t=Object.assign({},this.getReqData(),{hasDetail:this.exportDialog.hasDetail,hasCostProfit:this.exportDialog.hasCostProfit});Object(i["a"])("orders/exportOrders",t,{functionName:"xunda"}).then((function(t){Object(r["a"])(t.fileUrl,t.fileName),e.exportLoading=!1,e.exportDialog.visible=!1})).catch((function(t){e.$message({type:"error",message:"导出数据失败!"}),e.exportLoading=!1,e.exportDialog.visible=!1}))}}},L=q,A=(a("f0e5"),Object(h["a"])(L,n,o,!1,null,null,null));t["default"]=A.exports},a1b8:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));a("2ca0"),a("ac1f"),a("00b4"),a("ace4"),a("d3b7"),a("5cc6"),a("9a8c"),a("a975"),a("735e"),a("c1ac"),a("d139"),a("3a7b"),a("d5d6"),a("82f8"),a("e91f"),a("60bd"),a("5f96"),a("3280"),a("3fcc"),a("ca91"),a("25a1"),a("cd26"),a("3c5d"),a("2954"),a("649e"),a("219c"),a("170b"),a("b39a"),a("72f7"),a("1276"),a("3ca3"),a("ddb0"),a("2b3d"),a("9861"),a("5319");function n(e,t,a){var o=window,s="application/octet-stream",l=a||s,i=e,r="";r=("string"===typeof i&&i.startsWith("http")||!t&&!a)&&i;var c,d,u=document.createElement("a"),f=function(e){return String(e)},h=o.Blob||o.MozBlob||o.WebKitBlob||f,p=t||"download";if(h=h.call?h.bind(o):Blob,"true"===String(this)&&(i=[i,l],l=i[0],i=i[1]),r&&r.length<2048&&(p=t||r.split("/").pop().split("?")[0],u.href=r,-1!==u.href.indexOf(r))){var m=new XMLHttpRequest;return m.open("GET",r,!0),m.responseType="blob",m.onload=function(e){n(e.target.response,p,s)},setTimeout((function(){m.send()}),0),m}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(i)){if(!(i.length>2096103.424&&h!==f))return navigator.msSaveBlob?navigator.msSaveBlob(x(i),p):_(i);i=x(i),l=i.type||s}else if(/([\x80-\xff])/.test(i)){var g=0,v=new Uint8Array(i.length),b=v.length;for(g;g<b;++g)v[g]=i.charCodeAt(g);i=new h([v],{type:l})}function x(e){var t=e.split(/[:;,]/),a=t[1],n="base64"==t[2]?atob:decodeURIComponent,o=n(t.pop()),s=o.length,l=0,i=new Uint8Array(s);for(l;l<s;++l)i[l]=o.charCodeAt(l);return new h([i],{type:a})}function _(e,t){if("download"in u)return u.href=e,u.setAttribute("download",p),u.className="download-js-link",u.innerHTML="downloading...",u.style.display="none",document.body.appendChild(u),setTimeout((function(){u.click(),document.body.removeChild(u),!0===t&&setTimeout((function(){o.URL.revokeObjectURL(u.href)}),250)}),66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(e)&&(e="data:"+e.replace(/^data:([\w\/\-\+]+)/,s)),window.open(e)||confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")&&(location.href=e),!0;var a=document.createElement("iframe");document.body.appendChild(a),!t&&/^data:/.test(e)&&(e="data:"+e.replace(/^data:([\w\/\-\+]+)/,s)),a.src=e,setTimeout((function(){document.body.removeChild(a)}),333)}if(c=i instanceof h?i:new h([i],{type:l}),navigator.msSaveBlob)return navigator.msSaveBlob(c,p);if(o.URL)_(o.URL.createObjectURL(c),!0);else{if("string"===typeof c||c.constructor===f)try{return _("data:"+l+";base64,"+o.btoa(c))}catch(w){return _("data:"+l+","+encodeURIComponent(c))}d=new FileReader,d.onload=function(e){_(this.result)},d.readAsDataURL(c)}return!0}},aa49:function(e,t,a){},f0e5:function(e,t,a){"use strict";a("aa49")}}]);