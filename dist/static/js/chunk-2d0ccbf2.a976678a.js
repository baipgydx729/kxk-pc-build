(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0ccbf2"],{"4ef1":function(e,o,t){"use strict";t.r(o);var r=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",{staticClass:"app-container"},[t("div",{staticClass:"aux-card"},[t("div",{staticClass:"header"},[e._m(0),t("div",{staticClass:"right"},[t("el-button",{attrs:{type:"default",icon:"el-icon-tickets"},on:{click:function(o){return e.$common.closePage()}}},[e._v("取消")]),t("el-button",{attrs:{type:"primary",icon:"el-icon-document-checked"},on:{click:e.handleSave}},[e._v("保存 (Ctrl+S)")])],1)]),t("div",{staticClass:"margin-top-sm"},[t("el-form",{ref:"baseForm",attrs:{"label-width":"90px","label-align":"left",inline:!0}},[t("div",{staticClass:"dflex-s"},[t("el-form-item",{attrs:{label:"选择客户"}},[t("AuxStoreSelect",{staticStyle:{width:"300px"},on:{change:e.changeStoreSelect},model:{value:e.baseForm.store_id,callback:function(o){e.$set(e.baseForm,"store_id",o)},expression:"baseForm.store_id"}})],1),t("el-form-item",{attrs:{label:"业务日期"}},[t("el-date-picker",{staticStyle:{width:"300px"},attrs:{type:"datetime","value-format":"timestamp"},model:{value:e.baseForm.orders_date,callback:function(o){e.$set(e.baseForm,"orders_date",o)},expression:"baseForm.orders_date"}})],1)],1)])],1),t("OrdersGoodsTable",{ref:"goodsTable",on:{change:e.changeOrdersGoodsCompleted}})],1),t("el-card",{staticClass:"aux-card margin-top",attrs:{shadow:"none","body-style":{padding:"12px"}}},[t("el-form",{ref:"baseForm",attrs:{"label-width":"80px","label-align":"left",inline:!0}},[t("el-form-item",{attrs:{label:"整单优惠"}},[t("el-input",{attrs:{oninput:"value=value.match(/^\\d+(?:\\.\\d{0,2})?/)",placeholder:"整单优惠"},on:{blur:e.changeOrdersDiscountMoney},model:{value:e.baseForm.orders_discount_money,callback:function(o){e.$set(e.baseForm,"orders_discount_money",o)},expression:"baseForm.orders_discount_money"}},[t("template",{slot:"append"},[e._v("元")])],2)],1),t("el-form-item",{attrs:{label:"其他费用"}},[t("el-input",{attrs:{oninput:"value=value.match(/^\\d+(?:\\.\\d{0,2})?/)",placeholder:"其他费用"},on:{change:e.changeOrdersCompleted},model:{value:e.baseForm.orders_extend_fee,callback:function(o){e.$set(e.baseForm,"orders_extend_fee",o)},expression:"baseForm.orders_extend_fee"}},[t("template",{slot:"append"},[e._v("元")])],2)],1),t("el-form-item",{attrs:{label:"订单金额"}},[t("el-input",{attrs:{disabled:"",placeholder:"金额"},model:{value:e.baseForm.orders_total_money,callback:function(o){e.$set(e.baseForm,"orders_total_money",o)},expression:"baseForm.orders_total_money"}},[t("template",{slot:"append"},[e._v("元")])],2)],1)],1),t("div",{staticClass:"dflex-e padding-tb border-top"},[t("span",{staticClass:"padding-left"},[e._v("整单优惠："+e._s(e.baseForm.orders_discount_money))]),t("span",{staticClass:"padding-left"},[e._v("其他费用："+e._s(e.baseForm.orders_extend_fee))]),t("span",{staticClass:"padding-left"},[e._v("订单金额："+e._s(e.baseForm.orders_total_money))])])],1),t("el-card",{staticClass:"aux-card margin-top",attrs:{shadow:"none","body-style":{padding:"12px"}}},[t("div",{attrs:{slot:"header"},slot:"header"},[t("span",[e._v("订单备注")])]),t("el-input",{attrs:{type:"textarea",placeholder:"请输入内容",maxlength:"600","show-word-limit":""},model:{value:e.baseForm.orders_remark,callback:function(o){e.$set(e.baseForm,"orders_remark",o)},expression:"baseForm.orders_remark"}})],1)],1)},s=[function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",{staticClass:"left"},[t("span",{staticClass:"title"},[e._v("销售预订单")])])}],a=t("c7eb"),d=t("1da1"),n=(t("b680"),t("d81d"),t("b0c0"),t("a9e3"),t("b7ac")),i=t("2051"),_=t("2197"),m={name:"SalesPrepareCreate",components:{OrdersGoodsTable:n["a"],AuxStoreSelect:i["a"]},data:function(){return{permission:"sales-prepare-create",ordersId:"",baseForm:{orders_date:(new Date).getTime(),orders_no:"",store_id:"",store:{_id:"",name:"",contact:"",telephone:"",sale_grade:0},orders_goods:[],sale_manid:"",orders_remark:"",create_remark:"",create_uname:"",goods_total_count:0,goods_original_money:0,goods_discount_money:0,goods_total_money:0,orders_discount_money:0,orders_extend_fee:0,orders_total_money:0}}},computed:{},mounted:function(){var e=this.$route.query||{},o=e.storeId,t=e.id,r=e.type;o&&(this.baseForm.store_id=o),t&&(this.ordersId=t,this.fetchDetail()),"copyAdd"===r&&(this.ordersId="")},methods:{fetchDetail:function(){var e=this;Object(_["a"])("prepare/getOrders",{ordersId:this.ordersId},{functionName:"xunda"}).then((function(o){e.initOrdersData(o.data)}))},initOrdersData:function(e){var o={};o.store_id=e.store_id,o.store=e.store,o.orders_date=e.orders_date,o.orders_no=e.orders_no,o.orders_remark=e.orders_remark,o.create_remark=e.create_remark,o.create_uname=e.create_uname,o.sale_manid=e.sale_manid||"",o.orders_total_money=(e.orders_total_money>0?e.orders_total_money/100:0).toFixed(2),o.orders_extend_fee=(e.orders_extend_fee>0?e.orders_extend_fee/100:0).toFixed(2),o.orders_discount_money=(e.orders_discount_money>0?e.orders_discount_money/100:0).toFixed(2),o.goods_total_count=e.goods_total_count||e.orders_goods_count,o.goods_original_money=e.goods_original_money>0?(e.goods_original_money/100).toFixed(2):o.ordersTotalMoney,o.goods_discount_money=e.goods_discount_money>0?(e.goods_discount_money/100).toFixed(2):0,o.goods_total_money=e.goods_total_money>0?(e.goods_total_money/100).toFixed(2):o.goodsOriginalMoney,o.orders_goods=e.orders_goods.map((function(e){var o=Object.assign({},e);return o.goods_ori_price=((e.goods_ori_price||o.goods_price)/100).toFixed(2),o.total_ori_money=((e.total_ori_money||o.total_money)/100).toFixed(2),o.total_ori_money=((e.total_ori_money||o.total_money)/100).toFixed(2),o.total_money=(e.total_money/100).toFixed(2),o.goods_price=(e.goods_price/100).toFixed(2),o})),this.$refs.goodsTable.initData(o.orders_goods),this.baseForm=o},changeStoreSelect:function(e){this.baseForm.store_id=e._id,this.baseForm.store={_id:e._id,name:e.name,contact:e.contact,telephone:e.telephone}},changeOrdersDiscountMoney:function(){this.baseForm.orders_discount_money=Math.min(this.baseForm.orders_discount_money,this.baseForm.goods_total_money),this.changeOrdersGoodsCompleted()},changeOrdersGoodsCompleted:function(){var e=this.$refs.goodsTable.getSummaryData(),o=e.goodsTotalCount,t=void 0===o?0:o,r=e.goodsOriginalMoney,s=void 0===r?0:r,a=e.goodsDiscountMoney,d=void 0===a?0:a,n=e.goodsTotalMoney,i=void 0===n?0:n;this.baseForm.goods_total_count=t,this.baseForm.goods_original_money=s,this.baseForm.goods_discount_money=d,this.baseForm.goods_total_money=i,this.changeOrdersCompleted()},changeOrdersCompleted:function(){this.baseForm.orders_discount_money=(Number(this.baseForm.orders_discount_money)||0).toFixed(2),this.baseForm.orders_extend_fee=(Number(this.baseForm.orders_extend_fee)||0).toFixed(2),this.baseForm.orders_total_money=(Number(this.baseForm.goods_total_money)+Number(this.baseForm.orders_extend_fee)-Number(this.baseForm.orders_discount_money)).toFixed(2)},validateForm:function(){if(this.baseForm.store_id){var e=this.$refs.goodsTable.getListData();if(0!==e.length)return!0;this.$message.error("商品清单为空")}else this.$message.error("请选择客户")},handleSave:function(){this.validateForm()&&this.submitForm()},submitForm:function(){var e=this;return Object(d["a"])(Object(a["a"])().mark((function o(){var t;return Object(a["a"])().wrap((function(o){while(1)switch(o.prev=o.next){case 0:t={ordersId:e.ordersId,data:e.getOrdersData()},Object(_["a"])("prepare/saveOrders",t,{functionName:"xunda"}).then((function(o){e.$message("保存成功"),setTimeout((function(){return e.$router.push({name:"SalesPrepareDetail",params:{ordersId:o.data}})}),300),e.$common.closePage()}),(function(o){e.$message.error(o.message)}));case 2:case"end":return o.stop()}}),o)})))()},getOrdersData:function(){var e=Object.assign({},this.baseForm,{orders_type:1,orders_date:this.baseForm.orders_date,store_id:this.baseForm.store_id,store:this.baseForm.store,orders_remark:this.baseForm.orders_remark,orders_goods:this.getOrdersGoods(),goods_total_count:this.baseForm.goods_total_count,goods_original_money:100*this.baseForm.goods_original_money,goods_discount_money:100*this.baseForm.goods_discount_money,goods_total_money:100*this.baseForm.goods_total_money,orders_discount_money:100*this.baseForm.orders_discount_money,orders_extend_fee:100*this.baseForm.orders_extend_fee,orders_total_money:100*this.baseForm.orders_total_money});return this.ordersId||(e.orders_no="XYD"+this.$common.format(new Date,"yyyyMMddhhmmssS")),e},getOrdersGoods:function(){var e=this.$refs.goodsTable.getListData();return e.map((function(e){var o=Object.assign({},e,{goods_ori_price:100*e.goods_ori_price,total_ori_money:100*e.total_ori_money,goods_price:100*e.goods_price,total_money:100*e.total_money});return o}))}}},l=m,c=t("2877"),u=Object(c["a"])(l,r,s,!1,null,null,null);o["default"]=u.exports}}]);