(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-commons"],{"031e":function(t,e,a){"use strict";a("be53")},"15f6":function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-popover",{attrs:{placement:"bottom-start",width:"800",trigger:"click","popper-class":"popper-select"},model:{value:t.popoverVisible,callback:function(e){t.popoverVisible=e},expression:"popoverVisible"}},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.dataLoading,expression:"dataLoading"}],staticClass:"aux-table",attrs:{data:t.dataList,border:"",fit:"",stripe:"","max-height":"250"},on:{"row-click":t.onRowClick}},[a("el-table-column",{attrs:{align:"left",label:"商品名称","min-width":"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.name))]}}])}),a("el-table-column",{attrs:{align:"left","min-width":"180",label:"商品条码",prop:"spec"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.code))]}}])}),a("el-table-column",{attrs:{align:"left","min-width":"180",label:"规格/属性",prop:"spec"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.spec_list&&e.row.spec_list.length>0?a("div",{},t._l(e.row.spec_list,(function(e,i){return a("span",{key:i,staticClass:"padding-right-sm"},[t._v(t._s(e.name)+"："+t._s(e.values.join("/")))])})),0):a("div",[t._v(t._s(e.row.spec))])]}}])}),a("el-table-column",{attrs:{width:"100",align:"center",label:"单位",prop:"unit"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.unit_desc?a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.row.unit_desc,placement:"top"}},[a("span",[t._v(" "+t._s(e.row.unit)+" "),a("i",{staticClass:"el-icon-warning-outline"})])]):a("span",[t._v(t._s(e.row.unit))])]}}])}),"bid_price"==t.mainPrice?a("el-table-column",{attrs:{width:"110",align:"right",label:"进货价"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("cent2yuan")(e.row.bid_price)))]}}],null,!1,2056989652)}):t._e(),a("el-table-column",{attrs:{width:"110",align:"right",label:"批发价"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("cent2yuan")(e.row.price)))]}}])}),a("el-table-column",{attrs:{width:"110",align:"right",label:"零售价"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("cent2yuan")(e.row.market_price)))]}}])})],1),a("div",{attrs:{slot:"reference"},slot:"reference"},[a("el-input",{staticClass:"w-full",attrs:{placeholder:"输入商品名称/条码查询",clearable:"",loading:t.dataLoading},on:{input:t.changeInput,focus:t.initLoad},model:{value:t.modelValue,callback:function(e){t.modelValue=e},expression:"modelValue"}})],1)],1),a("AuxGoodsSkuDialog",{ref:"auxGoodsSkuDialog",attrs:{"enable-ok":"","main-price":t.mainPrice}})],1)},n=[],s=(a("99af"),a("d81d"),a("b0c0"),a("a434"),a("2197")),o=a("c031"),l=a("1ea0"),r={name:"AuxGoodsSelect",components:{AuxGoodsSkuDialog:l["a"]},props:{value:{type:[String,Array],default:function(){return""}},mainPrice:{type:String,default:"price"}},data:function(){return{popoverVisible:!1,dataLoading:!1,dataList:[].concat(Object(o["d"])()),modelValue:""}},methods:{initLoad:function(){this.dataList.length>0||this.querySearch()},changeInput:function(t){var e=this;this.inputTimer&&clearTimeout(this.inputTimer),this.inputTimer=setTimeout((function(){e.querySearch(t)}),300)},querySearch:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.dataLoading=!0,Object(s["a"])("goods/list",{pageSize:10,simple:!0,keyword:e},{functionName:"xunda"}).then((function(e){t.dataLoading=!1;var a=e.data||[];t.dataList=a,Object(o["f"])(a)}))},onRowClick:function(t,e){var a=this;this.modelValue=t.goods_id,this.popoverVisible=!1;var i=Object(o["b"])(this.modelValue);i.spec_list&&i.spec_list.length>0?this.$refs.auxGoodsSkuDialog.open({goods:i,confirm:function(t){var e=t.map((function(t){var e=Object.assign({},t);return e._id=i._id,e.name=i.name,e.img=i.img,e.sku_id=t.sku_id,e.unit=t.unit,e.spec=t.spec,e.price=t.price,e.bid_price=t.bid_price,e.market_price=t.market_price,e.min_price=t.min_price,e.scale=t.scale,e}));a.$nextTick((function(){a.$emit("input",a.modelValue),a.$emit("change",{goodsId:a.modelValue,goods:e[0],others:e.splice(1)})}))},cancel:function(){a.$nextTick((function(){a.modelValue="",a.$emit("input",a.modelValue)}))}}):this.$nextTick((function(){a.$emit("input",a.modelValue),a.$emit("change",{goodsId:a.modelValue,goods:i})}))}}},c=r,u=(a("5bc5"),a("2877")),d=Object(u["a"])(c,i,n,!1,null,null,null);e["a"]=d.exports},"1ea0":function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{title:"选择单品",visible:t.dialogVisible,top:"10vh",width:"500","before-close":t.close,"append-to-body":"","custom-class":"goods-sku-dialog"},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("div",{staticClass:"goods-sku-area dflex-s",style:t.styles},[a("div",{staticClass:"goods-img-box"},[a("img",{attrs:{src:t.goods.img||"/static/img/img-empty.png",alt:""}})]),a("div",{staticClass:"goods-sku-content flex1"},[a("div",{staticClass:"title"},[t._v(t._s(t.goods.name))]),(t.goods.unit_list||[]).length>1?a("div",{staticClass:"border-top"},[a("div",{staticClass:"block-title"},[t._v("单位")]),a("div",{staticClass:"block-box"},t._l(t.goods.unit_list,(function(e,i){return a("div",{key:i},[a("div",{staticClass:"item",class:{active:t.form.unit==e.unit},on:{click:function(a){return t.selectGoodsUnit(e,i)}}},[t._v(" "+t._s(e.unit+(e.unit_desc||""))+" ")])])})),0)]):t._e(),a("div",{staticClass:"border-top"}),t._l(t.goods.spec_list,(function(e,i){return a("div",{key:e.name},[a("div",{staticClass:"block-title"},[t._v(t._s(e.name))]),a("div",{staticClass:"block-box"},t._l(e.values,(function(n,s){return a("div",{key:n},[a("div",{staticClass:"item",class:{active:t.isActiveSpec(e,i,n,s),disabled:t.isDisabledSpec(e,i,n,s)},on:{click:function(a){return t.selectGoodsSpec(e,i,n,s)}}},[t._v(" "+t._s(n)+" ")])])})),0)])})),a("div",{staticClass:"select-box"},[(t.goods.unit_list||[]).length>1?a("div",[a("span",{staticClass:"lable"},[t._v("已选单位：")]),a("span",{staticClass:"values"},[t._v(t._s(t.form.unit))])]):t._e(),(t.goods.spec_list||[]).length>0?a("div",[a("span",{staticClass:"lable"},[t._v("已选规格：")]),t.form.skus.length>0?a("span",{staticClass:"values"},[t._v(t._s(t.form.skus.join(" / ")))]):t._e()]):t._e()]),a("div",{staticClass:"bottom-box dflex-b"},[a("div",{staticClass:"price-box"},[t._v("¥"+t._s(t.compPricespan))]),t.enableOk?a("div",{staticClass:"btn-box"},[t.isSelectedOk||t.selectedGoods.length>0?[0==t.selectedGoods.length?a("el-button",{attrs:{type:"default",size:"default",icon:"el-icon-plus"},on:{click:t.handleJoin}},[t._v("加入")]):t._e(),t.selectedGoods.length>0?a("el-button-group",{staticClass:"margin-right"},[a("el-button",{attrs:{type:"default",size:"default",icon:"el-icon-plus"},on:{click:t.handleJoin}},[t._v(" 加入 "),a("span",{staticClass:"badge"},[t._v(t._s(t.selectedGoods.length))])]),a("el-button",{attrs:{type:"default",size:"default",icon:"el-icon-minus"},on:{click:t.handleMinus}})],1):t._e()]:t._e(),a("el-button",{attrs:{type:"default",size:"default"},on:{click:t.handleCancel}},[t._v("取消")]),a("el-button",{attrs:{type:"primary",size:"default"},on:{click:t.handleSubmit}},[t._v("确认选择")])],2):t._e()])],2)])])},n=[],s=a("2909"),o=(a("a9e3"),a("d81d"),a("a15b"),a("d3b7"),a("caad"),a("2532"),a("b0c0"),a("4de4"),a("99af"),{name:"AuxGoodsSkuDialog",props:{enableBuy:{type:Boolean,default:!1},enableOk:{type:Boolean,default:!1},mainPrice:{type:String,default:"price"},marginTop:{type:Number,default:0},styles:{type:Object,default:function(){return{}}}},data:function(){return{dialogVisible:!1,goods:{unit:"",unit_list:[],spec:"",spec_list:"",sku_data:[]},isSelectedOk:!1,selectedGoods:[],form:this.initForm(),confirm:function(){}}},computed:{compPricespan:function(){var t=this.form[this.mainPrice];return this.$common.cent2yuan(t)}},methods:{initForm:function(){return{sku_id:"",unit:"",unit_desc:"",skus:[],spec:"",price:0,bid_price:0,market_price:0,min_price:0,scale:1,number:0}},open:function(t){var e=t.goods,a=t.confirm,i=t.cancel,n=t.initOpts,s=void 0===n?{}:n;(e.unit_prices||[]).length>0&&0===(e.spec_list||[]).length&&0===(e.unit_list||[]).length&&(e.unit_list=e.unit_prices.map((function(t){return{nit:t.unit,scale:t.scale||1}}))),0===(e.sku_datas||[]).length&&(e.unit_prices||[]).length>0&&(e.sku_datas=e.unit_prices),this.goods=e,this.form=Object.assign(this.initForm(),{unit:s.unit||e.unit,skus:s.skus||[]}),this.confirm=a,this.cancel=i,this.selectedGoods=[],this.isSelectedOk=!1,this.dialogVisible=!0,this.changeComplated()},close:function(){this.dialogVisible=!1},selectGoodsUnit:function(t,e){this.form.unit=t.unit,this.form.unit_desc=t.unit_desc,this.form.scale=Number(t.scale||1),this.changeComplated()},selectGoodsSpec:function(t,e,a,i){this.form.skus.length=(this.goods.spec_list||[]).length;var n=this.form.skus[e];this.$set(this.form.skus,e,n!=a?a:""),this.clearSelectData(),this.changeComplated()},isActiveSpec:function(t,e,a,i){return this.form.skus[e]==a},isDisabledSpec:function(t,e,a,i){var n=this.form.skus||[],o=(n.join("/"),this.goods.sku_datas||[]),l=Object(s["a"])(n);l[e]=a;var r=l.join("/"),c=Object(s["a"])(n);c[e]="";var u=n.some((function(t){return!t})),d=o.some((function(t){var i=t.skus[e]==a;if(!i)return!1;if(!n.join(""))return!0;if(!c.join(""))return!0;if(n[e]&&u)return!0;if(!n[e]&&u){var o=Object(s["a"])(n);o[e]=a;for(var d=0;d<l.length;d++)o[d]||(o[d]=t.skus[d]);var f=o.join("/");return t.name.includes(f)}return t.name.includes(r)}));return!d},changeComplated:function(){var t=this.goods,e=t.unit,a=t.unit_list||[],i=t.spec_list||[],n=t.sku_datas||[],s=a.length>1,o=i.length>0,l=this.form,r=l.unit,c=l.skus,u=void 0===c?[]:c;if(this.form.spec=u.join("/"),s||o||this.updateFormData(t),!s&&o&&u.length>0){var d=u.join("/"),f=n.filter((function(t){return t.name==d}));if(f.length>0){if(1!=f.length)throw"2.发现异常，当前规格的单品存在多个金额，规格：".concat(d);this.updateFormData(f[0])}}if(s&&!o)if(r==e)this.updateFormData(t);else{var h=n.filter((function(t){return t.unit==r}));if(0==h.length){var p=a.filter((function(t){return t.unit==r})),m=p[0].scale||1;this.updateFormData(t,m)}1==h.length&&this.updateFormData(h[0])}if(s&&o&&u.length>0){var g=u.join("/"),v=n.filter((function(t){return t.name==g})),b=v.filter((function(t){return t.unit==r}));if(b.length>0){if(1!=b.length)throw"4.1发现异常，当前规格的单品存在多个金额，单位：".concat(r,", 规格：").concat(g);this.updateFormData(b[0])}else if(v.length>0){var _=v.filter((function(t){return t.unit==e}));if(1!=_.length)throw"4.2发现异常，当前规格的单品存在多个金额，单位：".concat(r,", 规格：").concat(g);var k=a.filter((function(t){return t.unit==r})),x=k[0].scale||1;this.updateFormData(_[0],x)}}},clearSelectData:function(){var t=this.form,e=t.unit,a=t.skus;this.form=Object.assign(this.initForm(),{unit:e,skus:a}),this.isSelectedOk=!1},updateFormData:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=["price","market_price","bid_price","min_price"];i.forEach((function(i){e.$set(e.form,i,(t[i]||0)*a)})),this.form.sku_id=t.sku_id||"",this.form.spec=t.name,this.isSelectedOk=!0},handleSubmit:function(){var t=this;try{this.confirm&&(this.selectedGoods.length>0?this.confirm(Object(s["a"])(this.selectedGoods)):this.validateForm((function(){t.confirm([t.form])}))),this.close()}catch(e){this.$message.error(e.message||e)}},handleJoin:function(){var t=this;try{this.validateForm((function(){var e=Object.assign({},t.form);t.selectedGoods.push(e)}))}catch(e){this.$message.error(e.message||e)}},handleJoinAll:function(){},handleMinus:function(){this.selectedGoods.length>0&&this.selectedGoods.pop()},validateForm:function(t){var e=this.form,a=(e.unit,e.skus);if(!this.isSelectedOk){if(0==a.length||a.indexOf("")>-1)throw new Error("请选择单位及规格");return this.$confirm("该单品缺失，确定要选择？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t()})),!1}t()},handleCancel:function(){this.dialogVisible=!1,this.cancel&&this.cancel()}}}),l=o,r=(a("21c0"),a("2877")),c=Object(r["a"])(l,i,n,!1,null,null,null);e["a"]=c.exports},2051:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-select",{staticClass:"w-full",attrs:{filterable:"",placeholder:"输入客户名称/联系人/电话查询",loading:t.loading,clearable:!0,remote:"","remote-method":t.remoteMethod},on:{change:t.change,focus:t.initLoad},model:{value:t.modelValue,callback:function(e){t.modelValue=e},expression:"modelValue"}},t._l(t.dataList,(function(t){return a("el-option",{key:t._id,attrs:{label:t.name,value:t._id}})})),1)],1)},n=[],s=(a("99af"),a("4de4"),a("d3b7"),a("2197")),o=(a("d81d"),a("159b"),a("caad"),a("2532"),[]);function l(t){var e=o.map((function(t){return t._id}));t.filter((function(t){return!e.includes(t._id)})).forEach((function(t){return o.push(t)}))}var r={name:"AuxSelectStore",props:{value:{type:[String,Array],default:function(){return""}},multi:Boolean},data:function(){return{loading:!1,dataList:[].concat(o),modelValue:""}},watch:{value:{handler:function(t,e){this.modelValue=t,0===this.dataList.length&&t&&this.loadStore(t)},immediate:!0}},methods:{initLoad:function(){this.dataList.length>0||this.fetchData()},fetchData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.loading=!0,Object(s["a"])("store/listStore",{pageSize:12,simple:!0,keyword:e},{functionName:"xunda"}).then((function(e){t.loading=!1;var a=e.data||[];l(a),t.dataList=a}))},loadStore:function(t){var e=this;Object(s["a"])("store/getStore",{storeId:t},{functionName:"xunda"}).then((function(t){e.dataList=[t.data]}))},remoteMethod:function(t){var e=this;t&&""!==t?this.$common.debounce((function(){return e.fetchData(t)}),200)():this.dataList=[]},change:function(){var t=this;this.$nextTick((function(){if(t.$emit("input",t.modelValue),!t.multi){var e=t.dataList.filter((function(e){return e._id==t.modelValue}));e.length>0&&t.$emit("change",e[0])}}))}}},c=r,u=a("2877"),d=Object(u["a"])(c,i,n,!1,null,null,null);e["a"]=d.exports},"21c0":function(t,e,a){"use strict";a("4342")},3796:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"excel-upload"},[a("input",{ref:"upload-input",staticClass:"upload-input",attrs:{type:"file",accept:".xlsx, .xls"},on:{change:t.handleClick}}),a("div",{staticClass:"drop-box",on:{drop:t.handleDrop,dragover:t.handleDragover,dragenter:t.handleDragover,click:t.handleUpload}},[a("div",{staticClass:"icon el-icon-upload"}),a("div",{staticClass:"txt fs"},[t._v("点击或将文件拖拽到这里上传")]),a("div",{staticClass:"tip fs-xs"},[t._v("仅支持xlsx/xls/csv文件，且不超过1M")])])])},n=[],s=(a("a9e3"),a("d3b7"),a("ac1f"),a("00b4"),a("b0c0"),a("25ca")),o={props:{skinRow:{type:Number,default:1},beforeUpload:Function,onSuccess:Function,onError:Function},data:function(){return{loading:!1,excelData:{header:null,results:null}}},methods:{generateData:function(t){var e=t.header,a=t.results;this.excelData.header=e,this.excelData.results=a,this.onSuccess&&this.onSuccess(this.excelData)},handleDrop:function(t){if(t.stopPropagation(),t.preventDefault(),!this.loading){var e=t.dataTransfer.files;if(1===e.length){var a=e[0];if(!this.isExcel(a))return this.$message.error("仅支持 .xlsx, .xls, .csv文件类型"),!1;this.upload(a),t.stopPropagation(),t.preventDefault()}else this.$message.error("只支持上传一个文件！")}},handleDragover:function(t){t.stopPropagation(),t.preventDefault(),t.dataTransfer.dropEffect="copy"},handleUpload:function(){this.$refs["upload-input"].click()},handleClick:function(t){var e=t.target.files,a=e[0];a&&this.upload(a)},upload:function(t){if(this.$refs["upload-input"].value=null,this.beforeUpload){var e=this.beforeUpload(t);e&&this.readerData(t)}else this.readerData(t)},readerData:function(t){var e=this,a=this;return this.loading=!0,new Promise((function(i,n){var o=new FileReader;o.onload=function(t){try{var o=t.target.result;console.log(s);var l=s["read"](o,{type:"array"}),r=l.SheetNames[0],c=l.Sheets[r],u=e.getHeaderRow(c),d={range:a.skinRow,defval:""},f=s["utils"].sheet_to_json(c,d);e.generateData({header:u,results:f}),e.loading=!1,i()}catch(h){n(h),e.onError&&e.onError(h),e.$message.error("Excel文件解析失败"),e.loading=!1}},o.readAsArrayBuffer(t)}))},getHeaderRow:function(t){var e,a=[],i=s["utils"].decode_range(t["!ref"]),n=i.s.r+this.skinRow;for(e=i.s.c;e<=i.e.c;++e){var o=t[s["utils"].encode_cell({c:e,r:n})],l=" ";o&&o.t&&(l=s["utils"].format_cell(o)),a.push(l)}return a},isExcel:function(t){return/\.(xlsx|xls|csv)$/.test(t.name)}}},l=o,r=(a("566b"),a("2877")),c=Object(r["a"])(l,i,n,!1,null,"a5ed51f2",null);e["a"]=c.exports},"3d4e":function(t,e,a){"use strict";a("dcfc")},4342:function(t,e,a){},"566b":function(t,e,a){"use strict";a("c604")},"5bc5":function(t,e,a){"use strict";a("f050")},"64f8":function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-button",{attrs:{type:"default",icon:"el-icon-tickets",loading:t.dataLoading},on:{click:t.generate}},[t.dataLoading?a("span",[t._v("正在导出("+t._s(t.dataProgress?t.dataProgress+"%":"...")+")")]):a("span",[t._v("导出")])])},n=[],s=a("b85c"),o=a("53ca"),l=a("c7eb"),r=a("1da1"),c=(a("a9e3"),a("ac1f"),a("5319"),a("b0c0"),a("b64b"),a("d81d"),a("466d"),a("a15b"),a("2ca0"),a("ace4"),a("d3b7"),a("8a59"),a("9a8c"),a("a975"),a("735e"),a("c1ac"),a("d139"),a("3a7b"),a("d5d6"),a("82f8"),a("e91f"),a("60bd"),a("5f96"),a("3280"),a("3fcc"),a("ca91"),a("25a1"),a("cd26"),a("3c5d"),a("2954"),a("649e"),a("219c"),a("170b"),a("b39a"),a("72f7"),a("a1b8")),u={name:"DownloadExcel",props:{type:{type:String,default:"xls"},data:{type:Array,required:!1,default:null},fields:{type:Object,default:function(){return null}},exportFields:{type:Object,default:function(){return null}},defaultValue:{type:String,required:!1,default:""},header:{default:null},footer:{default:null},name:{type:String,default:"data.xls"},fetch:{type:Function},progress:{type:Number,default:0},meta:{type:Array,default:function(){return[]}},worksheet:{type:String,default:"Sheet1"},beforeGenerate:{type:Function},beforeFinish:{type:Function},escapeCsv:{type:Boolean,default:!0},stringifyLongNum:{type:Boolean,default:!1}},data:function(){return{dataLoading:!1,dataProgress:0}},computed:{idName:function(){var t=(new Date).getTime();return"export_"+t},downloadFields:function(){return this.fields?this.fields:this.exportFields?this.exportFields:void 0}},watch:{progress:{immediate:!0,handler:function(t,e){e!=t&&(this.dataProgress=t)}}},methods:{generate:function(){var t=this;return Object(r["a"])(Object(l["a"])().mark((function e(){var a,i;return Object(l["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.dataLoading){e.next=2;break}return e.abrupt("return");case 2:if(t.dataLoading=!0,"function"!==typeof t.beforeGenerate){e.next=6;break}return e.next=6,t.beforeGenerate();case 6:if(a=t.data,"function"!==typeof t.fetch&&a){e.next=11;break}return e.next=10,t.fetch();case 10:a=e.sent;case 11:if(setTimeout((function(){t.dataProgress=0,t.dataLoading=!1}),300),a&&a.length){e.next=14;break}return e.abrupt("return");case 14:if(i=t.getProcessedJson(a,t.downloadFields),"html"!==t.type){e.next=20;break}return e.abrupt("return",t.export(t.jsonToXLS(i),t.name.replace(".xls",".html"),"text/html"));case 20:if("csv"!==t.type){e.next=22;break}return e.abrupt("return",t.export(t.jsonToCSV(i),t.name.replace(".xls",".csv"),"application/csv"));case 22:return e.abrupt("return",t.export(t.jsonToXLS(i),t.name,"application/vnd.ms-excel"));case 23:case"end":return e.stop()}}),e)})))()},export:function(){var t=Object(r["a"])(Object(l["a"])().mark((function t(e,a,i){var n;return Object(l["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=this.base64ToBlob(e,i),"function"!==typeof this.beforeFinish){t.next=4;break}return t.next=4,this.beforeFinish();case 4:Object(c["a"])(n,a,i);case 5:case"end":return t.stop()}}),t,this)})));function e(e,a,i){return t.apply(this,arguments)}return e}(),jsonToXLS:function(t){var e='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><meta name=ProgId content=Excel.Sheet> <meta name=Generator content="Microsoft Excel 11"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">\x3c!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>${worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--\x3e<style>br {mso-data-placement: same-cell;}</style></head><body><table>${table}</table></body></html>',a="<thead>",i=Object.keys(t[0]).length,n=this,s=this.header||this.$attrs.title;for(var o in s&&(a+=this.parseExtraData(s,'<tr><th colspan="'+i+'">${data}</th></tr>')),a+="<tr>",t[0])a+="<th>"+o+"</th>";return a+="</tr>",a+="</thead>",a+="<tbody>",t.map((function(t,e){for(var i in a+="<tr>",t)a+="<td>"+n.preprocessLongNum(n.valueReformattedForMultilines(t[i]))+"</td>";a+="</tr>"})),a+="</tbody>",null!=this.footer&&(a+="<tfoot>",a+=this.parseExtraData(this.footer,'<tr><td colspan="'+i+'">${data}</td></tr>'),a+="</tfoot>"),e.replace("${table}",a).replace("${worksheet}",this.worksheet)},jsonToCSV:function(t){var e=this,a=[],i=this.header||this.$attrs.title;for(var n in i&&a.push(this.parseExtraData(i,"${data}\r\n")),t[0])a.push(n),a.push(",");return a.pop(),a.push("\r\n"),t.map((function(t){for(var i in t){var n=t[i]+"";e.escapeCsv&&(n='="'+n+'"',n.match(/[,"\n]/)&&(n='"'+n.replace(/\"/g,'""')+'"')),a.push(n),a.push(",")}a.pop(),a.push("\r\n")})),null!=this.footer&&a.push(this.parseExtraData(this.footer,"${data}\r\n")),a.join("")},getProcessedJson:function(t,e){var a=this.getKeys(t,e),i=[],n=this;return t.map((function(t,e){var s={};for(var o in a){var l=a[o];s[o]=n.getValue(l,t)}i.push(s)})),i},getKeys:function(t,e){if(e)return e;var a={};for(var i in t[0])a[i]=i;return a},parseExtraData:function(t,e){var a="";if(Array.isArray(t))for(var i=0;i<t.length;i++)t[i]&&(a+=e.replace("${data}",t[i]));else a+=e.replace("${data}",t);return a},getValue:function(t,e){var a="object"!==Object(o["a"])(t)?t:t.field,i="string"!==typeof a?[]:a.split("."),n=this.defaultValue;return n=a?i.length>1?this.getValueFromNestedItem(e,i):this.parseValue(e[a]):e,t.hasOwnProperty("callback")&&(n=this.getValueFromCallback(n,t.callback)),n},valueReformattedForMultilines:function(t){return"string"===typeof t?t.replace(/\n/gi,"<br/>"):t},preprocessLongNum:function(t){if(this.stringifyLongNum){if(String(t).startsWith("0x"))return t;if(!isNaN(t)&&""!=t&&(t>99999999999||t<1e-13))return'="'+t+'"'}return t},getValueFromNestedItem:function(t,e){var a,i=t,n=Object(s["a"])(e);try{for(n.s();!(a=n.n()).done;){var o=a.value;i&&(i=i[o])}}catch(l){n.e(l)}finally{n.f()}return this.parseValue(i)},getValueFromCallback:function(t,e){if("function"!==typeof e)return this.defaultValue;var a=e(t);return this.parseValue(a)},parseValue:function(t){return t||0===t||"boolean"===typeof t?t:this.defaultValue},base64ToBlob:function(t,e){var a=window.btoa(window.unescape(encodeURIComponent(t))),i=atob(a),n=i.length,s=new Uint8ClampedArray(n);while(n--)s[n]=i.charCodeAt(n);return new Blob([s],{type:e})}}},d=u,f=(a("3d4e"),a("2877")),h=Object(f["a"])(d,i,n,!1,null,null,null);e["a"]=h.exports},b122:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{title:"选择商品",visible:t.dialogVisible,top:"2vh",width:"75%","before-close":t.close,"append-to-body":"","custom-class":"goodsSelectDialog"},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("div",{staticClass:"dialog-warpper"},[a("div",{staticClass:"dflex-b padding-bottom-sm"},[a("div"),a("div",{staticClass:"dflex"},[a("el-input",{staticStyle:{width:"360px"},attrs:{"prefix-icon":"el-icon-search",clearable:"",placeholder:"输入商品名称、编号按回车键搜索"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.fetchDataList(e)}},model:{value:t.reqData.keyword,callback:function(e){t.$set(t.reqData,"keyword",e)},expression:"reqData.keyword"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:t.handleSearch},slot:"append"})],1)],1)]),a("div",{staticClass:"dflex-s"},[a("div",{staticClass:"category"},[a("div",{staticClass:"title-box dflex-b"},[a("div",{staticClass:"padding"},[t._v("商品分类")])]),a("div",{staticClass:"cate-list"},[a("div",{staticClass:"item padding-sm",class:{active:""==t.reqData.cid},on:{click:function(e){return t.changeCategory()}}},[a("span",[t._v("全部分类")])]),t._l(t.categoryList,(function(e,i){return a("div",{key:e._id,staticClass:"item padding-sm",class:{active:t.reqData.cid==e._id},on:{click:function(a){return t.changeCategory(e)}}},[a("span",[t._v(t._s(e.name))])])}))],2)]),a("div",{staticClass:"flex1"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.dataLoading,expression:"dataLoading"}],attrs:{data:t.dataList,border:"",fit:"",stripe:""}},[a("el-table-column",{attrs:{type:"index",width:"55",align:"center",label:"序号"}}),a("el-table-column",{attrs:{width:"110",align:"center",label:"数量",prop:"code"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{class:{"is-active":e.row.goods_cnt>0}},[a("el-input",{key:e.row.goods_id,staticClass:"tac",attrs:{oninput:"value=value.match(/^-?\\d+(?:\\.\\d{0,2})?/)",placeholder:"数量"},on:{focus:function(a){return t.handleItemNumberFocus(e.row,e.$index)},change:function(a){return t.handleItemNumberChange(e.row,e.$index)}},model:{value:e.row.goods_cnt,callback:function(a){t.$set(e.row,"goods_cnt",a)},expression:"scope.row.goods_cnt"}})],1)]}}])}),a("el-table-column",{attrs:{align:"left",label:"商品名称"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"dflex"},[a("el-avatar",{attrs:{shape:"square",size:40,fit:"cover",src:e.row.img||"/static/img/img-empty.png"}}),a("div",{staticClass:"padding-left-sm"},[a("div",[t._v(t._s(e.row.name))]),e.row.code?a("div",{staticClass:"ft-grey fs-xs"},[t._v("No."+t._s(e.row.code))]):t._e()])],1)]}}])}),a("el-table-column",{attrs:{align:"left",label:"规格属性",prop:"spec"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.spec_list&&e.row.spec_list.length>0?a("div",{},t._l(e.row.spec_list,(function(e,i){return a("div",{key:i,staticClass:"padding-right-sm"},[t._v(t._s(e.name)+"："+t._s(e.values.join("/")))])})),0):t._e(),a("div",[t._v(t._s(e.row.spec||""))])]}}])}),a("el-table-column",{attrs:{width:"100",align:"center",label:"基本单位",prop:"unit"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",[t._v(t._s(e.row.unit))])]}}])}),a("el-table-column",{attrs:{width:"120",align:"right",label:"批发价(元)"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("cent2yuan")(e.row.price)))]}}])}),a("el-table-column",{attrs:{width:"120",align:"right",label:"零售价(元)"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("cent2yuan")(e.row.market_price)))]}}])}),a("el-table-column",{attrs:{width:"120",align:"right",label:"可用库存"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.stock_num))]}}])})],1)],1)])]),a("div",{staticClass:"dflex-b border-top padding-top-sm",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["goods-edit"],expression:"['goods-edit']"}],attrs:{type:"default",icon:"el-icon-plus"},on:{click:t.toAddGoodsPage}},[t._v("新增商品")]),a("el-pagination",{attrs:{background:"","page-size":t.pagination.pageSize,total:t.pagination.totalCount,"current-page":t.pagination.pageNo,"page-sizes":[10,15,20,30,50],layout:"total, prev, pager, next, sizes","hide-on-single-page":""},on:{"size-change":t.changePageSize,"current-change":t.changePageNo}}),a("div",[a("el-button",{on:{click:t.close}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.handleSubmit}},[t._v("确定提交")])],1)],1),a("AuxGoodsSkuDialog",{ref:"auxGoodsSkuDialog",attrs:{"enable-ok":"","main-price":t.mainPrice}})],1)},n=[],s=a("2909"),o=(a("d3b7"),a("159b"),a("d81d"),a("b64b"),a("a9e3"),a("b0c0"),a("4de4"),a("2197")),l=a("1ea0"),r=a("c031"),c={components:{AuxGoodsSkuDialog:l["a"]},props:{mainPrice:{type:String,default:"price"}},data:function(){return{dialogVisible:!1,cateParentId:"",categoryList:Object(s["a"])(Object(r["c"])()),dataLoading:!1,dataList:[],pagination:{totalCount:1,pageSize:10,pageNo:1},reqData:{cid:"",keyword:""},selectedGoodsMap:{},selectedGoodsIds:[]}},methods:{open:function(){this.dialogVisible=!0,0==this.categoryList.length&&this.fetchCategory(),0==this.dataList.length?this.fetchDataList():this.dataList.forEach((function(t){return t.goods_cnt=""})),this.selectedGoodsMap={},this.selectedGoodsIds=[]},close:function(){this.dialogVisible=!1},fetchCategory:function(){var t=this;Object(o["a"])("goods/listGoodsCategory",{parentId:this.cateParentId},{functionName:"xunda"}).then((function(e){t.categoryList=e.data||[],Object(r["e"])(t.categoryList)}))},fetchDataList:function(){var t=this;this.dataLoading=!0;var e=Object.assign({},this.getReqData(),this.pagination);Object(o["a"])("goods/list",e,{functionName:"xunda"}).then((function(e){t.dataLoading=!1;var a=e.data||[];Object(r["f"])(a),t.dataList=a.map((function(e){return e.goods_cnt=t.getCacheGoodsCount(e),e})),1===t.pagination.pageNo&&(t.pagination.totalCount=e.totalCount)}))},getCacheGoodsCount:function(t){var e=this.selectedGoodsMap[t.goods_id]||[];return e.length>0?e[0].goods_cnt:""},addSelected:function(t){this.selectedGoodsMap[t.goods_id]||(this.selectedGoodsMap[t.goods_id]=[]),this.selectedGoodsMap[t.goods_id].push(t),this.selectedGoodsIds=Object.keys(this.selectedGoodsMap)},removeSelected:function(t){delete this.selectedGoodsMap[t],this.selectedGoodsIds=Object.keys(this.selectedGoodsMap)},handleItemNumberChange:function(t,e){var a=Number(t.goods_cnt);if(0!==a){var i=this.selectedGoodsMap[t.goods_id]||[];if(0==i.length){var n=Object.assign({},t);n.name=t.name,n.img=t.img,n.sku_id="",n.remark="",n.goods_cnt=a,this.addSelected(n)}else i.forEach((function(t){return t.goods_cnt=a}))}else this.removeSelected(t.goods_id)},handleItemNumberFocus:function(t){var e=this;if(!(t.goods_cnt>0)&&t.spec_list&&0!==t.spec_list.length){var a=Object(r["b"])(t.goods_id);this.$refs.auxGoodsSkuDialog.open({goods:a,confirm:function(i){i.map((function(t){var e=Object.assign({},t);return e._id=a._id,e.name=a.name,e.img=a.img,e.sku_id=t.sku_id,e.unit=t.unit,e.spec=t.spec,e.price=t.price,e.bid_price=t.bid_price,e.market_price=t.market_price,e.min_price=t.min_price,e.scale=t.scale,e.goods_id=a._id,e.goods_cnt=1,e})).forEach((function(t){return e.addSelected(t)})),t.goods_cnt=1}})}},getGoodsUnitSelectOptions:function(t){var e=t.unit_list||[];if(e.length>0){var a=e[0],i=[{label:"基本单位",children:[a]}],n=t.unit_list.filter((function(t){return t.unit!==a.unit}));return n.length>0&&i.push({label:"辅助单位",children:n}),i}},getReqData:function(){return Object.assign({showStock:!0},this.reqData)},handleSearch:function(){this.fetchDataList()},changePageNo:function(t){this.pagination.pageNo=t,this.fetchDataList()},changePageSize:function(t){this.pagination.pageNo=1,this.pagination.pageSize=t,this.fetchDataList()},changeCategory:function(t){this.reqData.cid=t?t._id:"",this.pagination.pageNo=1,this.fetchDataList()},handleSubmit:function(){var t=this,e=[];this.selectedGoodsIds.forEach((function(a){e.push.apply(e,Object(s["a"])(t.selectedGoodsMap[a]))})),this.$emit("onSuccess",e),this.close()},toAddGoodsPage:function(){this.close(),this.$common.toPage("/goods/goods-create")}}},u=c,d=(a("031e"),a("2877")),f=Object(d["a"])(u,i,n,!1,null,null,null);e["a"]=f.exports},b866:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"w-full"},[a("el-select",{staticClass:"w-full",attrs:{filterable:"",placeholder:"请选择成员",clearable:!0,multiple:t.multi},on:{change:t.change,focus:t.initLoad},model:{value:t.modelValue,callback:function(e){t.modelValue=e},expression:"modelValue"}},t._l(t.dataList,(function(t){return a("el-option",{key:t.value,attrs:{label:t.name,value:t.value}})})),1)],1)},n=[],s=(a("d81d"),a("b0c0"),a("4de4"),a("d3b7"),a("2197")),o={name:"AuxSelectMember",props:{value:{type:[String,Array],default:function(){return[]}},multi:Boolean},data:function(){return{dataList:[],modelValue:[]}},watch:{value:{handler:function(t,e){this.modelValue=t,0===this.dataList.length&&t&&this.fetchData(t)},immediate:!0}},methods:{initLoad:function(){0===this.dataList.length&&this.fetchData()},fetchData:function(){var t=this;Object(s["a"])("member/listMember",{pageSize:100,simple:!0},{functionName:"xunda"}).then((function(e){var a=(e.data||[]).map((function(t){return t.name=t.member_name,t.value=t._id,t}));t.dataList=a}))},change:function(){var t=this;this.$nextTick((function(){if(t.$emit("input",t.modelValue),!t.multi){var e=t.dataList.filter((function(e){return e._id==t.modelValue}));e.length>0&&t.$emit("change",e[0])}}))}}},l=o,r=a("2877"),c=Object(r["a"])(l,i,n,!1,null,null,null);e["a"]=c.exports},be53:function(t,e,a){},c3dd:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"w-full"},[a("el-select",{staticClass:"w-full",attrs:{filterable:"",placeholder:"请选择商品仓库",clearable:!0,multiple:t.multi,loading:t.loading},on:{change:t.change,focus:t.initLoad},model:{value:t.modelValue,callback:function(e){t.modelValue=e},expression:"modelValue"}},t._l(t.dataList,(function(t){return a("el-option",{key:t.value,attrs:{label:t.name,value:t.value}})})),1)],1)},n=[],s=(a("d81d"),a("b0c0"),a("2197")),o={name:"AuxSelectWarehouse",props:{value:{type:[String,Array],default:function(){return[]}},multi:Boolean},data:function(){return{loading:!1,dataList:[],modelValue:[]}},methods:{initLoad:function(){0===this.dataList.length&&this.fetchData()},fetchData:function(){var t=this;Object(s["a"])("stock/listWarehouse",{pageSize:20,simple:!0},{functionName:"xunda"}).then((function(e){t.dataList=(e.data||[]).map((function(t){return t.text=t.name,t.value=t._id,t}))}))},change:function(){var t=this;this.$nextTick((function(){t.$emit("input",t.modelValue),t.$emit("change",t.modelValue)}))}}},l=o,r=a("2877"),c=Object(r["a"])(l,i,n,!1,null,null,null);e["a"]=c.exports},c604:function(t,e,a){},d262:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-select",{staticClass:"w-full",attrs:{filterable:"",placeholder:"输入供应商名称/联系人/电话查询",clearable:!0},on:{change:t.change,focus:t.initLoad},model:{value:t.modelValue,callback:function(e){t.modelValue=e},expression:"modelValue"}},t._l(t.dataList,(function(t){return a("el-option",{key:t._id,attrs:{label:t.name,value:t._id}})})),1)},n=[],s=(a("4de4"),a("d3b7"),a("2197")),o={name:"AuxSelectSupplier",props:{value:{type:[String,Array],default:function(){return""}},multi:Boolean},data:function(){return{loading:!1,dataList:[],modelValue:""}},watch:{value:{handler:function(t,e){this.modelValue=t,0===this.dataList.length&&t&&this.fetchData()},immediate:!0}},methods:{initLoad:function(){this.fetchData()},fetchData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";Object(s["a"])("supplier/listSupplier",{pageSize:12,simple:!0,keyword:e},{functionName:"xunda"}).then((function(e){t.loading=!1,t.dataList=e.data||[]}))},change:function(){var t=this;this.$nextTick((function(){if(t.$emit("input",t.modelValue),!t.multi){var e=t.dataList.filter((function(e){return e._id==t.modelValue}));e.length>0&&t.$emit("change",e[0])}}))}}},l=o,r=a("2877"),c=Object(r["a"])(l,i,n,!1,null,null,null);e["a"]=c.exports},dcfc:function(t,e,a){},f050:function(t,e,a){},f63d:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-cascader",{staticClass:"w-full",attrs:{options:t.treeList,props:{expandTrigger:"hover"},clearable:"",placeholder:"选择查询区域"},on:{change:t.change,focus:t.initLoad},model:{value:t.modelValue,callback:function(e){t.modelValue=e},expression:"modelValue"}})},n=[],s=(a("d81d"),a("b0c0"),a("4de4"),a("d3b7"),a("159b"),a("caad"),a("2532"),a("2197")),o={name:"AuxPickerArea",props:{value:{type:Array,default:function(){return[]}}},data:function(){return{dataList:[],treeList:[],modelValue:[]}},watch:{value:{handler:function(t,e){this.modelValue=t,this.fetchData()},immediate:!0}},methods:{initLoad:function(){0===this.dataList.length&&this.fetchData()},fetchData:function(){var t=this;Object(s["a"])("area/listAreaAll",{},{functionName:"xunda"}).then((function(e){var a=(e.data||[]).map((function(t){return t.label=t.name,t.value=t._id,t}));t.dataList=a,t.treeList=t.buildTree(a,"")}))},buildTree:function(t,e){var a=this,i=t.filter((function(t){return e==t.parent_id})).map((function(t){return Object.assign({},t)}));return i.forEach((function(e){var i=a.buildTree(t,e._id);i&&i.length>0&&(e.children=i)})),i},change:function(t){var e=this;this.$nextTick((function(){e.$emit("input",t);var a=e.dataList.filter((function(e){return t.includes(e.value)}));e.$emit("change",a)}))}}},l=o,r=a("2877"),c=Object(r["a"])(l,i,n,!1,null,null,null);e["a"]=c.exports}}]);