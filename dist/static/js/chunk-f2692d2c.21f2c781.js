(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f2692d2c"],{"0ccc":function(t,e,s){},1761:function(t,e,s){"use strict";s("18ec")},"18ec":function(t,e,s){},"378e":function(t,e,s){"use strict";s("0ccc")},"3f89":function(t,e,s){"use strict";s("b64b"),s("e9c4");var a=s("2f62");e["a"]=new a["a"].Store({state:{controlsValue:{showTitle:!0,title:"",showSubTitle:!1,subTitle:"(销售单)",showRemark:!0,showExplain:!0,explainText:"注意：送货单中所列货物之数量、质量及单价请及时核验，确认无误后签收，感谢您的支持与配合。",expandText:""}},mutations:{load:function(t,e){var s=localStorage.getItem("app-print-xsd-"+e);s&&(t.controlsValue=Object.assign(t.controlsValue,JSON.parse(s)))},save:function(t,e){localStorage.setItem("app-print-xsd-"+e,JSON.stringify(t.controlsValue))}},getters:{}})},5066:function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"goodsTable",staticClass:"aux-table no-border",attrs:{data:t.goodsList,border:"",fit:"","show-summary":"","summary-method":t.summaryMethod}},[s("el-table-column",{attrs:{type:"index",width:"60",align:"center",label:"序号"}}),s("el-table-column",{attrs:{width:"300",align:"left",label:"商品名称"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("div",{staticClass:"dflex"},[e.row.goods_img?s("div",{staticClass:"goods-img"},[s("img",{attrs:{src:e.row.goods_img,mode:"widthFix"}})]):t._e(),s("div",[s("div",[t._v(t._s(e.row.goods_name))]),e.row.goods_no?s("div",{staticClass:"fs-xs ft-grey"},[t._v("No："+t._s(e.row.goods_no))]):t._e()])])]}}])}),s("el-table-column",{attrs:{width:"160",align:"center",label:"规格/属性"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.goods_spec))]}}])}),s("el-table-column",{attrs:{width:"120",align:"center",label:"单位"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.goods_unit))]}}])}),s("el-table-column",{attrs:{width:"120",align:"center",label:"数量",prop:"goods_cnt"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.goods_cnt))]}}])}),s("el-table-column",{attrs:{width:"140",align:"right",label:"原价(元)"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.goods_ori_price))]}}])}),s("el-table-column",{attrs:{width:"140",align:"right",label:"折扣(%)"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.goods_rate))]}}])}),s("el-table-column",{attrs:{width:"140",align:"right",label:"单价(元)"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.goods_price))]}}])}),s("el-table-column",{attrs:{width:"140",align:"right",label:"金额小计(元)",prop:"total_money"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.total_money))]}}])}),s("el-table-column",{attrs:{align:"left",label:"备注","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.remark))]}}])})],1)},n=[],o=(s("d81d"),s("d3b7"),s("159b"),s("caad"),s("a9e3"),s("13d5"),s("b680"),{props:{data:{type:Array,default:function(){return[]}},loading:{type:Boolean,default:!1}},data:function(){return{goodsList:[],goodsTotalCount:0,goodsOriginalMoney:0,goodsDiscountMoney:0,goodsTotalMoney:0}},watch:{data:{handler:function(t,e){this.initData(t)},immediate:!0}},methods:{initData:function(t){var e=this;this.goodsList=t.map((function(t){return e.formatItemGoods(t)}))},formatItemGoods:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t},summaryMethod:function(t){var e=t.columns,s=t.data,a=[];return e.forEach((function(t,e){if(0!==e)if(["goods_cnt","total_money"].includes(t.property)){var n=s.map((function(e){return Number(e[t.property])}));n.every((function(t){return isNaN(t)}))?a[e]="":(a[e]=n.reduce((function(t,e){return t+e}),0),["total_money"].includes(t.property)&&(a[e]=a[e].toFixed(2)))}else a[e]=" ";else a[e]="合计"})),a}}}),i=o,r=(s("378e"),s("2877")),l=Object(r["a"])(i,a,n,!1,null,null,null);e["a"]=l.exports},bb26:function(t,e,s){},d4fc:function(t,e,s){"use strict";s("bb26")},e241:function(t,e,s){"use strict";s("fc2f")},f9b2:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"app-container"},[s("div",{staticClass:"aux-card"},[s("div",{staticClass:"header",staticStyle:{"padding-bottom":"0","padding-top":"6px"}},[s("div",{staticClass:"left"},[s("el-menu",{staticClass:"el-menu-big no-border",attrs:{"default-active":t.navActive,mode:"horizontal"},on:{select:t.changeTabSelect}},t._l(t.compNavMenus,(function(e){return s("el-menu-item",{key:e.value,attrs:{index:e.value,disabled:!t.detail.state&&["stock","sign"].includes(e.value)}},[t._v(t._s(e.name))])})),1)],1),s("div",{staticClass:"right"},[s("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["sales-orders-print"],expression:"['sales-orders-print']"}],attrs:{loading:t.pdfBuildProgress>0&&t.pdfBuildProgress<100,disabled:t.dataLoading,type:"default",icon:"el-icon-printer"},on:{click:t.handlePrint}},[t._v(" "+t._s(t.pdfBuildProgress>0&&t.pdfBuildProgress<100?"正在生成("+t.pdfBuildProgress+"%)":"打印")+" ")]),t.$hasPermission("sales-orders-create")?s("el-button",{attrs:{type:"default",icon:"el-icon-document-copy"},on:{click:function(e){t.$common.toPage("/sales/orders/orders-create?type=copyAdd&id="+t.ordersId+"&t="+Date.now())}}},[t._v("复制")]):t._e(),t.allowEditOrders(t.detail)?s("el-button",{attrs:{type:"success",icon:"el-icon-edit"},on:{click:function(e){t.$common.toPage("/sales/orders/orders-create?type=edit&id="+t.ordersId+"&t="+Date.now())}}},[t._v("修改")]):t._e(),0==t.detail.state&&t.$hasPermission("sales-orders-approve")?s("el-button",{attrs:{type:"primary",icon:"el-icon-document-checked"},on:{click:t.approvedOrders}},[t._v("审核通过")]):t._e(),2==t.detail.state&&t.$hasPermission("sales-orders-deliver")?s("el-button",{attrs:{type:"primary",icon:"el-icon-document-checked"},on:{click:t.deliverOrders}},[t._v("发货完成")]):t._e(),t.detail.state>1&&9!=t.detail.state&&t.$hasPermission("sales-orders-complete")&&([3,4].includes(t.detail.state)||!t.$hasModule("stock"))?s("el-button",{attrs:{type:"primary",icon:"el-icon-document-checked"},on:{click:t.completedOrders}},[t._v("标记完成")]):t._e(),t.detail.state>1&&t.$hasPermission("sales-orders-cancel")?s("el-button",{attrs:{type:"defaut",icon:"el-icon-edit"},on:{click:t.cancelOrders}},[t._v("撤销")]):t._e(),t.allowDeleteOrders(t.detail)?s("el-button",{attrs:{type:"danger",icon:"el-icon-delete",plain:""},on:{click:t.deleteOrders}},[t._v("作废")]):t._e()],1)]),s("div",{staticClass:"margin-top-sm"},[s("div",{staticClass:"dflex-b padding-lr-lg"},[s("div",{staticClass:"padding-tb"},[s("div",{staticClass:"padding-bottom-sm"},[s("span",[t._v("销售单号："+t._s(t.detail.orders_no))]),s("span",{staticClass:"margin-left-lg"},[t._v("销售员："+t._s(t.detail.sales_name||t.detail.create_uname))]),s("span",{staticClass:"margin-left-lg"},[t._v(" 订单状态： "),s("el-tag",{attrs:{size:"small",type:9==t.detail.state?"success":"danger"}},[s("i",{class:9==t.detail.state?"el-icon-check":"el-icon-time"}),t._v(" 订单"+t._s(t._f("formatKeyValue")(t.detail.state,t.$constant.ORDERS_STATES,"value","next"))+" ")])],1)]),s("div",{staticClass:"padding-bottom-sm"},[s("span",[t._v("客户："+t._s(t.detail.receiver.name))]),t.detail.receiver.contact?s("span",{staticClass:"margin-left"},[t._v("联系人："+t._s(t.detail.receiver.contact))]):t._e(),t.detail.receiver.telephone?s("span",{staticClass:"margin-left"},[t._v("联系电话："+t._s(t.detail.receiver.telephone))]):t._e()])]),s("div",{staticClass:"tar ft-grey"},[s("div",{staticClass:"padding-bottom-sm"},[s("span",[t._v("开单日期："+t._s(t._f("formatDate")(t.detail.orders_date)))]),s("span",{staticClass:"margin-left-lg"},[t._v("制单人："+t._s(t.detail.create_uname))])])])])]),s("div",{directives:[{name:"show",rawName:"v-show",value:"basic"==t.navActive,expression:"navActive == 'basic'"}]},[s("OrdersGoodsTable",{ref:"goodsTable",attrs:{data:t.detail.orders_goods,loading:t.dataLoading}}),s("div",{staticClass:"dflex-b padding padding-tb-lg"},[s("div",{staticClass:"dflex-s"}),s("div",{staticClass:"dflex-e"},[s("span",{staticClass:"padding-left-lg"},[t._v("原价金额："+t._s(t.detail.goods_original_money))]),s("span",{staticClass:"padding-left-lg"},[t._v("商品优惠："+t._s(t.detail.goods_discount_money))]),s("span",{staticClass:"padding-left-lg"},[t._v("整单优惠："+t._s(t.detail.orders_discount_money))]),s("span",{staticClass:"padding-left-lg"},[t._v("其他费用："+t._s(t.detail.orders_extend_fee))]),s("span",{staticClass:"padding-left-lg"},[t._v(" 订单金额： "),s("span",{staticClass:"ft-danger"},[t._v(t._s(t.detail.orders_total_money))])])])])],1),s("div",{directives:[{name:"show",rawName:"v-show",value:"settle"==t.navActive,expression:"navActive == 'settle'"}],staticClass:"dflex-b padding padding-tb-lg border-top"},[s("div",{staticClass:"dflex-s fs"},[s("span",{staticClass:"padding-right"},[t._v("订单金额："+t._s(t.detail.orders_total_money))]),s("span",{staticClass:"padding-right"},[t._v("已收款金额："+t._s(t.detail.settle_money))]),s("span",{staticClass:"padding-right"},[t._v(" 待收金额： "),s("span",{staticClass:"ft-danger"},[t._v(t._s(t.detail.unsettle_money))])])]),s("div",{staticClass:"dflex-e"},[s("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["receipt-orders-create"],expression:"['receipt-orders-create']"}],attrs:{type:"success",icon:"el-icon-plus",disabled:9==t.detail.settle_state},on:{click:t.handleAddSettle}},[t._v("添加收款")])],1)]),s("div",{directives:[{name:"show",rawName:"v-show",value:"stock"==t.navActive,expression:"navActive == 'stock'"}]},[s("OrdersGoodsTable",{ref:"goodsTable",attrs:{data:t.detail.orders_goods}}),1==t.detail.state?s("div",{staticClass:"margin-top"},[s("div",{staticClass:"header"},[t._m(0),s("div",{staticClass:"right dflex-e"},[s("AuxWarehouseSelect",{staticClass:"margin-right-sm",attrs:{label:"出库仓库"},model:{value:t.targetWarehouseId,callback:function(e){t.targetWarehouseId=e},expression:"targetWarehouseId"}}),s("el-button",{attrs:{type:"primary",icon:"el-icon-out"},on:{click:t.outStockOrders}},[t._v("立即出库")])],1)])]):t._e()],1)]),s("div",{directives:[{name:"show",rawName:"v-show",value:"basic"==t.navActive,expression:"navActive == 'basic'"}]},[s("el-card",{staticClass:"aux-card margin-top",attrs:{shadow:"none","body-style":{padding:"12px"}}},[s("div",{attrs:{slot:"header"},slot:"header"},[s("span",[t._v("订单备注")])]),s("div",{staticClass:"padding-sm padding-tb-xs"},[t._v(t._s(t.detail.orders_remark))])]),s("el-card",{staticClass:"aux-card margin-top",attrs:{shadow:"none","body-style":{padding:"12px"}}},[s("div",{attrs:{slot:"header"},slot:"header"},[s("span",[t._v("内部备注")])]),s("div",{staticClass:"padding-sm padding-tb-xs"},[t._v(t._s(t.detail.create_remark))])])],1),s("div",{directives:[{name:"show",rawName:"v-show",value:"stock"==t.navActive&&t.stockOrdersList.length>0,expression:"navActive == 'stock' && stockOrdersList.length > 0"}]},[s("div",{staticClass:"aux-card margin-top"},[t._m(1),t._l(t.stockOrdersList,(function(e){return s("div",{key:e._id,staticClass:"border-bottom"},[s("div",{staticClass:"padding"},[s("span",{staticClass:"padding-right-lg"},[t._v("出库单号："+t._s(e.opt_no))]),s("span",{staticClass:"padding-right-lg"},[t._v("出库时间："+t._s(t._f("formatDate")(e.opt_time)))]),s("span",{staticClass:"padding-right-lg"},[t._v("出库仓库："+t._s(e.warehouse_name))]),s("span",{staticClass:"padding-right-lg"},[t._v("操作人员："+t._s(e.create_uname))])]),s("orders-stock-goods-table",{ref:"stockGoodsTable",refInFor:!0,attrs:{data:e.orders_goods}})],1)}))],2)]),s("div",{directives:[{name:"show",rawName:"v-show",value:"settle"==t.navActive&&t.settleOrdersList.length>0,expression:"navActive == 'settle' && settleOrdersList.length > 0"}]},[s("div",{staticClass:"aux-card margin-top"},[t._m(2),s("el-table",{staticClass:"aux-table",attrs:{data:t.settleOrdersList,border:""}},[s("el-table-column",{attrs:{width:"60",align:"center",label:"#"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.$index+1))]}}])}),s("el-table-column",{attrs:{label:"收款单号",prop:"receipt_no",width:"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("router-link",{attrs:{to:"/accounting/receipt/orders-detail/"+e.row._id}},[s("span",{staticClass:"link-hover"},[t._v(t._s(e.row.receipt_no))])])]}}])}),s("el-table-column",{attrs:{label:"收款时间",prop:"receipt_date",width:"200",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("formatDate")(e.row.receipt_date)))]}}])}),s("el-table-column",{attrs:{label:"收款金额",prop:"receipt_money",width:"200",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("cent2yuan")(e.row.receipt_money)))]}}])}),s("el-table-column",{attrs:{label:"支付方式",prop:"receipt_type",width:"200",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("formatTypeName")(e.row.receipt_type,t.$constant.PAYMENT_TYPES)))]}}])}),s("el-table-column",{attrs:{label:"经办人员",prop:"create_uname",width:"200",align:"center"}}),s("el-table-column",{attrs:{label:"备注",prop:"remark"}})],1)],1)]),s("PrintDialog",{ref:"printDialog",on:{submit:t.submitPrint}}),s("PrintContainer",{ref:"printContainer",attrs:{filename:t.pdfFileName},on:{progress:function(e){t.pdfBuildProgress=e}}},[s(t.printContentCom,{ref:"printContentCom",tag:"component",attrs:{template:t.pdfTemplate,"orders-id":t.ordersId}})],1)],1)},n=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"left"},[s("span",{staticClass:"title"},[t._v("待出库")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"header"},[s("div",{staticClass:"left"},[s("span",{staticClass:"title"},[t._v("出库记录")])]),s("div",{staticClass:"right dflex-e"})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"header"},[s("div",{staticClass:"left"},[s("span",{staticClass:"title"},[t._v("收款记录")])]),s("div",{staticClass:"right dflex-e"})])}],o=s("5530"),i=(s("4de4"),s("d3b7"),s("3ca3"),s("ddb0"),s("b680"),s("a9e3"),s("d81d"),s("caad"),s("5066")),r=s("c3dd"),l=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("el-dialog",{staticClass:"print-dialog",attrs:{title:"打印单据",visible:t.dialogVisible,width:"800px"},on:{"update:visible":function(e){t.dialogVisible=e}}},[s("el-form",{ref:"elForm",staticClass:"border-top",attrs:{"status-icon":"","label-width":"100px","label-position":"top",size:"small"}},[s("el-form-item",{attrs:{label:"通用模板"}},[s("div",{staticClass:"template-area dflex-b"},t._l(t.compDefaultTemplates,(function(e,a){return s("div",{key:a,staticClass:"pitem",class:{active:e.template==t.templateActive},on:{click:function(s){return t.selectTemplate(e,a)}}},[s("div",{staticClass:"icon el-icon-tickets"}),s("div",[t._v(t._s(e.name))])])})),0)]),s("el-form-item",{attrs:{label:"其他模板"}},[s("div",{staticClass:"template-area dflex-s"},[t._l(t.compOtherTemplates,(function(e,a){return s("div",{key:a,staticClass:"pitem",class:{active:e.template==t.templateActive},on:{click:function(s){return t.selectTemplate(e,a)}}},[s("div",{staticClass:"icon el-icon-tickets landscape"}),s("div",[t._v(t._s(e.name))])])})),s("div",{staticClass:"pitem margin-left-lg"},[s("el-tooltip",{attrs:{content:"定制专属打印模板，支持自定义样式，需要定制请联系管理员",placement:"top",effect:"dark"}},[s("div",[s("div",{staticClass:"icon el-icon-plus landscape"}),s("div",[t._v("模板定制")])])])],1)],2)])],1),s("div",{staticClass:"dflex-b padding-top-sm border-top"},[s("div",[s("el-button",{attrs:{type:"default"},on:{click:function(e){return t.submit("preview")}}},[t._v("打印预览")]),s("el-button",{attrs:{type:"default"},on:{click:function(e){return t.submit("download")}}},[t._v("导出PDF文件")]),s("el-button",{attrs:{type:"default"},on:{click:function(e){return t.submit("setting")}}},[t._v("设置")])],1),s("div",[s("el-button",{attrs:{type:"default"},on:{click:t.close}},[t._v("取消")]),s("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.submit("print")}}},[t._v("立即打印")])],1)])],1)},d=[],c=(s("2532"),s("2f62")),u=s("3f89"),p=[{type:"default",template:"a4",name:"A4",pdfFormat:"a4",size:[210,296],unit:"mm",orientation:"portrait"},{type:"default",template:"d241-140mm",name:"241*140mm",pdfFormat:"",size:[241,140],unit:"mm",orientation:"landscape"},{type:"default",template:"d190-130mm",name:"190*130mm",pdfFormat:"",size:[190,130],unit:"mm",orientation:"landscape"},{type:"default",template:"d241-93mm",name:"241*93mm",pdfFormat:"",size:[241,93],unit:"mm",orientation:"landscape"},{type:"default",template:"x58mm",name:"小票58mm",pdfFormat:"",size:[58,120],unit:"mm",orientation:"portrait"},{type:"default",template:"x80mm",name:"小票80mm",pdfFormat:"",size:[80,160],unit:"mm",orientation:"portrait"},{type:"other",template:"a4-l",name:"A4-横版",pdfFormat:"a4",size:[296,210],unit:"mm",orientation:"landscape"}],m={name:"PrintDialog",data:function(){return{customTemplates:["66169570bd022087dfdebc40"],dialogVisible:!1,templates:p,templateActive:"a4",pdfOption:u["a"].state.pdfOption,printType:"local"}},computed:Object(o["a"])(Object(o["a"])({},Object(c["b"])(["companyId"])),{},{hasCustomTemplate:function(){return this.customTemplates.includes(this.companyId)},compDefaultTemplates:function(){return p.filter((function(t){return"default"===t.type}))},compOtherTemplates:function(){return p.filter((function(t){return"other"===t.type}))}}),methods:{open:function(){this.dialogVisible=!0},close:function(){this.dialogVisible=!1},selectTemplate:function(t){this.templateActive=t.template},submit:function(t){var e=this;if(this.templateActive){var s=p.filter((function(t){return t.template===e.templateActive}));this.$emit("submit",t,Object.assign({},s[0])),this.close()}}}},f=m,h=(s("d4fc"),s("2877")),_=Object(h["a"])(f,l,d,!1,null,null,null),v=_.exports,g=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"print-container"},[s("section",{staticClass:"layout-container",class:{"show-layout":t.showLayout,"unset-all":!t.floatLayout}},[s("section",{ref:"pdfContent",staticClass:"content-wrapper",style:{width:t.pdfContentWidth}},[t._t("default")],2)]),s("transition",{attrs:{name:"transition-anim"}},[t.previewModal&&t.pdfFileUrl?s("section",{staticClass:"pdf-preview"},[s("button",{staticClass:"close",on:{click:function(e){return e.target!==e.currentTarget?null:t.closePreview(e)}}},[t._v("×")]),s("iframe",{attrs:{src:t.pdfFileUrl,width:"100%",height:"100%"}}),s("div",{staticClass:"btn-area"},[s("button",{staticClass:"close-btn",on:{click:function(e){return e.target!==e.currentTarget?null:t.closePreview(e)}}},[t._v("关闭")]),s("button",{staticClass:"print-btn",on:{click:function(e){return e.target!==e.currentTarget?null:t.printPdf(e)}}},[t._v("立即打印")])])]):t._e()]),t.showControls?s("PrintControls",{staticClass:"control-area",attrs:{progress:t.progress},on:{close:t.closePreview}}):t._e()],1)},b=[],y=s("c7eb"),C=s("1da1"),w=(s("a630"),s("add5")),k=s.n(w),x=s("d67e"),O=s.n(x),T=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("section",{staticClass:"control-container"},[s("h3",{staticClass:"control-header"},[t._v("控制参数")]),s("section",{staticClass:"item-container"},[t._l(t.controls,(function(e,a){return[!e.vVisble||e.vVisble&&t.controlValue[e.vVisble]?s("section",{key:a,staticClass:"control-item"},[s("section",{staticClass:"control"},[s("span",{staticClass:"item-label"},[t._v(t._s(e.label))]),["checkbox","number","text"].includes(e.inputType)?[s("input",{class:"checkbox"===e.inputType?"input-checkbox":"input-box",attrs:{type:e.inputType},domProps:{value:t.controlValue[e.vModel],checked:t.controlValue[e.vModel]},on:{input:function(s){return t.setInput(s,e.vModel,e.inputType)},change:function(s){return t.setInput(s,e.vModel,e.inputType)}}})]:t._e(),["select"].includes(e.inputType)?[s("select",{directives:[{name:"model",rawName:"v-model",value:t.controlValue[e.vModel],expression:"controlValue[control.vModel]"}],on:{change:function(s){var a=Array.prototype.filter.call(s.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(t.controlValue,e.vModel,s.target.multiple?a:a[0])}}},t._l(e.options.split(","),(function(e,a){return s("option",{key:a,domProps:{value:e}},[t._v(t._s(e))])})),0)]:t._e()],2)]):t._e()]}))],2),s("button",{staticClass:"generate-btn",attrs:{disabled:t.isGenerating},on:{click:t.submit}},[t._v("关闭")])])},$=[],P={props:{progress:{type:Number,default:0}},computed:Object(o["a"])(Object(o["a"])({},Object(c["b"])(["companyId"])),{},{isGenerating:function(){return 0!==this.progress&&100!==this.progress}}),data:function(){return{controlValue:u["a"].state.controlsValue,controls:[{label:"显示正标题",type:"Boolean",options:"是否显示标题",inputType:"checkbox",vModel:"showTitle"},{label:"正标题内容",type:"String",options:"正标题显示的内容",inputType:"text",vVisble:"showTitle",vModel:"title"},{label:"显示副标题",type:"Boolean",options:"是否副标题",inputType:"checkbox",vModel:"showSubTitle"},{label:"副标题内容",type:"String",options:"副标题显示的内容",inputType:"text",vVisble:"showSubTitle",vModel:"subTitle"},{label:"显示备注",type:"Boolean",options:"是否显示备注",inputType:"checkbox",vModel:"showRemark"},{label:"显示注意",type:"Boolean",options:"是否显示备注",inputType:"checkbox",vModel:"showExplain"},{label:"注意信息",type:"String",options:"自定义订单上注意提示信息",inputType:"text",vVisble:"showExplain",vModel:"explainText"},{label:"扩展信息",type:"String",options:"底部显示的扩展信息",inputType:"text",vModel:"expandText"}]}},created:function(){u["a"].commit("load",this.companyId)},methods:{setInput:function(t,e,s){var a=t.target.value;"checkbox"===s&&(a=t.target.checked),"number"===s&&(a=t.target.value?parseFloat(t.target.value):0),this.$set(this.controlValue,e,a)},submit:function(){this.$emit("close"),u["a"].commit("save",this.companyId)}}},S=P,I=(s("e241"),Object(h["a"])(S,T,$,!1,null,"bc5dffa4",null)),D=I.exports,A={components:{PrintControls:D},props:{filename:{type:String,default:"".concat((new Date).getTime())},paginateElementsByHeight:{type:Number,default:1400},manualPagination:{type:Boolean,default:!0},htmlToPdfOptions:{type:Object,default:null}},data:function(){return{showLayout:!1,floatLayout:!1,previewModal:!1,showControls:!1,pdfUnit:"mm",pdfFormat:"a4",pdfFormatSize:[],pdfContentWidth:"210mm",pdfOrientation:"portrait",hasAlreadyParsed:!1,progress:0,pdfFileUrl:null}},watch:{progress:function(t){this.$emit("progress",t)},paginateElementsByHeight:function(){this.resetPagination()},$props:{handler:function(){this.validateProps()},deep:!0,immediate:!0}},methods:{validateProps:function(){this.manualPagination||void 0===this.paginateElementsByHeight&&console.error("Error: paginate-elements-by-height is required if manual-pagination is false")},resetPagination:function(){var t=this.$refs.pdfContent.firstChild,e=t.getElementsByClassName("html2pdf__page-break"),s=e.length-1;if(-1!==s){this.hasAlreadyParsed=!1;for(var a=s;a>=0;a--)e[a].parentNode.removeChild(e[a])}},closePreview:function(){this.pdfFileUrl=null,this.previewModal=!1,this.showControls=!1,this.showLayout=!1,this.floatLayout=!1},openControls:function(t){var e=this;return Object(C["a"])(Object(y["a"])().mark((function s(){return Object(y["a"])().wrap((function(s){while(1)switch(s.prev=s.next){case 0:e.initPdfOptions(t),e.showControls=!0,e.showLayout=!0,e.floatLayout=!0,e.progress=100;case 5:case"end":return s.stop()}}),s)})))()},generatePdf:function(t,e){var s=this;return Object(C["a"])(Object(y["a"])().mark((function a(){var n,o,i,r,l,d;return Object(y["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(e&&s.initPdfOptions(e),s.progress=0,s.paginationOfElements(),n=s.$refs.pdfContent,o=s.getPdfOptions(),i=O()().set(o).from(n),"download"!=t){a.next=20;break}return s.$emit("beforeDownload",{html2pdf:O.a,options:o,pdfContent:n}),a.next=10,i.save().output("bloburl");case 10:return r=a.sent,a.next=13,fetch(r);case 13:return l=a.sent,a.next=16,l.blob();case 16:d=a.sent,s.$emit("hasDownloaded",d,r),a.next=24;break;case 20:return a.next=22,i.output("bloburl");case 22:s.pdfFileUrl=a.sent,"preview"==t?s.previewModal=!0:s.printPdf();case 24:s.progress=100;case 25:case"end":return a.stop()}}),a)})))()},initPdfOptions:function(t){this.pdfUnit=t.unit||"mm",this.pdfFormat=t.pdfFormat,this.pdfOrientation=t.orientation||"portrait",this.pdfContentWidth=t.size[0]+(t.unit||"mm"),this.pdfFormatSize=t.size,this.pdfTemplate=t.template},paginationOfElements:function(){if(this.$emit("beginPagination"),this.progress=25,!this.manualPagination){if(this.hasAlreadyParsed)this.progress=70;else{for(var t=this.$refs.pdfContent.firstChild,e=Array.from(t.children),s=0,a=0,n=e;a<n.length;a++){var o=n[a],i=o.classList[0],r="html2pdf__page-break"===i;if(r)s=0;else{var l=o.clientHeight,d=o.currentStyle||window.getComputedStyle(o),c=parseInt(d.marginTop)+parseInt(d.marginBottom),u=l+c;if(s+l<this.paginateElementsByHeight)s+=u;else{var p=document.createElement("div");p.classList.add("html2pdf__page-break"),t.insertBefore(p,o),s=u}}}this.progress=70,this.hasAlreadyParsed=!0}this.$emit("hasPaginated")}},getPdfOptions:function(){var t={margin:0,filename:this.filename||"".concat(this.filename,".pdf"),image:{type:"jpeg",quality:.98},enableLinks:!0,html2canvas:{dpi:300,scale:3.125,useCORS:!0},jsPDF:{unit:this.pdfUnit,format:this.pdfFormat||this.pdfFormatSize,orientation:this.pdfOrientation}};return void 0!==this.htmlToPdfOptions&&null!==this.htmlToPdfOptions&&(t=Object.assign(t,this.htmlToPdfOptions)),t},printPdf:function(){k()({printable:this.pdfFileUrl,type:"pdf",showModal:!1})}}},j=A,N=(s("1761"),Object(h["a"])(j,g,b,!1,null,"3ff7176c",null)),M=N.exports,L=s("2197"),F={name:"SalesOrdersDetail",components:{OrdersGoodsTable:i["a"],AuxWarehouseSelect:r["a"],PrintContainer:M,PrintDialog:v},computed:Object(o["a"])(Object(o["a"])({},Object(c["b"])(["companyId"])),{},{compNavMenus:function(){var t=this;return this.navMenus.filter((function(e){return t.$hasModule(e.module||"")}))}}),data:function(){return{permission:"sales-orders-query",navMenus:[{name:"订单详情",value:"basic"},{name:"出库/发货",value:"stock",module:"stock"},{name:"结算收款",value:"settle"}],navActive:"basic",dataLoading:!1,ordersId:"",detail:{receiver_id:"",receiver:{_id:"",name:"客户",contact:"",telephone:"",address:"请选择销售的客户",sale_grade:0},orders_date:(new Date).getTime(),orders_no:"",orders_remark:"",create_remark:"",create_uname:"",state:"",orders_goods:[],goods_total_count:0,goods_original_money:0,goods_discount_money:0,goods_total_money:0,orders_discount_money:0,orders_extend_fee:0,orders_total_money:0,settle_state:"",settleMoney:0,unsettleMoney:0},ordersIdentifys:[],wareHouseList:[],stockChecked:!1,targetWarehouseId:"",stockOrdersList:[],settleOrdersList:[],printContentCom:null,pdfBuildProgress:0,pdfFileName:"销售单-"+(new Date).getTime()+".pdf",pdfTemplate:"a4"}},mounted:function(){var t=this.$route.params||{},e=t.ordersId;e&&(this.ordersId=e,this.fetchDetail())},methods:{initContentComponent:function(){var t;t="66169570bd022087dfdebc40"==this.companyId?function(){return Promise.all([s.e("chunk-0b759c92"),s.e("chunk-638554e6")]).then(s.bind(null,"5b46"))}:"65748600337a9f0756697a2e"==this.companyId?function(){return s.e("chunk-9383a61c").then(s.bind(null,"3235"))}:"65ffdd27652341ed5e149e69"==this.companyId?function(){return s.e("chunk-557332aa").then(s.bind(null,"dd79"))}:function(){return s.e("chunk-30efe315").then(s.bind(null,"4318"))},this.printContentCom=t},changeTabSelect:function(t){this.navActive=t,"stock"===this.navActive&&this.fetchStockDetail(),"settle"===this.navActive&&this.fetchSettleDetail()},fetchDetail:function(){var t=this;this.dataLoading=!0,Object(L["a"])("orders/getOrders",{ordersId:this.ordersId},{functionName:"xunda"}).then((function(e){t.initOrdersData(e.data),t.dataLoading=!1}),(function(e){t.dataLoading=!1}))},initOrdersData:function(t){var e=this,s=this.detail=Object.assign({},t);s.receiver_id=t.receiver_id,s.receiver=t.receiver,s.orders_date=t.orders_date,s.orders_no=t.orders_no,s.orders_remark=t.orders_remark,s.create_remark=t.create_remark,s.create_uname=t.create_uname,s.goods_total_count=t.goods_total_count||t.orders_goods_count,s.goods_total_money=this.$common.cent2yuan(t.goods_total_money||t.orders_total_money||0),s.goods_discount_money=this.$common.cent2yuan(t.goods_discount_money||0),s.goods_original_money=this.$common.cent2yuan(t.goods_original_money||t.goods_total_money||t.orders_total_money),s.orders_total_money=this.$common.cent2yuan(t.orders_total_money),s.orders_extend_fee=this.$common.cent2yuan(t.orders_extend_fee||0),s.orders_discount_money=this.$common.cent2yuan(t.orders_discount_money||0),s.settle_money=this.$common.cent2yuan(t.settle_money||0),s.unsettle_money=(Number(s.orders_total_money)-Number(s.settle_money)).toFixed(2),s.orders_goods=t.orders_goods.map((function(t){var s=Object.assign({},t);return s.goods_ori_price=e.$common.cent2yuan(t.goods_ori_price||s.goods_price),s.total_ori_money=e.$common.cent2yuan(t.total_ori_money||s.total_money),s.goods_rate=Number(t.goods_rate||100).toFixed(2),s.total_money=e.$common.cent2yuan(t.total_money),s.goods_price=e.$common.cent2yuan(t.goods_price),s}))},fetchStockDetail:function(){var t=this;if(!(this.stockOrdersList.length>0)){var e=this.detail.stock_ids||(this.detail.rel_stock_id?[this.detail.rel_stock_id]:[]);0!==e.length&&Object(L["a"])("stock/listStockStream",{stockIds:e},{functionName:"xunda"}).then((function(e){t.stockOrdersList=(e.data||[]).map((function(e){var s=e.orders_goods.map((function(e){var s=Object.assign({},e);return s.total_money=t.$common.cent2yuan(e.total_money),s.goods_price=t.$common.cent2yuan(e.goods_price),s}));return e.orders_goods=s,e}))}))}},fetchSettleDetail:function(){var t=this;if(!(this.settleOrdersList.length>0)){var e=this.detail.settle_orders_ids||[];if(0!==e.length){var s=Object.assign({pageSize:20,pageNo:1},{receiptId:e});Object(L["a"])("settle/listReceiptOrders",s,{functionName:"xunda"}).then((function(e){t.settleOrdersList=e.data||[]}))}}},approvedOrders:function(){var t=this;this.$confirm("确定要通过该订单？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"success"}).then((function(){Object(L["a"])("orders/approvedOrders",{ordersId:t.ordersId},{functionName:"xunda"}).then((function(e){t.$message({type:"success",message:"操作成功!"}),t.fetchDetail()}))}))},allowEditOrders:function(t){if(9==t.state)return!1;var e=this.$hasDataPermission(t.create_uid)&&t.state<1,s=this.$hasPermission(["sales-orders-approve","approve-orders-all"])&&(t.state<=1||!this.$hasModule("stock")),a=e||s;return a},allowDeleteOrders:function(t){var e=this.$hasAdmin()||this.$hasDataPermission(t.create_uid)&&!t.state||this.$hasPermission(["approve-orders-all","sales-orders-delete"])&&[0,1].includes(t.state);return e},deleteOrders:function(){var t=this;this.$confirm("确定要删除该订单？","告警提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(L["a"])("orders/deleteOrders",{ordersId:t.ordersId},{functionName:"xunda"}).then((function(e){t.$message({type:"success",message:"删除成功!"}),setTimeout((function(){return t.$common.closePage()}),500)}))}))},outStockOrders:function(){var t=this;this.$confirm("确定要出库嘛？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"success"}).then((function(){Object(L["a"])("orders/outStock",{ordersId:t.ordersId,warehouseId:t.targetWarehouseId},{functionName:"xunda"}).then((function(e){t.$message({type:"success",message:"操作成功!"}),t.fetchDetail(),setTimeout((function(){return t.fetchStockDetail()}),500)}))}))},cancelOrders:function(){var t=this;this.$confirm("确定要撤销嘛？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"success"}).then((function(){Object(L["a"])("orders/cancelOrders",{ordersId:t.ordersId},{functionName:"xunda"}).then((function(e){t.$message({type:"success",message:"操作成功!"}),t.fetchDetail()}))}))},deliverOrders:function(){var t=this;Object(L["a"])("orders/deliverOrders",{ordersId:this.ordersId},{functionName:"xunda"}).then((function(e){t.$message({type:"success",message:"操作成功!"}),t.fetchDetail()}))},completedOrders:function(){var t=this;Object(L["a"])("orders/completeOrders",{ordersId:this.ordersId},{functionName:"xunda"}).then((function(e){t.$message({type:"success",message:"操作成功!"}),t.fetchDetail()}))},handleAddSettle:function(){var t={ordersType:"sales",ordersId:this.ordersId};this.$router.push({path:"/accounting/receipt/orders-create",query:t})},handlePrint:function(){this.$refs.printDialog.open()},submitPrint:function(t,e){var s=this;this.pdfBuildProgress=0,this.pdfTemplate=e.template,this.printContentCom||this.initContentComponent(),this.$nextTick((function(){s.printContentCom().then((function(){s.$nextTick((function(){s.$refs.printContentCom.init().then((function(){"setting"==t?s.$refs.printContainer.openControls(e):s.$refs.printContainer.generatePdf(t,e)}))}))}))}))}}},B=F,E=Object(h["a"])(B,a,n,!1,null,null,null);e["default"]=E.exports},fc2f:function(t,e,s){}}]);