(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0055b396"],{"298e":function(e,t,s){},"2f45":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"app-container"},[s("div",{staticClass:"aux-card"},[s("div",{staticClass:"header",staticStyle:{"padding-bottom":"0","padding-top":"6px"}},[s("div",{staticClass:"left"},[s("el-menu",{staticClass:"el-menu-big no-border",attrs:{"default-active":e.navActive,mode:"horizontal"},on:{select:e.changeTabSelect}},e._l(e.navMenus,(function(t){return s("el-menu-item",{key:t.value,attrs:{index:t.value,disabled:!e.detail.state&&["stock","sign"].includes(t.value)}},[e._v(e._s(t.name))])})),1)],1),s("div",{staticClass:"right"},[s("el-button",{attrs:{type:"default",icon:"el-icon-document-copy"},on:{click:function(t){return e.$common.toPage("../prepare-orders-create?type=copyAdd&id="+e.ordersId)}}},[e._v("复制")]),9!=e.detail.state?s("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["sales-prepare-orders-create"],expression:"['sales-prepare-orders-create']"}],attrs:{type:"default",icon:"el-icon-edit"},on:{click:function(t){return e.$common.toPage("../prepare-orders-create?type=edit&id="+e.ordersId)}}},[e._v("修改")]):e._e(),s("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["sales-prepare-delete"],expression:"['sales-prepare-delete']"}],attrs:{type:"danger",icon:"el-icon-delete",plain:""},on:{click:e.deleteOrders}},[e._v("作废")]),e.detail.state?e._e():s("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["sales-prepare-approve"],expression:"['sales-prepare-approve']"}],attrs:{type:"primary",icon:"el-icon-document-checked"},on:{click:e.approvedOrders}},[e._v("审核通过")]),e.detail.state>=1&&e.detail.state<=2?s("el-button",{attrs:{type:"primary",icon:"el-icon-connection"},on:{click:function(t){return e.$common.toPage("../orders-create?type=fromPrepare&id="+e.ordersId)}}},[e._v("转销售")]):e._e(),2==e.detail.state?s("el-button",{attrs:{type:"success",icon:"el-icon-document-checked"},on:{click:e.completedOrders}},[e._v("标记完成")]):e._e()],1)]),s("div",{staticClass:"margin-top-sm"},[s("div",{staticClass:"dflex-b padding-lr-lg"},[s("div",{staticClass:"padding-tb"},[s("div",{staticClass:"padding-bottom-sm"},[s("span",[e._v("订单号："+e._s(e.detail.orders_no))]),s("span",{staticClass:"margin-left-lg"},[e._v("业务员："+e._s(e.detail.sales_name||e.detail.create_uname))]),s("span",{staticClass:"margin-left-lg"},[e._v(" 订单状态： "),s("el-tag",{attrs:{size:"small",type:9==e.detail.state?"success":"danger"}},[s("i",{class:9==e.detail.state?"el-icon-check":"el-icon-time"}),e._v(" 订单"+e._s(e._f("formatKeyValue")(e.detail.state,e.$constant.PREPARE_ORDERS_STATES,"value","next"))+" ")])],1)]),s("div",{staticClass:"padding-bottom-sm"},[s("span",[e._v("客户："+e._s(e.detail.store.name))]),e.detail.store.contact?s("span",{staticClass:"margin-left"},[e._v("联系人："+e._s(e.detail.store.contact))]):e._e(),e.detail.store.telephone?s("span",{staticClass:"margin-left"},[e._v("联系电话："+e._s(e.detail.store.telephone))]):e._e()])]),s("div",{staticClass:"tar ft-grey"},[s("div",{staticClass:"padding-bottom-sm"},[s("span",[e._v("开单日期："+e._s(e._f("formatDate")(e.detail.orders_date)))]),s("span",{staticClass:"margin-left-lg"},[e._v("制单人："+e._s(e.detail.create_uname))])])])])]),s("div",{directives:[{name:"show",rawName:"v-show",value:"basic"==e.navActive||"salesOrders"==e.navActive,expression:"navActive == 'basic' || navActive == 'salesOrders'"}]},[s("PrepareOrdersGoodsView",{ref:"goodsTable",attrs:{data:e.detail.orders_goods}}),s("div",{staticClass:"dflex-b padding padding-tb-lg"},[s("div",{staticClass:"dflex-s"}),s("div",{staticClass:"dflex-e"},[s("span",{staticClass:"padding-left-lg"},[e._v("原价金额："+e._s(e.detail.goods_original_money))]),s("span",{staticClass:"padding-left-lg"},[e._v("商品优惠："+e._s(e.detail.goods_discount_money))]),s("span",{staticClass:"padding-left-lg"},[e._v("整单优惠："+e._s(e.detail.orders_discount_money))]),s("span",{staticClass:"padding-left-lg"},[e._v("其他费用："+e._s(e.detail.orders_extend_fee))]),s("span",{staticClass:"padding-left-lg"},[e._v(" 订单金额： "),s("span",{staticClass:"ft-danger"},[e._v(e._s(e.detail.orders_total_money))])])])])],1)]),s("div",{directives:[{name:"show",rawName:"v-show",value:"basic"==e.navActive,expression:"navActive == 'basic'"}]},[s("el-card",{staticClass:"aux-card margin-top",attrs:{shadow:"none","body-style":{padding:"12px"}}},[s("div",{attrs:{slot:"header"},slot:"header"},[s("span",[e._v("订单备注")])]),s("div",{staticClass:"padding-sm padding-tb-xs"},[e._v(e._s(e.detail.orders_remark))])])],1),s("div",{directives:[{name:"show",rawName:"v-show",value:"salesOrders"==e.navActive,expression:"navActive == 'salesOrders'"}]},[s("div",{staticClass:"aux-card margin-top"},[e._m(0),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.salesLoading,expression:"salesLoading"}],staticClass:"cu-table",attrs:{data:e.salesOrdersList,border:"","span-method":e.arraySpanMethod}},[s("el-table-column",{attrs:{width:"60",align:"center",label:"#"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.$index+1))]}}])}),s("el-table-column",{attrs:{label:"销售单号",prop:"orders_no",width:"220"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("router-link",{attrs:{to:"../orders-detail/"+t.row._id}},[s("span",{staticClass:"link-hover padding-left-sm"},[e._v(e._s(t.row.orders_no))])])]}}])}),s("el-table-column",{attrs:{width:"260",align:"left",label:"商品名称/规格"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-table",{staticClass:"su-table",attrs:{data:t.row.orders_goods,"show-header":!1,stripe:""}},[s("el-table-column",{attrs:{width:"260",align:"left",label:"商品名称/规格"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("div",[s("div",[e._v(e._s(t.row.goods_name))]),t.row.goods_spec?s("div",{staticClass:"fs-xs ft-grey"},[e._v("规格："+e._s(t.row.goods_spec))]):e._e()])]}}],null,!0)}),s("el-table-column",{attrs:{width:"180",align:"left",label:"商品编号"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.goods_no))]}}],null,!0)}),s("el-table-column",{attrs:{width:"100",align:"center",label:"单位"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.goods_unit))]}}],null,!0)}),s("el-table-column",{attrs:{width:"100",align:"right",label:"数量"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.goods_cnt))]}}],null,!0)}),s("el-table-column",{attrs:{width:"120",align:"right",label:"原价(元)"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("cent2yuan")(t.row.goods_ori_price)))]}}],null,!0)}),s("el-table-column",{attrs:{width:"120",align:"right",label:"折扣(%)"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.goods_rate))]}}],null,!0)}),s("el-table-column",{attrs:{width:"120",align:"right",label:"单价(元)"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("cent2yuan")(t.row.goods_price)))]}}],null,!0)}),s("el-table-column",{attrs:{width:"120",align:"right",label:"金额小计(元)"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("cent2yuan")(t.row.total_money)))]}}],null,!0)}),s("el-table-column",{attrs:{align:"left",label:"备注","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.remark))]}}],null,!0)})],1)]}}])}),s("el-table-column",{attrs:{width:"180",align:"left",label:"商品编号"}}),s("el-table-column",{attrs:{width:"100",align:"center",label:"单位"}}),s("el-table-column",{attrs:{width:"100",align:"right",label:"数量"}}),s("el-table-column",{attrs:{width:"120",align:"right",label:"原价(元)"}}),s("el-table-column",{attrs:{width:"120",align:"right",label:"折扣(%)"}}),s("el-table-column",{attrs:{width:"120",align:"right",label:"单价(元)"}}),s("el-table-column",{attrs:{width:"120",align:"right",label:"金额小计(元)"}}),s("el-table-column",{attrs:{align:"left",label:"备注"}})],1)],1)])])},o=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"header"},[s("div",{staticClass:"left"},[s("span",{staticClass:"title"},[e._v("已销售记录")])]),s("div",{staticClass:"right dflex-e"})])}],r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.dataLoading,expression:"dataLoading"}],ref:"goodsTable",staticClass:"aux-table no-border",attrs:{data:e.goodsList,border:"",fit:"",stripe:"","show-summary":"","summary-method":e.summaryMethod}},[s("el-table-column",{attrs:{type:"index",width:"60",align:"center",label:"序号"}}),s("el-table-column",{attrs:{width:"300",align:"left",label:"商品名称/规格"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("div",{staticClass:"dflex"},[t.row.goods_img?s("div",{staticClass:"goods-img"},[s("img",{attrs:{src:t.row.goods_img,alt:""}})]):e._e(),s("div",[s("div",[e._v(e._s(t.row.goods_name))]),t.row.goods_no?s("div",{staticClass:"fs-xs ft-grey"},[e._v("No："+e._s(t.row.goods_no))]):e._e()])])]}}])}),s("el-table-column",{attrs:{width:"160",align:"left",label:"规格/属性"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.goods_spec))]}}])}),s("el-table-column",{attrs:{width:"100",align:"center",label:"单位"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.goods_unit))]}}])}),s("el-table-column",{attrs:{width:"100",align:"right",label:"预订数量",prop:"goods_cnt"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.goods_cnt))]}}])}),s("el-table-column",{attrs:{width:"120",align:"right",label:"已转销售数量",prop:"sales_goods_cnt"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.sales_goods_cnt))]}}])}),s("el-table-column",{attrs:{width:"120",align:"right",label:"未转销售数量",prop:"unsales_goods_cnt"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.unsales_goods_cnt))]}}])}),s("el-table-column",{attrs:{width:"120",align:"right",label:"原价(元)"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.goods_ori_price))]}}])}),s("el-table-column",{attrs:{width:"120",align:"right",label:"折扣(%)"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.goods_rate))]}}])}),s("el-table-column",{attrs:{width:"120",align:"right",label:"单价(元)"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.goods_price))]}}])}),s("el-table-column",{attrs:{width:"120",align:"right",label:"金额小计(元)",prop:"total_money"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.total_money))]}}])}),s("el-table-column",{attrs:{align:"left",label:"备注","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.remark))]}}])})],1)},l=[],n=(s("13d5"),{props:{data:{type:Array,default:()=>[]}},data(){return{dataLoading:!1,goodsList:[]}},watch:{data:{handler(e,t){this.initData(e)},immediate:!0}},methods:{initData(e){this.goodsList=e.map(e=>this.initItemGoods(e))},initItemGoods(e={}){return e.sales_goods_cnt=e.sales_goods_cnt||0,e.unsales_goods_cnt=e.goods_cnt-e.sales_goods_cnt,e},summaryMethod({columns:e,data:t}){const s=[];return e.forEach((e,a)=>{if(0===a)return void(s[a]="合计");if(!["goods_cnt","sales_goods_cnt","unsales_goods_cnt","total_money"].includes(e.property))return void(s[a]=" ");const o=t.map(t=>Number(t[e.property]));o.every(e=>isNaN(e))?s[a]="":(s[a]=o.reduce((e,t)=>e+t,0),["total_money"].includes(e.property)&&(s[a]=s[a].toFixed(2)))}),s}}}),i=n,d=(s("3167"),s("2877")),c=Object(d["a"])(i,r,l,!1,null,null,null),_=c.exports,u=s("2197"),m={name:"SalesPrepareDetail",components:{PrepareOrdersGoodsView:_},data(){return{permission:"sales-orders-detail",navMenus:[{name:"订单详情",value:"basic"},{name:"已转销售单",value:"salesOrders"}],navActive:"basic",ordersId:"",detail:{store_id:"",store:{name:"",contact:"",telephone:"",address:""},orders_date:(new Date).getTime(),orders_no:"",orders_remark:"",create_remark:"",create_uname:"",state:"",orders_goods:[],goods_total_count:0,goods_original_money:0,goods_discount_money:0,goods_total_money:0,orders_discount_money:0,orders_extend_fee:0,orders_total_money:0,settle_state:"",settleMoney:0,unsettleMoney:0},salesLoading:!1,salesOrdersList:[]}},mounted(){const{ordersId:e}=this.$route.params||{};e&&(this.ordersId=e,this.fetchDetail())},methods:{changeTabSelect(e){this.navActive=e,"salesOrders"===this.navActive&&this.fetchSalesOrders()},fetchDetail(){Object(u["a"])("prepare/getOrders",{ordersId:this.ordersId},{functionName:"xunda"}).then(e=>{this.initOrdersData(e.data)})},initOrdersData(e){const t=this.detail=Object.assign({},e);t.store_id=e.store_id,t.store=e.store,t.orders_date=e.orders_date,t.orders_no=e.orders_no,t.orders_remark=e.orders_remark,t.create_remark=e.create_remark,t.create_uname=e.create_uname,t.goods_total_count=e.goods_total_count||e.orders_goods_count,t.goods_total_money=Number((e.goods_total_money||e.orders_total_money||0)/100).toFixed(2),t.goods_discount_money=Number((e.goods_discount_money||0)/100).toFixed(2),t.goods_original_money=Number((e.goods_original_money||e.goods_total_money||e.orders_total_money)/100).toFixed(2),t.orders_total_money=Number((e.orders_total_money||e.orders_total_money||0)/100).toFixed(2),t.orders_extend_fee=Number((e.orders_extend_fee||0)/100).toFixed(2),t.orders_discount_money=Number((e.orders_discount_money||0)/100).toFixed(2),t.settle_money=Number((e.settle_money||0)/100).toFixed(2),t.unsettle_money=(Number(t.orders_total_money)-Number(t.settle_money)).toFixed(2),t.orders_goods=e.orders_goods.map(e=>{const t=Object.assign({},e);return t.goods_ori_price=((e.goods_ori_price||t.goods_price)/100).toFixed(2),t.total_ori_money=((e.total_ori_money||t.total_money)/100).toFixed(2),t.goods_rate=Number(e.goods_rate||100).toFixed(2),t.total_money=(e.total_money/100).toFixed(2),t.goods_price=(e.goods_price/100).toFixed(2),t})},fetchSalesOrders(){if(this.salesOrdersList.length>0)return;const e=this.detail.sales_orders_ids||[];0!==e.length&&(this.salesLoading=!0,Object(u["a"])("prepare/listSalesOrders",{ordersId:this.ordersId},{functionName:"xunda"}).then(e=>{this.salesOrdersList=e.data||[],this.salesLoading=!1}))},approvedOrders(){this.$confirm("确定要通过该订单？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"success"}).then(()=>{Object(u["a"])("prepare/approvedOrders",{ordersId:this.ordersId},{functionName:"xunda"}).then(e=>{this.$message({type:"success",message:"操作成功!"}),this.fetchDetail()})})},deleteOrders(){this.$confirm("确定要删除该订单？","告警提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{Object(u["a"])("prepare/deleteOrders",{ordersId:this.ordersId},{functionName:"xunda"}).then(e=>{this.$message({type:"success",message:"删除成功!"}),setTimeout(()=>this.$common.closePage(),500)})})},completedOrders(){Object(u["a"])("prepare/completeOrders",{ordersId:this.ordersId},{functionName:"xunda"}).then(e=>{this.$message({type:"success",message:"操作成功!"}),this.fetchDetail()})},arraySpanMethod({row:e,column:t,rowIndex:s,columnIndex:a}){if(a>1)return[1,9]}}},g=m,p=(s("ec7a"),Object(d["a"])(g,a,o,!1,null,null,null));t["default"]=p.exports},3167:function(e,t,s){"use strict";s("298e")},ec7a:function(e,t,s){"use strict";s("f05a")},f05a:function(e,t,s){}}]);