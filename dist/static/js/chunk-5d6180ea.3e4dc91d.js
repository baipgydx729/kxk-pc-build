(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5d6180ea"],{"23ab":function(o,e,t){},"78dc":function(o,e,t){"use strict";t("23ab")},b7ac:function(o,e,t){"use strict";var s=function(){var o=this,e=o.$createElement,t=o._self._c||e;return t("div",{staticClass:"orders-goods-table"},[t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:o.loading,expression:"loading"}],ref:"goodsTable",staticClass:"aux-table",attrs:{data:o.goodsList,border:"",fit:"",stripe:"","row-key":"id"}},[t("el-table-column",{attrs:{type:"index",width:"50",align:"center",label:"序号"},scopedSlots:o._u([{key:"default",fn:function(e){return[t("span",{staticClass:"padding-xs drag-btn",staticStyle:{cursor:"move"}},[o._v(o._s(e.$index+1))])]}}])}),t("el-table-column",{attrs:{width:"120",align:"center",label:"操作"},scopedSlots:o._u([{key:"default",fn:function(e){return[t("el-button",{staticStyle:{padding:"6px 12px"},attrs:{type:"default",size:"mini",icon:"el-icon-plus",round:""},on:{click:function(t){return o.handleItemPlus(e.row,e.$index)}}}),t("el-button",{staticStyle:{padding:"6px 12px"},attrs:{type:"default",size:"mini",icon:"el-icon-minus",round:""},on:{click:function(t){return o.handleItemMinus(e.row,e.$index)}}})]}}])}),t("el-table-column",{attrs:{width:"280",align:"left",label:"商品名称"},scopedSlots:o._u([{key:"default",fn:function(e){return[e.row.goods_name?t("div",{staticClass:"dflex"},[t("div",{staticClass:"goods-img"},[t("img",{attrs:{src:e.row.goods_img||"/static/img/img-empty.png",alt:""}})]),t("div",{staticClass:"flex1"},[t("div",[o._v(o._s(e.row.goods_name))]),e.row.goods_no?t("div",{staticClass:"fs-xs ft-grey"},[o._v("No："+o._s(e.row.goods_no))]):o._e()])]):t("div",[t("AuxGoodsSelectPopoer",{on:{change:function(t){return o.changeItemGoods(t,e.row)}},model:{value:e.row.goods_id,callback:function(t){o.$set(e.row,"goods_id",t)},expression:"scope.row.goods_id"}})],1)]}}])}),t("el-table-column",{attrs:{width:"200",align:"left",label:"规格/属性"},scopedSlots:o._u([{key:"default",fn:function(e){return[o._v(o._s(e.row.goods_spec))]}}])}),t("el-table-column",{attrs:{width:"130",align:"center",label:"单位"},scopedSlots:o._u([{key:"default",fn:function(e){return[t("el-select",{attrs:{disabled:!e.row.goods_name,placeholder:"单位"},on:{focus:function(t){return o.remoteItemGoodsUnitMethod(e.row)},change:function(t){return o.changeItemGoodsUnit(e.row)}},model:{value:e.row.goods_unit,callback:function(t){o.$set(e.row,"goods_unit",t)},expression:"scope.row.goods_unit"}},o._l(o.getItemGoodsUnitOptions(e.row.goods_id),(function(e){return t("el-option-group",{key:e.label,attrs:{label:e.label}},o._l(e.children,(function(e){return t("el-option",{key:e.unit,attrs:{label:e.unit+(e.unit_desc||""),value:e.unit}},[t("span",[o._v(o._s(e.unit)+o._s(e.unit_desc))])])})),1)})),1)]}}])}),t("el-table-column",{attrs:{width:"120",align:"center",label:"数量",prop:"goods_cnt"},scopedSlots:o._u([{key:"default",fn:function(e){return[t("el-input",{staticClass:"tac",attrs:{disabled:!e.row.goods_name,oninput:"value=value.match(/^\\d+(?:\\.\\d{0,2})?/)",onfocus:"this.select();",placeholder:"数量"},on:{blur:o.changeOrdersCompleted},model:{value:e.row.goods_cnt,callback:function(t){o.$set(e.row,"goods_cnt",t)},expression:"scope.row.goods_cnt"}})]}}])}),t("el-table-column",{attrs:{width:"120",align:"right",label:"原价(元)"},scopedSlots:o._u([{key:"default",fn:function(e){return[t("el-input",{staticClass:"tar",attrs:{disabled:!e.row.goods_name,oninput:"value=value.match(/^\\d+(?:\\.\\d{0,2})?/)",onfocus:"this.select();",placeholder:"原价"},on:{blur:function(t){return o.changeItemGoodsOriPrice(e.row)}},model:{value:e.row.goods_ori_price,callback:function(t){o.$set(e.row,"goods_ori_price",t)},expression:"scope.row.goods_ori_price"}})]}}])}),t("el-table-column",{attrs:{width:"120",align:"right",label:"折扣(%)"},scopedSlots:o._u([{key:"default",fn:function(e){return[t("el-input",{staticClass:"tar",attrs:{disabled:!e.row.goods_name,min:"0",max:"100",oninput:"value=value.match(/^\\d+(?:\\.\\d{0,2})?/)",onfocus:"this.select();",placeholder:"折扣"},on:{blur:function(t){return o.changeItemGoodsRate(e.row)}},model:{value:e.row.goods_rate,callback:function(t){o.$set(e.row,"goods_rate",t)},expression:"scope.row.goods_rate"}})]}}])}),t("el-table-column",{attrs:{width:"120",align:"right",label:"单价(元)"},scopedSlots:o._u([{key:"default",fn:function(e){return[t("el-input",{staticClass:"tar",attrs:{disabled:!e.row.goods_name,oninput:"value=value.match(/^\\d+(?:\\.\\d{0,2})?/)",onfocus:"this.select();",placeholder:"单价"},on:{blur:function(t){return o.changeItemGoodsPrice(e.row)}},model:{value:e.row.goods_price,callback:function(t){o.$set(e.row,"goods_price",t)},expression:"scope.row.goods_price"}})]}}])}),t("el-table-column",{attrs:{width:"120",align:"right",label:"金额小计(元)",prop:"total_money"},scopedSlots:o._u([{key:"default",fn:function(e){return[o._v(o._s(e.row.total_money))]}}])}),t("el-table-column",{attrs:{align:"left",label:"备注","show-overflow-tooltip":""},scopedSlots:o._u([{key:"default",fn:function(e){return[t("el-popover",{attrs:{placement:"top-start",title:"编辑备注信息",width:"300",trigger:"click"}},[t("el-input",{attrs:{type:"textarea",rows:2,placeholder:"请输入备注"},model:{value:e.row.remark,callback:function(t){o.$set(e.row,"remark",t)},expression:"scope.row.remark"}}),t("span",{staticClass:"link-hover ft-primary",attrs:{slot:"reference"},slot:"reference"},[o._v(" "+o._s(e.row.remark||"编辑")+" ")])],1)]}}])})],1),t("div",{staticClass:"dflex-b padding"},[t("div",{staticClass:"dflex-s"},[t("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-plus"},on:{click:o.handleSelectAdd}},[o._v("选择商品")]),o.scanForm.visible?t("el-input",{ref:"scanInput",staticClass:"margin-lr-sm",staticStyle:{width:"260px"},attrs:{clearable:"",size:"small",placeholder:"请扫描商品编码或条形码"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&o._k(e.keyCode,"enter",13,e.key,"Enter")?null:o.handleScanAdd(e)}},model:{value:o.scanForm.keyword,callback:function(e){o.$set(o.scanForm,"keyword",e)},expression:"scanForm.keyword"}}):o._e(),t("el-button",{attrs:{type:"default",size:"small",icon:"el-icon-full-screen"},on:{click:o.handleScanOpen}},[o._v(" "+o._s(o.scanForm.visible?"取消扫码":"扫码录入")+" ")]),t("el-button",{attrs:{type:"default",size:"small",icon:"el-icon-folder-opened"},on:{click:o.handleImportAdd}},[o._v("导入商品")])],1),t("div",{staticClass:"dflex-e"},[t("span",{staticClass:"padding-left-lg"},[o._v("商品数量："+o._s(o.goodsTotalCount))]),t("span",{staticClass:"padding-left-lg"},[o._v("原价金额："+o._s(o.goodsOriginalMoney.toFixed(2)))]),t("span",{staticClass:"padding-left-lg"},[o._v("折扣优惠："+o._s(o.goodsDiscountMoney.toFixed(2)))]),t("span",{staticClass:"padding-left-lg"},[o._v("商品总额："+o._s(o.goodsTotalMoney.toFixed(2)))])])]),t("ImportGoodsDialog",{ref:"importGoodsDialog",on:{onSuccess:o.importGoodsSuccess}}),t("AuxGoodsSelectDialog",{ref:"auxGoodsSelectDialog",on:{onSuccess:o.selectedGoodsSuccess}})],1)},n=[],i=t("2909"),a=(t("d81d"),t("498a"),t("d3b7"),t("159b"),t("a434"),t("b0c0"),t("4de4"),t("a9e3"),t("b680"),t("13d5"),t("caad"),t("2197")),r=t("c031"),d=t("b122"),l=t("15f6"),c=t("cb68"),u=t("e5bb"),g=t("53fe"),p=t.n(g),m={components:{AuxGoodsSelectPopoer:l["a"],ImportGoodsDialog:c["a"],AuxGoodsSelectDialog:d["a"]},props:{loading:{type:Boolean,default:!1}},data:function(){return{goodsList:[this.formatItemGoods()],goodsSelectIds:[],goodsSaleGrade:0,goodsTotalCount:0,goodsOriginalMoney:0,goodsDiscountMoney:0,goodsTotalMoney:0,goodsUnitMap:{},scanForm:{visible:!1,keyword:""}}},mounted:function(){var o=this,e=document.querySelector(".aux-table .el-table__body-wrapper table tbody");p.a.create(e,{animation:150,ghostClass:"blue-background-class",handle:".drag-btn",onEnd:function(e){var t=Object(i["a"])(o.goodsList),s=t[e.oldIndex];t[e.oldIndex]=t[e.newIndex],t[e.newIndex]=s,o.goodsList=[],o.$nextTick((function(){o.goodsList=t})),console.log(o.goodsList)},onChoose:function(o){o.oldIndex},onUnchoose:function(o){}})},methods:{initData:function(o){var e=this;this.goodsList=o.map((function(o){return e.formatItemGoods(o)})),this.changeOrdersCompleted()},handleScanOpen:function(){var o=this;this.scanForm.visible=!this.scanForm.visible,this.scanForm.visible&&this.$nextTick((function(){o.$refs.scanInput.focus()}))},handleScanAdd:function(){var o=this,e=this.scanForm.keyword.trim();e&&(this.scanForm.keyword="",Object(a["a"])("goods/getGoodsByCode",{code:e},{functionName:"xunda"}).then((function(e){var t=o.formatItemGoods(e.data,{remark:"",goods_cnt:1});o.initGoodsUnit(t),o.goodsList.push(t)})))},handleSelectAdd:function(){this.$refs.auxGoodsSelectDialog.open()},selectedGoodsSuccess:function(o){var e=this;o.forEach((function(o){e.initGoodsUnit(o),e.goodsList.push(e.formatItemGoods(o,{remark:"",goods_cnt:o.goods_cnt}))})),this.changeOrdersCompleted()},handleImportAdd:function(){this.$refs.importGoodsDialog.open()},importGoodsSuccess:function(o){var e=this;o.forEach((function(o){var t=e.formatItemGoods(o);e.initGoodsUnit(t),e.goodsList.push(t)}))},handleItemPlus:function(o,e){this.goodsList.splice(e+1,0,this.formatItemGoods())},handleItemMinus:function(o,e){this.goodsList.splice(e,1),0===this.goodsList.length&&this.goodsList.push(this.formatItemGoods()),this.changeOrdersCompleted()},initGoodsUnit:function(o){this.goodsUnitMap[o._id]=o.unit_list||[]},formatItemGoods:function(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=o.goods_price||this.$common.cent2yuan(o.price||0),s={goods_id:o.goods_id||o._id||"",goods_sku_id:o.goods_sku_id||o.sku_id||"",goods_no:o.goods_no||o.code||"",goods_img:o.goods_img||o.img||"",goods_name:o.goods_name||o.name||"",goods_spec:o.goods_spec||o.spec||"",goods_cnt:o.goods_cnt||e.goods_cnt||0,goods_unit:o.goods_unit||o.unit||"",goods_ori_price:o.goods_ori_price||t||0,goods_rate:o.goods_rate||100,goods_price:t,total_money:o.total_money||0,remark:o.remark||e.remark||""};return s},changeItemGoods:function(o,e){var t=this;e.goodsId||(o.goods?(Object.assign(e,this.formatItemGoods(o.goods,{remark:e.remark,goods_cnt:1})),this.initGoodsUnit(o.goods),this.changeOrdersCompleted()):Object(a["a"])("goods/getInfo",{goods_id:e.goods_id},{functionName:"xunda"}).then((function(o){var s=Object.assign(e,t.formatItemGoods(o.data,{remark:e.remark,goods_cnt:1}));t.initGoodsUnit(s),t.changeOrdersCompleted()})),o.others&&o.others.length>0&&(o.others.forEach((function(o){var e=t.formatItemGoods(Object.assign(o,{remark:o.remark,goods_cnt:1}));t.goodsList.push(e)})),this.changeOrdersCompleted()))},getItemGoodsUnitOptions:function(o){if(!o)return[];var e=this.goodsUnitMap[o]||[];if(0===e.length)return[];var t=[{label:"默认单位",children:e.filter((function(o){return 1===o.scale}))}],s=e.filter((function(o){return 1!==o.scale}));return s.length>0&&t.push({label:"辅助单位",children:s}),t},remoteItemGoodsUnitMethod:function(o){var e=this;if(o.goods_id){var t=this.goodsUnitMap[o.goods_id]||[];t.length>1||Object(a["a"])("goods/getInfo",{goods_id:o.goods_id},{functionName:"xunda"}).then((function(o){var t=o.data;e.goodsUnitMap[t._id]=t.unit_list,Object(r["f"])(t),e.goodsList=Object(i["a"])(e.goodsList)}))}},changeItemGoodsUnit:function(o){if(o.goods_id){var e=this.goodsUnitMap[o.goods_id]||[],t=e.filter((function(e){return e.unit===o.goods_unit}));if(0!==t.length){var s=t[0],n=Object(r["b"])(o.goods_id);if(n){var i=u["a"].mul(n.price,s.scale),a=n.sku_datas.filter((function(e){return e.name===o.goods_spec}));if(a.length>0){var d=a.filter((function(e){return e.unit===o.goods_unit}));d.length>0&&(i=d[0].price||0)}var l=Number(i/100);o.goods_ori_price=l.toFixed(2);var c=u["a"].div(o.goods_rate||0,100).toFixed(2);o.goods_price=o.goods_ori_price*c,o.goods_rate=Number(o.goods_rate).toFixed(2),this.changeOrdersCompleted()}}}},changeItemGoodsOriPrice:function(o){var e=Number(o.goods_ori_price||0),t=Number(o.goods_rate||0);o.goods_price=e*(t/100),this.changeOrdersCompleted()},changeItemGoodsRate:function(o){var e=Number(o.goods_ori_price||0),t=Math.max(Math.min(100,Number(o.goods_rate||0)),0);o.goods_rate=t.toFixed(2),o.goods_price=e*(o.goods_rate/100),this.changeOrdersCompleted()},changeItemGoodsPrice:function(o){var e=Number(o.goods_ori_price||0),t=Math.min(Number(o.goods_ori_price||0),Number(o.goods_price||0));o.goods_price=t.toFixed(2),o.goods_rate=(t/e*100).toFixed(2),this.changeOrdersCompleted()},changeOrdersCompleted:function(){this.goodsList.forEach((function(o){o.goods_ori_price=Number(o.goods_ori_price||0).toFixed(2),o.goods_cnt=Number(o.goods_cnt||0),o.goods_price=Number(o.goods_price||0).toFixed(2),o.total_ori_money=(o.goods_cnt*o.goods_ori_price).toFixed(2),o.total_money=(o.goods_cnt*o.goods_price).toFixed(2)})),this.goodsTotalCount=this.goodsList.reduce((function(o,e){return o+e.goods_cnt}),0),this.goodsOriginalMoney=this.goodsList.reduce((function(o,e){return o+Number(e.total_ori_money)}),0),this.goodsTotalMoney=this.goodsList.reduce((function(o,e){return o+Number(e.total_money)}),0),this.goodsDiscountMoney=this.goodsOriginalMoney-this.goodsTotalMoney,this.$emit("change")},getSummaryData:function(){return{goodsTotalCount:this.goodsTotalCount,goodsOriginalMoney:this.goodsOriginalMoney,goodsDiscountMoney:this.goodsDiscountMoney,goodsTotalMoney:this.goodsTotalMoney}},getListData:function(){return this.goodsList.filter((function(o){return!!o.goods_name}))},summaryMethod:function(o){var e=o.columns,t=o.data,s=[];return e.forEach((function(o,e){if(0!==e)if(["goods_cnt","total_money"].includes(o.property)){var n=t.map((function(e){return Number(e[o.property])}));n.every((function(o){return isNaN(o)}))?s[e]="":(s[e]=n.reduce((function(o,e){return o+e}),0),["total_money"].includes(o.property)&&(s[e]=s[e].toFixed(2)))}else s[e]=" ";else s[e]="合计"})),s}}},f=m,_=(t("78dc"),t("2877")),h=Object(_["a"])(f,s,n,!1,null,null,null);e["a"]=h.exports},cb68:function(o,e,t){"use strict";var s=function(){var o=this,e=o.$createElement,t=o._self._c||e;return t("el-dialog",{attrs:{title:"销售商品导入",visible:o.dialogVisible,width:"50%","before-close":o.close,"append-to-body":"","custom-class":"import-dialog"},on:{"update:visible":function(e){o.dialogVisible=e}}},[t("div",{directives:[{name:"loading",rawName:"v-loading",value:o.loadOpts.loading,expression:"loadOpts.loading"}],staticClass:"dialog-warpper",attrs:{"element-loading-text":o.loadOpts.loadtext}},[t("div",{staticClass:"grid-box-2"},[t("div",{staticClass:"flex1",on:{click:o.downloadTemp}},[t("span",[o._v("1.下载Excel模板")]),t("div",{staticClass:"box-item margin-top"},[t("div",{staticClass:"icon el-icon-document"}),t("div",{staticClass:"txt fs"},[o._v("点击下载Excel模板")])])]),t("div",{staticClass:"flex1"},[t("span",[o._v("2.上传Excel文件")]),t("div",{staticClass:"box-item margin-top"},[t("upload-excel-component",{attrs:{"skin-row":o.skinRow,"before-upload":o.beforeUpload,"on-success":o.uploadSuccess,"on-error":o.uploadError}})],1)])])]),o.errorMsg?t("div",{staticClass:"dialog-error"},[t("p",[o._v("异常错误")]),t("div",[o._v(o._s(o.errorMsg))])]):o._e(),t("div",{staticClass:"dialog-footer"},[t("p",[o._v("操作指引")]),t("p",[o._v("1、下载Excel模板，填写Excel表格;")]),t("p",[o._v("2、将文件拖动到虚线框 -> 系统自动检验数据;")]),t("p",[o._v("3、数据导入成功;")])])])},n=[],i=(t("d81d"),t("a15b"),t("3796")),a=t("c7eb"),r=t("1da1"),d=(t("ac1f"),t("00b4"),t("d3b7"),t("159b"),t("b64b"),t("b0c0"),t("3ca3"),t("ddb0"),t("2a95")),l={"商品ID":{name:"goods_id",type:"string"},"商品图片":{name:"goods_img",type:"url",message:"商品图片必需是完整的Url地址"},"商品名称":{name:"goods_name",type:"any",required:!0,message:"商品名称不能为空"},"商品编号*":{name:"goods_no",type:"any",required:!0,message:"商品编号不能为空"},"规格":{name:"goods_spec",type:"string",message:"商品规格必需是字符"},"单位":{name:"goods_unit",type:"string",message:"商品单位不能为空"},"数量*":{name:"goods_cnt",type:"number",required:!0,validator:function(o,e,t,s,n){var i=/((^[1-9]\d*)|^0)(\.\d{0,2}){0,1}$/;i.test(e)||t("数量*必需为数字"),t()}},"折扣":{name:"goods_rate",type:"number",validator:function(o,e,t,s,n){var i=/((^[1-9]\d*)|^0)(\.\d{0,2}){0,1}$/;!e||i.test(e)?t():t("折扣必需为1~100内数字")}},"单价":{name:"goods_price",type:"number",message:"单价必需是数字"},"备注":{name:"remark",type:"string"}};function c(o,e){return Object.keys(o).forEach((function(t){var s=o[t],n=e[t];n&&(o[n.name]=n.handle?n.handle(s):s)})),o}function u(o){return g.apply(this,arguments)}function g(){return g=Object(r["a"])(Object(a["a"])().mark((function o(e){var t,s,n;return Object(a["a"])().wrap((function(o){while(1)switch(o.prev=o.next){case 0:return e.header,t=e.dataList,s=new d["a"](l),n=t.map((function(o,e){return new Promise((function(t,n){s.validate(o,(function(s,i){s&&n({errors:s,rowIndex:e}),t(c(o,l))}))}))})),o.next=5,Promise.all(n);case 5:return o.abrupt("return",o.sent);case 6:case"end":return o.stop()}}),o)}))),g.apply(this,arguments)}var p={components:{UploadExcelComponent:i["a"]},props:{fileType:{type:String,default:function(){return""}}},data:function(){return{dialogVisible:!1,skinRow:1,loadOpts:{loading:!1,loadtext:"正在加载中"},downOpts:{fileName:"销售导入商品模板_"+(new Date).getTime()+".xlsx",tempUrl:location.protocol+"//"+location.host+"/static/excel/template/salesPrepareTemplate.xlsx"},tableHeader:[],tableData:[],errorMsg:""}},methods:{open:function(){this.dialogVisible=!0},close:function(){this.errorMsg="",this.dialogVisible=!1},downloadTemp:function(){var o=document.createElement("a");o.style.display="none",o.download=this.downOpts.fileName,o.href=this.downOpts.tempUrl,document.body.appendChild(o),o.click(),document.body.removeChild(o)},beforeUpload:function(o){this.errorMsg="",this.loadOpts.loading=!0;var e=o.size/1024/1024<1;return!!e||(this.$message({message:"请不要上传大于1M的文件",type:"warning"}),this.loadOpts.loading=!1,!1)},uploadSuccess:function(o){var e=this,t=o.header,s=o.results;this.tableHeader=t,this.tableData=s,this.loadOpts.loading=!0,this.loadOpts.loadtext="正在校验数据",u({header:t,dataList:s}).then((function(o){setTimeout((function(){e.loadOpts.loading=!1,e.$emit("onSuccess",o),e.close()}),1e3)})).catch((function(o){e.loadOpts.loading=!1;var t=o.errors;if(t){var s=t.map((function(o,e){return e+1+"."+o.field+": "+o.message}));e.errorMsg=s.join("; ")}}))},uploadError:function(o){console.log(o),this.loadOpts.loading=!1}}},m=p,f=(t("e64f"),t("2877")),_=Object(f["a"])(m,s,n,!1,null,null,null);e["a"]=_.exports},e64f:function(o,e,t){"use strict";t("f989")},f989:function(o,e,t){}}]);