(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-54755311"],{"0aeb":function(e,t,a){"use strict";a("a68b")},"5f65":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("div",{staticClass:"aux-card"},[a("div",{staticClass:"header"},[e._m(0),a("div",{staticClass:"right"},[a("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["sales-orders-create"],expression:"['sales-orders-create']"}],attrs:{type:"primary",icon:"el-icon-plus"},on:{click:function(t){return e.$common.toPage("./orders-create/")}}},[e._v("销售开单")]),a("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["sales-orders-export"],expression:"['sales-orders-export']"}],attrs:{loading:e.exportLoading,icon:"el-icon-download"},on:{click:e.handleExportData}},[e._v("导出数据")])],1)]),a("div",{staticClass:"filter-container margin-top-sm"},[a("el-form",{ref:"baseForm",attrs:{"label-width":"100px","label-align":"right"}},[e.showMoreFilter?e._e():a("div",{staticClass:"dflex-b padding-lr"},[a("div",{staticClass:"dflex-s flex1"},[a("el-select",{staticStyle:{width:"120px"},attrs:{clear:!1},model:{value:e.reqData.state,callback:function(t){e.$set(e.reqData,"state",t)},expression:"reqData.state"}},e._l(e.compStates,(function(e){return a("el-option",{key:e.value,attrs:{label:e.name,value:e.value}})})),1),a("el-date-picker",{staticClass:"margin-left-sm",staticStyle:{width:"300px"},attrs:{type:"daterange","range-separator":" - ","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.reqData.dateRange,callback:function(t){e.$set(e.reqData,"dateRange",t)},expression:"reqData.dateRange"}}),a("el-input",{staticClass:"margin-left-sm",staticStyle:{width:"300px"},attrs:{placeholder:"请输入单号搜索"},on:{confirm:e.fetchDataList},model:{value:e.reqData.ordersNo,callback:function(t){e.$set(e.reqData,"ordersNo",t)},expression:"reqData.ordersNo"}}),a("el-button",{staticClass:"margin-left-sm",attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.handleSearch}},[e._v("查 询")])],1),a("div",{staticStyle:{"text-align":"right"}},[a("el-button",{attrs:{type:"text"},on:{click:function(t){e.showMoreFilter=!e.showMoreFilter}}},[e._v(" 更多筛选 "),a("i",{staticClass:"el-icon-arrow-down"})])],1)]),e.showMoreFilter?a("div",{staticClass:"padding-lr"},[a("div",{staticClass:"row dflex-b"},[a("el-form-item",{attrs:{label:"下单时间"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"daterange","range-separator":" - ","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.reqData.dateRange,callback:function(t){e.$set(e.reqData,"dateRange",t)},expression:"reqData.dateRange"}})],1),a("el-form-item",{attrs:{label:"选择客户"}},[a("AuxStoreSelect",{model:{value:e.reqData.storeId,callback:function(t){e.$set(e.reqData,"storeId",t)},expression:"reqData.storeId"}})],1),a("el-form-item",{attrs:{label:"订单号"}},[a("el-input",{attrs:{placeholder:"请输入单号搜索"},model:{value:e.reqData.ordersNo,callback:function(t){e.$set(e.reqData,"ordersNo",t)},expression:"reqData.ordersNo"}})],1)],1),a("div",{staticClass:"row dflex-b"},[a("el-form-item",{attrs:{label:"商品信息"}},[a("AuxGoodsSelect",{model:{value:e.reqData.goodsId,callback:function(t){e.$set(e.reqData,"goodsId",t)},expression:"reqData.goodsId"}})],1),a("el-form-item",{attrs:{label:"出货仓库"}},[a("AuxWarehouseSelect",{attrs:{multi:""},model:{value:e.reqData.warehouseIds,callback:function(t){e.$set(e.reqData,"warehouseIds",t)},expression:"reqData.warehouseIds"}})],1),a("el-form-item",{attrs:{label:"业务员"}},[a("AuxMemberSelect",{attrs:{multi:""},model:{value:e.reqData.userIds,callback:function(t){e.$set(e.reqData,"userIds",t)},expression:"reqData.userIds"}})],1)],1),a("div",{staticClass:"row dflex-b"},[a("el-form-item",{attrs:{label:"下单区域"}},[a("AuxAreaPicker",{model:{value:e.reqData.areaIds,callback:function(t){e.$set(e.reqData,"areaIds",t)},expression:"reqData.areaIds"}})],1),a("div"),a("div")],1),a("div",{staticClass:"row"},[a("el-form-item",{attrs:{label:"单据状态"}},[a("AuxMultiCheckbox",{attrs:{"local-data":e.$constant.ORDERS_STATES},model:{value:e.reqData.state,callback:function(t){e.$set(e.reqData,"state",t)},expression:"reqData.state"}})],1),a("el-form-item",{attrs:{label:"结算状态"}},[a("AuxMultiCheckbox",{attrs:{"local-data":e.settleState},model:{value:e.reqData.settleState,callback:function(t){e.$set(e.reqData,"settleState",t)},expression:"reqData.settleState"}})],1)],1),a("div",{},[a("el-button",{attrs:{type:"default"},on:{click:function(t){e.showMoreFilter=!e.showMoreFilter}}},[e._v("取消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.handleSearch}},[e._v("执行查询")])],1)]):e._e()])],1),a("el-menu",{staticClass:"el-menu-big",attrs:{"default-active":e.activeIndex,mode:"horizontal"},on:{select:e.handleTabSelect}},e._l(e.compStates,(function(t){return a("el-menu-item",{key:t.code,attrs:{index:t.code}},[e._v(e._s(t.name))])})),1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.dataLoading,expression:"dataLoading"}],staticClass:"aux-table",attrs:{data:e.dataList,border:"",fit:"",stripe:""}},[a("el-table-column",{attrs:{type:"selection",width:"55",align:"center",fixed:""}}),a("el-table-column",{attrs:{width:"200",align:"left",label:"销售单号",fixed:""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("router-link",{attrs:{to:"orders-detail/"+t.row._id}},[a("span",{staticClass:"link-hover"},[e._v(e._s(t.row.orders_no))])])]}}])}),a("el-table-column",{attrs:{width:"180",align:"left",label:"下单时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("formatDate")(t.row.orders_date)))]}}])}),a("el-table-column",{attrs:{width:"180",align:"left",label:"客户名称","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.receiver.name))])]}}])}),a("el-table-column",{attrs:{width:"100",align:"center",label:"商品件数"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v("x"+e._s(t.row.goods_total_count||t.row.total_goods_count||t.row.orders_goods_count))])]}}])}),a("el-table-column",{attrs:{width:"120",align:"right",label:"订单金额"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("cent2yuan")(t.row.orders_total_money)))]}}])}),a("el-table-column",{attrs:{width:"120",align:"center",label:"收款状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("formatTypeName")(t.row.settle_state||0,e.settleState)))]}}])}),a("el-table-column",{attrs:{width:"120",align:"right",label:"收款金额"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("cent2yuan")(t.row.settle_money)))]}}])}),a("el-table-column",{attrs:{width:"120",align:"center",label:"订单状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("formatKeyValue")(t.row.state,e.$constant.ORDERS_STATES,"value","next"))+" ")]}}])}),a("el-table-column",{attrs:{width:"120",align:"center",label:"经办人"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.create_uname))]}}])}),a("el-table-column",{attrs:{align:"left",label:"备注","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.orders_remark))]}}])}),a("el-table-column",{attrs:{width:"120",align:"center",label:"操作",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.$common.toPage("./orders-detail/"+t.row._id)}}},[e._v("详情")]),!t.row.state||t.row.state<1?a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.$common.toPage("./orders-create?type=edit&id="+t.row._id)}}},[e._v("编辑")]):e._e()]}}])})],1),a("div",{staticClass:"padding-sm dflex-c"},[a("el-pagination",{attrs:{background:"","page-size":e.pagination.pageSize,total:e.pagination.totalCount,"current-page":e.pagination.pageNo,"page-sizes":[10,15,20,30,50],layout:"total, prev, pager, next, sizes","hide-on-single-page":""},on:{"size-change":e.changePageSize,"current-change":e.changePageNo}})],1)],1),a("el-dialog",{attrs:{title:"确认导出",visible:e.exportDialog.visible,width:"30%"},on:{"update:visible":function(t){return e.$set(e.exportDialog,"visible",t)}}},[a("div",{staticClass:"padding-lr-sm"},[e._v("即将导出销售单数据。如需导出明细数据，请勾选下方复选框。")]),a("div",{staticClass:"padding-lr-sm padding-top"},[a("div",{staticClass:"padding-bottom-sm"},[a("el-checkbox",{model:{value:e.exportDialog.hasDetail,callback:function(t){e.$set(e.exportDialog,"hasDetail",t)},expression:"exportDialog.hasDetail"}},[e._v(" 需要导出订单销售明细 "),a("span",{staticClass:"ft-grey"},[e._v("（注：可能耗时较长）")])])],1),a("div",[a("el-checkbox",{model:{value:e.exportDialog.hasCostProfit,callback:function(t){e.$set(e.exportDialog,"hasCostProfit",t)},expression:"exportDialog.hasCostProfit"}},[e._v(" 需要导出订单成本/利润 "),a("span",{staticClass:"ft-grey"},[e._v("（注：仅管理员可以导出）")])])],1)]),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"default"},on:{click:function(t){e.exportDialog.visible=!1}}},[e._v("取消")]),a("el-button",{attrs:{type:"primary",loading:e.exportLoading},on:{click:e.confirmExportData}},[e._v("导出数据")])],1)])],1)},l=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"left"},[a("span",{staticClass:"title"},[e._v("销售订单")])])}],o=a("e177"),i=a.n(o),n=a("2197"),r=a("a1b8"),c=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"dflex-s"},[a("el-checkbox",{staticClass:"padding-right-lg",attrs:{indeterminate:e.isIndeterminate},on:{change:e.handleCheckAllChange},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}},[e._v("全选")]),a("el-checkbox-group",{on:{change:e.change},model:{value:e.values,callback:function(t){e.values=t},expression:"values"}},e._l(e.dataList,(function(t){return a("el-checkbox",{key:t.value,attrs:{label:t.name}},[e._v(e._s(t.name))])})),1)],1)},d=[],u={name:"AuxMutilCheckbox",props:{value:Array,localData:{type:Array,default:[]}},data(){return{checkAll:!1,dataList:[],values:[],isIndeterminate:!0}},watch:{localData:{immediate:!0,handler(e,t){Array.isArray(e)&&t!==e&&(this.dataList=this.localData.map(e=>(e.text=e.name,e)))}}},methods:{handleCheckAllChange(e){this.values=e?this.dataList:[],this.isIndeterminate=!1},handleCheckedCitiesChange(e){const t=e.length;this.checkAll=t===this.dataList.length,this.isIndeterminate=t>0&&t<this.cities.length},inputAll(e){"all"==e[0]?(this.values=this.dataList.map(e=>e.value),this.$emit("input",[])):(this.values=[],this.$emit("input",this.values))},change(e){this.values.length==this.dataList.length?(this.all.push("all"),this.$emit("input",[])):(this.all=[],this.$emit("input",this.values))}}},h=u,p=a("2877"),m=Object(p["a"])(h,c,d,!1,null,null,null),f=m.exports,g=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-select",{staticClass:"w-full",attrs:{placeholder:"输入商品名称/编码查询",filterable:"",clearable:"",remote:"","remote-method":e.remoteMethod,loading:e.loading},on:{change:e.change,focus:e.initLoad},model:{value:e.modelValue,callback:function(t){e.modelValue=t},expression:"modelValue"}},e._l(e.dataList,(function(t){return a("el-option",{key:t.value,attrs:{label:t.name,value:t.value}},[a("div",{staticClass:"dflex-b"},[a("div",[a("span",[e._v(e._s(t.name))]),a("span",{staticClass:"fs-xs ft-grey"},[e._v("- "+e._s(t.code))])]),a("div",{staticClass:"padding-left-lg fs-xs ft-grey"},[(t.spec_list||[]).length>0?a("div",[e._v(" 多规格: "),e._l(t.spec_list,(function(t,s){return a("span",{key:s},[e._v(e._s(t.name+"("+t.values.length+")")+";")])}))],2):t.spec?a("div",[e._v("规格: "+e._s(t.spec))]):e._e()])])])})),1)],1)},v=[],b=a("c031"),x={name:"AuxSelectGoods",props:{value:{type:[String,Array],default:()=>""}},data(){return{loading:!1,dataList:[],modelValue:""}},methods:{initLoad(){if(this.dataList.length>0)return;const e=Object(b["d"])();e.length>0?this.dataList=e.splice(0,15).map(e=>(e.name=e.name||"",e.value=e.goods_id,e)):this.fetchData()},fetchData(e=""){this.loading=!0,Object(n["a"])("goods/list",{pageSize:10,simple:!0,keyword:e},{functionName:"xunda"}).then(e=>{this.loading=!1;const t=(e.data||[]).map(e=>(e.name=e.name||"",e.value=e.goods_id,e));Object(b["f"])(t),this.dataList=t})},remoteMethod(e){e&&""!==e?(this.loading=!0,clearTimeout(this.timer),this.timer=setTimeout(()=>this.fetchData(e),200)):this.dataList=[]},change(){this.$nextTick(()=>{this.$emit("input",this.modelValue),this.$emit("change",{goodsId:this.modelValue,goods:Object(b["b"])(this.modelValue)})})}}},_=x,w=Object(p["a"])(_,g,v,!1,null,null,null),D=w.exports,k=a("2051"),y=a("b866"),S=a("c3dd"),C=a("f63d"),q={name:"SalesOrdersList",components:{AuxMultiCheckbox:f,AuxGoodsSelect:D,AuxStoreSelect:k["a"],AuxMemberSelect:y["a"],AuxWarehouseSelect:S["a"],AuxAreaPicker:C["a"]},data(){return{permission:"sales-orders-query",states:[{name:"全 部",code:"all",value:""},{name:"待审核",code:"unApproval",value:0},{name:"待出库",code:"unStock",value:1,module:"stock"},{name:"待发货",code:"unSend",value:2},{name:"待签收",code:"unSign",value:3},{name:"已完成",code:"complated",value:9}],settleState:[{name:"未收款",value:0},{name:"部分收款",value:1},{name:"已收款",value:9}],activeIndex:"all",showMoreFilter:!1,dataLoading:!1,dataList:[],pagination:{totalCount:1,pageSize:10,pageNo:1},reqData:{dateRange:[],ordersNo:"",storeId:"",goodsId:"",userIds:[],warehouseIds:[],areaIds:[],state:[],settleState:[]},exportLoading:!1,exportDialog:{visible:!1,hasDetail:!1,hasCostProfit:!1}}},computed:{compStates(){return this.states.filter(e=>this.$hasModule(e.module))}},mounted(){this.fetchDataList()},methods:{fetchDataList(){this.dataLoading=!0;const e=Object.assign({},this.getReqData(),this.pagination);Object(n["a"])("orders/listOrders",e,{functionName:"xunda"}).then(e=>{this.dataList=e.data||[],1===this.pagination.pageNo&&(this.pagination.totalCount=e.totalCount),this.dataLoading=!1})},getReqData(){const e=Object.assign({},this.reqData),t=this.reqData.dateRange||[];return t.length>0&&(e.startDay=i()(t[0]).valueOf(),e.endDay=i()(t[1]).valueOf()),e},handleSearch(){this.fetchDataList()},handleTabSelect(e){const t=this.$common.getKeyValue(this.states,e,"code","value");this.reqData.state=t,this.pagination.pageNo=1,this.fetchDataList()},changePageNo(e){this.pagination.pageNo=e,this.fetchDataList()},changePageSize(e){this.pagination.pageNo=1,this.pagination.pageSize=e,this.fetchDataList()},handleExportData(){this.exportDialog.visible=!0},confirmExportData(){this.exportLoading=!0;const e=Object.assign({},this.getReqData(),{hasDetail:this.exportDialog.hasDetail,hasCostProfit:this.exportDialog.hasCostProfit});Object(n["a"])("orders/exportOrders",e,{functionName:"xunda"}).then(e=>{Object(r["a"])(e.fileUrl,e.fileName),this.exportLoading=!1,this.exportDialog.visible=!1}).catch(e=>{this.$message({type:"error",message:"导出数据失败!"}),this.exportLoading=!1,this.exportDialog.visible=!1})}}},L=q,A=(a("0aeb"),Object(p["a"])(L,s,l,!1,null,null,null));t["default"]=A.exports},a1b8:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));a("3c5d");function s(e,t,a){var l=window,o="application/octet-stream",i=a||o,n=e,r="";r=("string"===typeof n&&n.startsWith("http")||!t&&!a)&&n;var c,d,u=document.createElement("a"),h=function(e){return String(e)},p=l.Blob||l.MozBlob||l.WebKitBlob||h,m=t||"download";if(p=p.call?p.bind(l):Blob,"true"===String(this)&&(n=[n,i],i=n[0],n=n[1]),r&&r.length<2048&&(m=t||r.split("/").pop().split("?")[0],u.href=r,-1!==u.href.indexOf(r))){var f=new XMLHttpRequest;return f.open("GET",r,!0),f.responseType="blob",f.onload=function(e){s(e.target.response,m,o)},setTimeout((function(){f.send()}),0),f}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(n)){if(!(n.length>2096103.424&&p!==h))return navigator.msSaveBlob?navigator.msSaveBlob(x(n),m):_(n);n=x(n),i=n.type||o}else if(/([\x80-\xff])/.test(n)){var g=0,v=new Uint8Array(n.length),b=v.length;for(g;g<b;++g)v[g]=n.charCodeAt(g);n=new p([v],{type:i})}function x(e){var t=e.split(/[:;,]/),a=t[1],s="base64"==t[2]?atob:decodeURIComponent,l=s(t.pop()),o=l.length,i=0,n=new Uint8Array(o);for(i;i<o;++i)n[i]=l.charCodeAt(i);return new p([n],{type:a})}function _(e,t){if("download"in u)return u.href=e,u.setAttribute("download",m),u.className="download-js-link",u.innerHTML="downloading...",u.style.display="none",document.body.appendChild(u),setTimeout((function(){u.click(),document.body.removeChild(u),!0===t&&setTimeout((function(){l.URL.revokeObjectURL(u.href)}),250)}),66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(e)&&(e="data:"+e.replace(/^data:([\w\/\-\+]+)/,o)),window.open(e)||confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")&&(location.href=e),!0;var a=document.createElement("iframe");document.body.appendChild(a),!t&&/^data:/.test(e)&&(e="data:"+e.replace(/^data:([\w\/\-\+]+)/,o)),a.src=e,setTimeout((function(){document.body.removeChild(a)}),333)}if(c=n instanceof p?n:new p([n],{type:i}),navigator.msSaveBlob)return navigator.msSaveBlob(c,m);if(l.URL)_(l.URL.createObjectURL(c),!0);else{if("string"===typeof c||c.constructor===h)try{return _("data:"+i+";base64,"+l.btoa(c))}catch(w){return _("data:"+i+","+encodeURIComponent(c))}d=new FileReader,d.onload=function(e){_(this.result)},d.readAsDataURL(c)}return!0}},a68b:function(e,t,a){}}]);