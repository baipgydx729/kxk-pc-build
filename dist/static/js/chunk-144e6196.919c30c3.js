(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-144e6196"],{"02fb":function(e,t,s){},"18d4":function(e,t,s){},"2dcd":function(e,t,s){e.exports=s.p+"static/img/login-scan2.805ee967.png"},"3ad7":function(e,t,s){"use strict";s("02fb")},"7be2":function(e,t,s){},"9b3b":function(e,t,s){e.exports=s.p+"static/img/login-box-bg.959c4e38.svg"},"9ed6":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"login-container"},[a("div",{staticClass:"left-box"},[a("div",{staticClass:"logo-box animated fadeInDown"},[a("img",{staticClass:"img",attrs:{src:s("cf05")}}),a("span",{staticClass:"title"},[e._v(e._s(e.settings.title))])]),a("div",{staticClass:"desc-warp animated fadeInLeft"},[a("img",{attrs:{src:s("9b3b")}}),a("div",{staticClass:"tit padding-top-lg"},[e._v(e._s(e.settings.title)+" - 管理系统")]),a("div",{staticClass:"des padding-top-lg"},[e._v("输入您的账号密码登录后开始使用！")])])]),a("div",{staticClass:"right-box"},[a("el-form",{ref:"loginForm",staticClass:"login-form animated fadeInRight",attrs:{model:e.loginForm,rules:e.loginRules,autocomplete:"on","label-position":"left"}},[a("div",{staticClass:"title-box dflex-b"},[a("div",{class:{active:"wxqrcode"==e.loginType},on:{click:function(t){return e.changeLogin("wxqrcode")}}},[a("h4",{staticClass:"title"},[e._v("微信登录")])]),a("div",{class:{active:"userpwd"==e.loginType},on:{click:function(t){return e.changeLogin("userpwd")}}},[a("h4",{staticClass:"title"},[e._v("密码登录")])])]),"userpwd"==e.loginType?a("div",{staticClass:"login-area"},[a("el-form-item",{attrs:{prop:"username"}},[a("span",{staticClass:"svg-box"},[a("svg-icon",{attrs:{"icon-class":"user"}})],1),a("el-input",{ref:"username",attrs:{placeholder:"登录用户名",name:"username",type:"text",tabindex:"1",autocomplete:"on"},model:{value:e.loginForm.username,callback:function(t){e.$set(e.loginForm,"username",t)},expression:"loginForm.username"}})],1),a("el-form-item",{attrs:{prop:"password"}},[a("span",{staticClass:"svg-box"},[a("svg-icon",{attrs:{"icon-class":"password"}})],1),a("el-input",{key:e.passwordType,ref:"password",attrs:{type:e.passwordType,placeholder:"登录密码",name:"password",tabindex:"2",autocomplete:"on"},on:{blur:function(t){e.capsTooltip=!1}},nativeOn:{keyup:[function(t){return e.checkCapslock(t)},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleLogin(t)}]},model:{value:e.loginForm.password,callback:function(t){e.$set(e.loginForm,"password",t)},expression:"loginForm.password"}}),a("span",{staticClass:"show-pwd",on:{click:e.showPwd}},[a("svg-icon",{attrs:{"icon-class":"password"===e.passwordType?"eye":"eye-open"}})],1)],1),e.needCaptcha?a("el-form-item",{attrs:{prop:"captcha"}},[a("div",{staticClass:"captcha-box"},[a("uni-captcha",{ref:"captcha",attrs:{focus:"",scene:"login-by-pwd"}})],1),a("div",{staticClass:"captcha-input"},[a("el-input",{ref:"captcha",attrs:{type:"text",placeholder:"验证码",name:"captcha",tabindex:"3"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleLogin(t)}},model:{value:e.loginForm.captcha,callback:function(t){e.$set(e.loginForm,"captcha",t)},expression:"loginForm.captcha"}})],1)]):e._e(),a("el-button",{staticClass:"login-btn",attrs:{loading:e.loading,type:"primary"},nativeOn:{click:function(t){return t.preventDefault(),e.handleLogin(t)}}},[e._v("登录")])],1):e._e(),"wxqrcode"==e.loginType?a("div",{staticClass:"login-area"},[a("div",{staticClass:"login-box-code"},[a("div",{staticClass:"login-code-wechat"},[a("div",{staticClass:"qrcode-box"},[e.qrcodeLogin.qrScanState>=0&&e.qrcodeLogin.qrcodeUrl?a("img",{staticClass:"qrcode",attrs:{src:e.qrcodeLogin.qrcodeUrl}}):e._e(),-1===e.qrcodeLogin.qrScanState?a("div",{staticClass:"qrcode-error",on:{click:e.buildWxAppLoginQrCode}},[a("div",{staticClass:"icon el-icon-refresh"}),a("div",[e._v("二维码失效 点击重试")])]):e._e()]),a("div",{staticClass:"scan-box"},[a("img",{attrs:{src:s("2dcd")}})]),a("div",{staticClass:"wechat-title"},[e.qrcodeLogin.qrScanState?e._e():a("span",[e._v("打开微信扫一扫，快速登录/注册")]),1==e.qrcodeLogin.qrScanState?a("span",{staticClass:"ft-primary"},[e._v("已扫描二维码，请点击授权登录")]):e._e(),9==e.qrcodeLogin.qrScanState?a("span",{staticClass:"ft-success"},[e._v("扫码登录成功, 请稍候～")]):e._e(),e.qrcodeLogin.qrScanMessage?a("span",{staticClass:"ft-danger"},[e._v(e._s(e.qrcodeLogin.qrScanMessage))]):e._e()])])])]):e._e()])],1),a("el-dialog",{attrs:{title:"Or connect with",visible:e.showDialog},on:{"update:visible":function(t){e.showDialog=t}}},[a("social-sign")],1)],1)},i=[],n=(s("13d5"),s("61f7")),c=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"social-signup-container"},[s("div",{staticClass:"sign-btn",on:{click:function(t){return e.wechatHandleClick("wechat")}}},[s("span",{staticClass:"wx-svg-container"},[s("svg-icon",{staticClass:"icon",attrs:{"icon-class":"wechat"}})],1),e._v(" WeChat ")]),s("div",{staticClass:"sign-btn",on:{click:function(t){return e.tencentHandleClick("tencent")}}},[s("span",{staticClass:"qq-svg-container"},[s("svg-icon",{staticClass:"icon",attrs:{"icon-class":"qq"}})],1),e._v(" QQ ")])])},o=[],r={name:"SocialSignin",methods:{wechatHandleClick(e){alert("ok")},tencentHandleClick(e){alert("ok")}}},l=r,d=(s("f103"),s("2877")),p=Object(d["a"])(l,c,o,!1,null,"674d2e4a",null),g=p.exports,u=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"captcha-img-box"},[e.loging?s("div",{staticClass:"tac padding-tb-lg"},[s("span",{directives:[{name:"loading",rawName:"v-loading",value:e.loging,expression:"loging"}],attrs:{"element-loading-spinner":"el-icon-loading"}})]):s("img",{staticClass:"captcha-img",class:{opacity:e.loging},attrs:{src:e.captchaBase64,mode:"widthFix"},on:{click:e.getImageCaptcha}})])},h=[],m=s("5c96"),f={name:"UniCaptcha",props:{modelValue:{type:String,default(){return""}},value:{type:String,default(){return""}},scene:{type:String,default(){return""}},focus:{type:Boolean,default(){return!1}}},data(){return{focusCaptchaInput:!1,captchaBase64:"",loging:!1}},computed:{val:{get(){return this.value||this.modelValue},set(e){this.$emit("input",e)}}},watch:{scene:{handler(e){e?this.getImageCaptcha(this.focus):m["Message"].error("scene不能为空")},immediate:!0}},methods:{getImageCaptcha(e=!0){this.loging=!0,e&&(this.val="",this.focusCaptchaInput=!0);const t=uniCloud.importObject("uni-captcha-co",{customUI:!0});t.getImageCaptcha({scene:this.scene}).then(e=>{this.captchaBase64=e.captchaBase64}).catch(e=>{m["Message"].error(e.message)}).finally(e=>{this.loging=!1})}}},v=f,C=(s("e0f3"),Object(d["a"])(v,u,h,!1,null,"11cf089a",null)),w=C.exports,q=s("83d6"),b=s.n(q),y=s("2197"),x={name:"Login",components:{SocialSign:g,UniCaptcha:w},data(){const e=(e,t,s)=>{Object(n["d"])(t)?s():s(new Error("请输入正确的用户名！"))},t=(e,t,s)=>{t.length<6?s(new Error("请输入正确的用户密码！")):s()};return{settings:b.a,loginType:"wxqrcode",loginForm:{username:"",password:"",captcha:""},needCaptcha:!1,loginRules:{username:[{required:!0,trigger:"blur",validator:e}],password:[{required:!0,trigger:"blur",validator:t}]},passwordType:"password",capsTooltip:!1,loading:!1,showDialog:!1,redirect:void 0,otherQuery:{},qrcodeLogin:{qrcodeUrl:"",qrSceneId:"",qrScanState:"",qrScanMessage:""}}},watch:{$route:{handler(e){const t=e.query;t&&(this.redirect=t.redirect,this.otherQuery=this.getOtherQuery(t))},immediate:!0}},created(){},mounted(){this.buildWxAppLoginQrCode()},destroyed(){},methods:{changeLogin(e){this.loginType=e,this.initLogin(),e&&this.buildWxAppLoginQrCode()},initLogin(){clearTimeout(this.qrcodeScanTimer)},buildWxAppLoginQrCode(){this.qrcodeLogin={qrcodeUrl:"",qrSceneId:"",qrScanState:"",qrScanMessage:""},Object(y["a"])("login/createWxAppLoginQrCode",{},{functionName:"xundapc"}).then(e=>{const{qrcode:t,sceneId:s}=e.data;this.qrcodeLogin.qrcodeUrl=t,this.qrcodeLogin.qrSceneId=s,this.checkQrCodeScan()})},checkQrCodeScan(){"wxqrcode"===this.loginType&&Object(y["a"])("login/checkScanWxAppQrCode",{scene:"pclogin",sceneId:this.qrcodeLogin.qrSceneId},{functionName:"xundapc"}).then(e=>{const{state:t,message:s,token:a}=e.data;this.qrcodeLogin.qrScanState=t,this.qrcodeLogin.qrScanMessage=s||"",clearTimeout(this.qrcodeScanTimer),[-1,9].includes(t)||(this.qrcodeScanTimer=setTimeout(()=>this.checkQrCodeScan(),1e3)),a&&this.$store.dispatch("user/loginByToken",a).then(()=>{this.$router.push({path:this.redirect||"/",query:this.otherQuery}),this.loading=!1})})},checkCapslock(e){const{key:t}=e;this.capsTooltip=t&&1===t.length&&t>="A"&&t<="Z"},showPwd(){"password"===this.passwordType?this.passwordType="":this.passwordType="password",this.$nextTick(()=>{this.$refs.password.focus()})},handleLogin(){this.$refs.loginForm.validate(e=>{if(!e)return console.log("error submit!!"),!1;this.loading=!0,this.$store.dispatch("user/login",this.loginForm).then(()=>{this.$router.push({path:this.redirect||"/",query:this.otherQuery}),this.loading=!1}).catch(e=>{"uni-id-captcha-required"===e.code&&(this.needCaptcha=!0),this.loading=!1}).finally(()=>{this.loginForm.captcha=""})})},getOtherQuery(e){return Object.keys(e).reduce((t,s)=>("redirect"!==s&&(t[s]=e[s]),t),{})}}},k=x,S=(s("3ad7"),Object(d["a"])(k,a,i,!1,null,null,null));t["default"]=S.exports},e0f3:function(e,t,s){"use strict";s("18d4")},f103:function(e,t,s){"use strict";s("7be2")}}]);