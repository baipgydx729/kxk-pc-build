(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d23717f"],{fa3a:function(e,o,t){"use strict";t.r(o);var r=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",{staticClass:"app-container"},[t("div",{staticClass:"aux-card"},[t("div",{staticClass:"header"},[t("div",{staticClass:"left title"},[e._v("销售开单")]),t("div",{staticClass:"right"},[t("el-button",{attrs:{type:"default",icon:"el-icon-tickets"},on:{click:function(o){return e.$common.closePage()}}},[e._v("取消")]),t("el-button",{attrs:{loading:e.submitLoading,type:"primary",icon:"el-icon-document-checked"},on:{click:e.handleSave}},[e._v("保存 (Ctrl+S)")])],1)]),t("div",{staticClass:"margin-top-sm"},[t("el-form",{ref:"baseForm",attrs:{"label-width":"90px","label-align":"left",inline:!0}},[t("div",{staticClass:"dflex-s"},[t("el-form-item",{attrs:{label:"选择客户"}},[t("AuxStoreSelect",{staticStyle:{width:"300px"},on:{change:e.changeStoreSelect},model:{value:e.baseForm.receiver_id,callback:function(o){e.$set(e.baseForm,"receiver_id",o)},expression:"baseForm.receiver_id"}})],1),t("el-form-item",{attrs:{label:"开单日期"}},[t("el-date-picker",{staticStyle:{width:"300px"},attrs:{type:"datetime","value-format":"timestamp"},model:{value:e.baseForm.orders_date,callback:function(o){e.$set(e.baseForm,"orders_date",o)},expression:"baseForm.orders_date"}})],1),t("el-form-item",{attrs:{label:"业务员"}},[t("AuxMemberSelect",{model:{value:e.baseForm.sale_manid,callback:function(o){e.$set(e.baseForm,"sale_manid",o)},expression:"baseForm.sale_manid"}})],1)],1)])],1),t("OrdersGoodsTable",{ref:"goodsTable",on:{change:e.changeOrdersGoodsCompleted}})],1),t("el-card",{staticClass:"aux-card margin-top",attrs:{shadow:"none","body-style":{padding:"12px"}}},[t("el-form",{ref:"baseForm",attrs:{"label-width":"80px","label-align":"left",inline:!0}},[t("el-form-item",{attrs:{label:"整单优惠"}},[t("el-input",{attrs:{oninput:"value=value.match(/^\\d+(?:\\.\\d{0,2})?/)",placeholder:"整单优惠"},on:{blur:e.changeOrdersDiscountMoney},model:{value:e.baseForm.orders_discount_money,callback:function(o){e.$set(e.baseForm,"orders_discount_money",o)},expression:"baseForm.orders_discount_money"}},[t("template",{slot:"append"},[e._v("元")])],2)],1),t("el-form-item",{attrs:{label:"其他费用"}},[t("el-input",{attrs:{oninput:"value=value.match(/^\\d+(?:\\.\\d{0,2})?/)",placeholder:"其他费用"},on:{change:e.changeOrdersCompleted},model:{value:e.baseForm.orders_extend_fee,callback:function(o){e.$set(e.baseForm,"orders_extend_fee",o)},expression:"baseForm.orders_extend_fee"}},[t("template",{slot:"append"},[e._v("元")])],2)],1),t("el-form-item",{attrs:{label:"订单金额"}},[t("el-input",{attrs:{disabled:"",placeholder:"金额"},model:{value:e.baseForm.orders_total_money,callback:function(o){e.$set(e.baseForm,"orders_total_money",o)},expression:"baseForm.orders_total_money"}},[t("template",{slot:"append"},[e._v("元")])],2)],1)],1),t("div",{staticClass:"dflex-e padding-tb border-top"},[t("span",{staticClass:"padding-left"},[e._v("整单优惠："+e._s(e.baseForm.orders_discount_money))]),t("span",{staticClass:"padding-left"},[e._v("其他费用："+e._s(e.baseForm.orders_extend_fee))]),t("span",{staticClass:"padding-left"},[e._v(" 订单总金额： "),t("span",{staticClass:"fs-lg"},[e._v(e._s(e.baseForm.orders_total_money))])])])],1),t("el-card",{staticClass:"aux-card margin-top",attrs:{shadow:"none","body-style":{padding:"12px"}}},[t("div",{attrs:{slot:"header"},slot:"header"},[t("span",[e._v("订单备注")])]),t("el-input",{attrs:{type:"textarea",placeholder:"请输入内容",maxlength:"600","show-word-limit":""},model:{value:e.baseForm.orders_remark,callback:function(o){e.$set(e.baseForm,"orders_remark",o)},expression:"baseForm.orders_remark"}})],1),t("el-card",{staticClass:"aux-card margin-top",attrs:{shadow:"none","body-style":{padding:"12px"}}},[t("div",{attrs:{slot:"header"},slot:"header"},[t("span",[e._v("内部备注")])]),t("el-input",{attrs:{type:"textarea",placeholder:"请输入内容",maxlength:"600","show-word-limit":""},model:{value:e.baseForm.create_remark,callback:function(o){e.$set(e.baseForm,"create_remark",o)},expression:"baseForm.create_remark"}})],1)],1)},s=[],a=t("c7eb"),n=t("1da1"),d=(t("4de4"),t("d3b7"),t("d81d"),t("b0c0"),t("b680"),t("a9e3"),t("b7ac")),i=t("2051"),m=t("b866"),c=t("2197"),l={name:"SalesOrdersCreate",components:{OrdersGoodsTable:d["a"],AuxStoreSelect:i["a"],AuxMemberSelect:m["a"]},data:function(){return{permission:"sales-orders-create",ordersId:"",prepareId:"",baseForm:{orders_date:(new Date).getTime(),orders_no:"",receiver_id:"",receiver:{_id:"",name:"",contact:"",telephone:"",sale_grade:0},orders_goods:[],sale_manid:"",orders_remark:"",create_remark:"",create_uname:"",goods_total_count:0,goods_original_money:0,goods_discount_money:0,goods_total_money:0,orders_discount_money:0,orders_extend_fee:0,orders_total_money:0,ordersIdentifys:[]},submitLoading:!1}},computed:{},mounted:function(){var e=this.$route.query||{},o=e.type,t=e.id,r=e.storeId;"edit"===o&&t&&(this.ordersId=t,this.fetchDetail(t)),"copyAdd"===o&&(this.ordersId="",this.fetchDetail(t)),"fromPrepare"===o&&(this.prepareId=t,this.fetchPrepareOrders(t)),r&&(this.baseForm.receiver_id=r)},onUnload:function(){this.setOrdersIdentifys([])},methods:{fetchDetail:function(e){var o=this;Object(c["a"])("orders/getOrders",{ordersId:e||this.ordersId},{functionName:"xunda"}).then((function(e){o.initOrdersData(e.data)}))},fetchPrepareOrders:function(e){var o=this;Object(c["a"])("prepare/getOrders",{ordersId:e},{functionName:"xunda"}).then((function(e){var t=e.data,r=t.orders_goods.map((function(e){return e.sales_goods_cnt&&(e.goods_cnt=Math.max(0,e.goods_cnt-e.sales_goods_cnt)),e})).filter((function(e){return e.goods_cnt>0}));t.orders_goods=r,o.initOrdersData(t)}))},initOrdersData:function(e){var o=this,t={};t.receiver_id=e.receiver_id||e.store_id,t.receiver=e.receiver||e.store,t.orders_date=e.orders_date,t.orders_no=e.orders_no,t.orders_remark=e.orders_remark,t.create_remark=e.create_remark,t.create_uname=e.create_uname,t.sale_manid=e.sale_manid||"",t.prepare_id=e.prepare_id,t.orders_total_money=this.$common.cent2yuan(e.orders_total_money),t.orders_extend_fee=this.$common.cent2yuan(e.orders_extend_fee||0),t.orders_discount_money=this.$common.cent2yuan(e.orders_discount_money||0),t.goods_total_count=e.goods_total_count||e.orders_goods_count,t.goods_original_money=e.goods_original_money>0?this.$common.cent2yuan(e.goods_original_money):t.ordersTotalMoney,t.goods_discount_money=e.goods_discount_money>0?this.$common.cent2yuan(e.goods_discount_money):0,t.goods_total_money=e.goods_total_money>0?this.$common.cent2yuan(e.goods_total_money):t.goodsOriginalMoney,t.orders_goods=e.orders_goods.map((function(e){var t=Object.assign({},e);return t.goods_ori_price=o.$common.cent2yuan(e.goods_ori_price||t.goods_price),t.total_ori_money=o.$common.cent2yuan(e.total_ori_money||t.total_money),t.total_money=o.$common.cent2yuan(e.total_money),t.goods_price=o.$common.cent2yuan(e.goods_price),t})),this.$refs.goodsTable.initData(t.orders_goods),this.setOrdersIdentifys(t.orders_identifys),this.baseForm=t},changeStoreSelect:function(e){this.baseForm.receiver_id=e._id,this.baseForm.receiver={_id:e._id,name:e.name,contact:e.contact,telephone:e.telephone,address:e.address,sale_grade:e.sale_grade}},changeOrdersDiscountMoney:function(){this.baseForm.orders_discount_money=Math.min(this.baseForm.orders_discount_money,this.baseForm.goods_total_money),this.changeOrdersGoodsCompleted()},changeOrdersGoodsCompleted:function(){var e=this.$refs.goodsTable.getSummaryData(),o=e.goodsTotalCount,t=void 0===o?0:o,r=e.goodsOriginalMoney,s=void 0===r?0:r,a=e.goodsDiscountMoney,n=void 0===a?0:a,d=e.goodsTotalMoney,i=void 0===d?0:d;this.baseForm.goods_total_count=t,this.baseForm.goods_original_money=s,this.baseForm.goods_discount_money=n,this.baseForm.goods_total_money=i,this.changeOrdersCompleted()},changeOrdersCompleted:function(){this.baseForm.orders_discount_money=(Number(this.baseForm.orders_discount_money)||0).toFixed(2),this.baseForm.orders_extend_fee=(Number(this.baseForm.orders_extend_fee)||0).toFixed(2),this.baseForm.orders_total_money=(Number(this.baseForm.goods_total_money)+Number(this.baseForm.orders_extend_fee)-Number(this.baseForm.orders_discount_money)).toFixed(2)},validateForm:function(){if(this.baseForm.receiver_id){var e=this.$refs.goodsTable.getListData();if(0!==e.length)return!0;this.$message.error("商品清单为空")}else this.$message.error("请选择客户")},handleSave:function(){this.validateForm()&&this.submitForm(!0)},submitForm:function(){var e=arguments,o=this;return Object(n["a"])(Object(a["a"])().mark((function t(){var r,s;return Object(a["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:r=!(e.length>0&&void 0!==e[0])||e[0],o.submitLoading=!0,s={ordersId:o.ordersId,data:o.getOrdersData(),sureOk:r},Object(c["a"])("orders/saveOrders",s,{functionName:"xunda"}).then((function(e){o.submitLoading=!1,o.$message.success("保存成功"),o.clearOrdersIdentify(),setTimeout((function(){return o.$router.push({name:"SalesOrdersDetail",params:{ordersId:e.data,t:Date.now()}})}),300),o.$common.closePage()}),(function(e){o.submitLoading=!1}));case 4:case"end":return t.stop()}}),t)})))()},getOrdersData:function(){var e=Object.assign({},this.baseForm,{orders_type:1,orders_date:this.baseForm.orders_date,receiver_id:this.baseForm.receiver_id,receiver:this.baseForm.receiver,orders_remark:this.baseForm.orders_remark,create_remark:this.baseForm.create_remark,orders_identifys:this.baseForm.ordersIdentifys,orders_goods:this.getOrdersGoods(),goods_total_count:this.baseForm.goods_total_count,goods_original_money:this.$common.yuan2cent(this.baseForm.goods_original_money),goods_discount_money:this.$common.yuan2cent(this.baseForm.goods_discount_money),goods_total_money:this.$common.yuan2cent(this.baseForm.goods_total_money),orders_discount_money:this.$common.yuan2cent(this.baseForm.orders_discount_money),orders_extend_fee:this.$common.yuan2cent(this.baseForm.orders_extend_fee),orders_total_money:this.$common.yuan2cent(this.baseForm.orders_total_money)});return this.ordersId||(e.orders_no="XSD"+this.$common.format(new Date,"yyyyMMddhhmmssS")),this.prepareId&&(e.prepare_id=this.prepareId),e},getOrdersGoods:function(){var e=this,o=this.$refs.goodsTable.getListData();return o.map((function(o){var t=Object.assign({},o,{goods_ori_price:e.$common.yuan2cent(o.goods_ori_price),goods_price:e.$common.yuan2cent(o.goods_price),total_money:e.$common.yuan2cent(o.total_money),total_ori_money:e.$common.yuan2cent(o.total_ori_money)});return t}))},handleAddIdentify:function(){},setOrdersIdentifys:function(e){this.ordersIdentifys=e||[]},clearOrdersIdentify:function(){}}},_=l,u=t("2877"),h=Object(u["a"])(_,r,s,!1,null,null,null);o["default"]=h.exports}}]);