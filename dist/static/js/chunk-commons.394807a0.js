(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-commons"],{"15f6":function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("el-popover",{attrs:{placement:"bottom-start",width:"800",trigger:"click","popper-class":"popper-select"},model:{value:t.popoverVisible,callback:function(e){t.popoverVisible=e},expression:"popoverVisible"}},[s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.dataLoading,expression:"dataLoading"}],staticClass:"aux-table",attrs:{data:t.dataList,border:"",fit:"",stripe:"","max-height":"250"},on:{"row-click":t.onRowClick}},[s("el-table-column",{attrs:{align:"left",label:"商品名称","min-width":"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.name))]}}])}),s("el-table-column",{attrs:{align:"left","min-width":"180",label:"商品条码",prop:"spec"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.code))]}}])}),s("el-table-column",{attrs:{align:"left","min-width":"180",label:"规格/属性",prop:"spec"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.spec_list&&e.row.spec_list.length>0?s("div",{},t._l(e.row.spec_list,(function(e,a){return s("span",{key:a,staticClass:"padding-right-sm"},[t._v(t._s(e.name)+"："+t._s(e.values.join("/")))])})),0):s("div",[t._v(t._s(e.row.spec))])]}}])}),s("el-table-column",{attrs:{width:"100",align:"center",label:"单位",prop:"unit"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.unit_desc?s("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.row.unit_desc,placement:"top"}},[s("span",[t._v(" "+t._s(e.row.unit)+" "),s("i",{staticClass:"el-icon-warning-outline"})])]):s("span",[t._v(t._s(e.row.unit))])]}}])}),"bid_price"==t.mainPrice?s("el-table-column",{attrs:{width:"110",align:"right",label:"进货价"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("cent2yuan")(e.row.bid_price)))]}}],null,!1,2056989652)}):t._e(),s("el-table-column",{attrs:{width:"110",align:"right",label:"批发价"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("cent2yuan")(e.row.price)))]}}])}),s("el-table-column",{attrs:{width:"110",align:"right",label:"零售价"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("cent2yuan")(e.row.market_price)))]}}])})],1),s("div",{attrs:{slot:"reference"},slot:"reference"},[s("el-input",{staticClass:"w-full",attrs:{placeholder:"输入商品名称/条码查询",clearable:"",loading:t.dataLoading},on:{input:t.changeInput,focus:t.initLoad},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.submit(e)}},model:{value:t.modelValue,callback:function(e){t.modelValue=e},expression:"modelValue"}},[s("template",{slot:"append"},[t.modelValue?s("el-button",{attrs:{type:"primary"},on:{click:t.submit}},[t._v("确定")]):t._e()],1)],2)],1)],1),s("AuxGoodsSkuDialog",{ref:"auxGoodsSkuDialog",attrs:{"enable-ok":"","main-price":t.mainPrice}})],1)},i=[],o=s("2197"),n=s("c031"),l=s("1ea0"),r={name:"AuxGoodsSelecter",components:{AuxGoodsSkuDialog:l["a"]},props:{value:{type:[String,Array],default:()=>""},mainPrice:{type:String,default:"price"}},data(){return{popoverVisible:!1,dataLoading:!1,dataList:[].concat(Object(n["d"])()),modelValue:""}},methods:{initLoad(){this.dataList.length>0||this.querySearch()},changeInput(t){this.inputTimer&&clearTimeout(this.inputTimer),this.inputTimer=setTimeout(()=>{this.querySearch(t)},300)},querySearch(t=""){this.dataLoading=!0,Object(o["a"])("goods/list",{pageSize:10,simple:!0,keyword:t},{functionName:"xunda"}).then(t=>{this.dataLoading=!1;const e=t.data||[];this.dataList=e,Object(n["f"])(e)})},onRowClick(t,e){this.modelValue=t.goods_id,this.popoverVisible=!1;const s=Object(n["b"])(this.modelValue);s.spec_list&&s.spec_list.length>0?this.$refs.auxGoodsSkuDialog.open({goods:s,confirm:t=>{const e=t.map(t=>{const e=Object.assign({},t);return e._id=s._id,e.name=s.name,e.img=s.img,e.sku_id=t.sku_id,e.unit=t.unit,e.spec=t.spec,e.price=t.price,e.bid_price=t.bid_price,e.market_price=t.market_price,e.min_price=t.min_price,e.scale=t.scale,e});this.$nextTick(()=>{this.$emit("input",this.modelValue),this.$emit("change",{goodsId:this.modelValue,goods:e[0],others:e.splice(1)})})},cancel:()=>{this.$nextTick(()=>{this.modelValue="",this.$emit("input",this.modelValue)})}}):this.$nextTick(()=>{this.$emit("input",this.modelValue),this.$emit("change",{goodsId:this.modelValue,goods:s})})},submit(){this.$emit("submit",this.modelValue)}}},c=r,d=(s("f455"),s("2877")),u=Object(d["a"])(c,a,i,!1,null,null,null);e["a"]=u.exports},"1ea0":function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("el-dialog",{attrs:{title:"选择单品",visible:t.dialogVisible,top:"10vh",width:"500","before-close":t.close,"append-to-body":"","custom-class":"goods-sku-dialog"},on:{"update:visible":function(e){t.dialogVisible=e}}},[s("div",{staticClass:"goods-sku-area dflex-s",style:t.styles},[s("div",{staticClass:"goods-img-box"},[s("img",{attrs:{src:t.goods.img||"/static/img/img-empty.png",alt:""}})]),s("div",{staticClass:"goods-sku-content flex1"},[s("div",{staticClass:"title"},[t._v(t._s(t.goods.name))]),(t.goods.unit_list||[]).length>1?s("div",{staticClass:"border-top"},[s("div",{staticClass:"block-title"},[t._v("单位")]),s("div",{staticClass:"block-box"},t._l(t.goods.unit_list,(function(e,a){return s("div",{key:a},[s("div",{staticClass:"item",class:{active:t.form.unit==e.unit},on:{click:function(s){return t.selectGoodsUnit(e,a)}}},[t._v(" "+t._s(e.unit+(e.unit_desc||""))+" ")])])})),0)]):t._e(),s("div",{staticClass:"border-top"}),t._l(t.goods.spec_list,(function(e,a){return s("div",{key:e.name},[s("div",{staticClass:"block-title"},[t._v(t._s(e.name))]),s("div",{staticClass:"block-box"},t._l(e.values,(function(i,o){return s("div",{key:i},[s("div",{staticClass:"item",class:{active:t.isActiveSpec(e,a,i,o),disabled:t.isDisabledSpec(e,a,i,o)},on:{click:function(s){return t.selectGoodsSpec(e,a,i,o)}}},[t._v(" "+t._s(i)+" ")])])})),0)])})),s("div",{staticClass:"select-box"},[(t.goods.unit_list||[]).length>1?s("div",[s("span",{staticClass:"lable"},[t._v("已选单位：")]),s("span",{staticClass:"values"},[t._v(t._s(t.form.unit))])]):t._e(),(t.goods.spec_list||[]).length>0?s("div",[s("span",{staticClass:"lable"},[t._v("已选规格：")]),t.form.skus.length>0?s("span",{staticClass:"values"},[t._v(t._s(t.form.skus.join(" / ")))]):t._e()]):t._e()]),s("div",{staticClass:"bottom-box dflex-b"},[s("div",{staticClass:"price-box"},[t._v("¥"+t._s(t.compPricespan))]),t.enableOk?s("div",{staticClass:"btn-box"},[t.isSelectedOk||t.selectedGoods.length>0?[0==t.selectedGoods.length?s("el-button",{attrs:{type:"default",size:"default",icon:"el-icon-plus"},on:{click:t.handleJoin}},[t._v("加入")]):t._e(),t.selectedGoods.length>0?s("el-button-group",{staticClass:"margin-right"},[s("el-button",{attrs:{type:"default",size:"default",icon:"el-icon-plus"},on:{click:t.handleJoin}},[t._v(" 加入 "),s("span",{staticClass:"badge"},[t._v(t._s(t.selectedGoods.length))])]),s("el-button",{attrs:{type:"default",size:"default",icon:"el-icon-minus"},on:{click:t.handleMinus}})],1):t._e()]:t._e(),s("el-button",{attrs:{type:"default",size:"default"},on:{click:t.handleCancel}},[t._v("取消")]),s("el-button",{attrs:{type:"primary",size:"default"},on:{click:t.handleSubmit}},[t._v("确认选择")])],2):t._e()])],2)])])},i=[],o={name:"AuxGoodsSkuDialog",props:{enableBuy:{type:Boolean,default:!1},enableOk:{type:Boolean,default:!1},mainPrice:{type:String,default:"price"},marginTop:{type:Number,default:0},styles:{type:Object,default:()=>({})}},data(){return{dialogVisible:!1,goods:{unit:"",unit_list:[],spec:"",spec_list:"",sku_data:[]},isSelectedOk:!1,selectedGoods:[],form:this.initForm(),confirm:()=>{}}},computed:{compPricespan(){const t=this.form[this.mainPrice];return this.$common.cent2yuan(t)}},methods:{initForm(){return{sku_id:"",unit:"",unit_desc:"",skus:[],spec:"",price:0,bid_price:0,market_price:0,min_price:0,scale:1,number:0}},open(t){const{goods:e,confirm:s,cancel:a,initOpts:i={}}=t;(e.unit_prices||[]).length>0&&0===(e.spec_list||[]).length&&0===(e.unit_list||[]).length&&(e.unit_list=e.unit_prices.map(t=>({nit:t.unit,scale:t.scale||1}))),0===(e.sku_datas||[]).length&&(e.unit_prices||[]).length>0&&(e.sku_datas=e.unit_prices),this.goods=e,this.form=Object.assign(this.initForm(),{unit:i.unit||e.unit,skus:i.skus||[]}),this.confirm=s,this.cancel=a,this.selectedGoods=[],this.isSelectedOk=!1,this.dialogVisible=!0,this.changeComplated()},close(){this.dialogVisible=!1},selectGoodsUnit(t,e){this.form.unit=t.unit,this.form.unit_desc=t.unit_desc,this.form.scale=Number(t.scale||1),this.changeComplated()},selectGoodsSpec(t,e,s,a){this.form.skus.length=(this.goods.spec_list||[]).length;const i=this.form.skus[e];this.$set(this.form.skus,e,i!=s?s:""),this.clearSelectData(),this.changeComplated()},isActiveSpec(t,e,s,a){return this.form.skus[e]==s},isDisabledSpec(t,e,s,a){const i=this.form.skus||[],o=(i.join("/"),this.goods.sku_datas||[]),n=[...i];n[e]=s;const l=n.join("/"),r=[...i];r[e]="";const c=i.some(t=>!t),d=o.some(t=>{const a=t.skus[e]==s;if(!a)return!1;if(!i.join(""))return!0;if(!r.join(""))return!0;if(i[e]&&c)return!0;if(!i[e]&&c){const a=[...i];a[e]=s;for(let e=0;e<n.length;e++)a[e]||(a[e]=t.skus[e]);const o=a.join("/");return t.name.includes(o)}return t.name.includes(l)});return!d},changeComplated(){const t=this.goods,e=t.unit,s=t.unit_list||[],a=t.spec_list||[],i=t.sku_datas||[],o=s.length>1,n=a.length>0,{unit:l,skus:r=[]}=this.form;if(this.form.spec=r.join("/"),o||n||this.updateFormData(t),!o&&n&&r.length>0){const t=r.join("/"),e=i.filter(e=>e.name==t);if(e.length>0){if(1!=e.length)throw"2.发现异常，当前规格的单品存在多个金额，规格："+t;this.updateFormData(e[0])}}if(o&&!n)if(l==e)this.updateFormData(t);else{const e=i.filter(t=>t.unit==l);if(0==e.length){const e=s.filter(t=>t.unit==l),a=e[0].scale||1;this.updateFormData(t,a)}1==e.length&&this.updateFormData(e[0])}if(o&&n&&r.length>0){const t=r.join("/"),a=i.filter(e=>e.name==t),o=a.filter(t=>t.unit==l);if(o.length>0){if(1!=o.length)throw`4.1发现异常，当前规格的单品存在多个金额，单位：${l}, 规格：${t}`;this.updateFormData(o[0])}else if(a.length>0){const i=a.filter(t=>t.unit==e);if(1!=i.length)throw`4.2发现异常，当前规格的单品存在多个金额，单位：${l}, 规格：${t}`;const o=s.filter(t=>t.unit==l),n=o[0].scale||1;this.updateFormData(i[0],n)}}},clearSelectData(){const{unit:t,skus:e}=this.form;this.form=Object.assign(this.initForm(),{unit:t,skus:e}),this.isSelectedOk=!1},updateFormData(t,e=1){const s=["price","market_price","bid_price","min_price"];s.forEach(s=>{this.$set(this.form,s,(t[s]||0)*e)}),this.form.sku_id=t.sku_id||"",this.form.spec=t.name,this.isSelectedOk=!0},handleSubmit(){try{this.confirm&&(this.selectedGoods.length>0?this.confirm([...this.selectedGoods]):this.validateForm(()=>{this.confirm([this.form])})),this.close()}catch(t){this.$message.error(t.message||t)}},handleJoin(){try{this.validateForm(()=>{const t=Object.assign({},this.form);this.selectedGoods.push(t)})}catch(t){this.$message.error(t.message||t)}},handleJoinAll(){},handleMinus(){this.selectedGoods.length>0&&this.selectedGoods.pop()},validateForm(t){const{unit:e,skus:s}=this.form;if(!this.isSelectedOk){if(0==s.length||s.indexOf("")>-1)throw new Error("请选择单位及规格");return this.$confirm("该单品缺失，确定要选择？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{t()}),!1}t()},handleCancel(){this.dialogVisible=!1,this.cancel&&this.cancel()}}},n=o,l=(s("21c0"),s("2877")),r=Object(l["a"])(n,a,i,!1,null,null,null);e["a"]=r.exports},2051:function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("el-select",{staticClass:"w-full",attrs:{filterable:"",placeholder:"输入客户名称/联系人/电话查询",loading:t.loading,clearable:!0,remote:"","remote-method":t.remoteMethod},on:{change:t.change,focus:t.initLoad},model:{value:t.modelValue,callback:function(e){t.modelValue=e},expression:"modelValue"}},t._l(t.dataList,(function(t){return s("el-option",{key:t._id,attrs:{label:t.name,value:t._id}})})),1)],1)},i=[],o=s("2197");const n=[];function l(t){const e=n.map(t=>t._id);t.filter(t=>!e.includes(t._id)).forEach(t=>n.push(t))}var r={name:"AuxSelectStore",props:{value:{type:[String,Array],default:()=>""},multi:Boolean},data(){return{loading:!1,dataList:[].concat(n),modelValue:""}},watch:{value:{handler(t,e){this.modelValue=t,0===this.dataList.length&&t&&this.loadStore(t)},immediate:!0}},methods:{initLoad(){this.dataList.length>0||this.fetchData()},fetchData(t=""){this.loading=!0,Object(o["a"])("store/listStore",{pageSize:12,simple:!0,keyword:t},{functionName:"xunda"}).then(t=>{this.loading=!1;const e=t.data||[];l(e),this.dataList=e})},loadStore(t){Object(o["a"])("store/getStore",{storeId:t},{functionName:"xunda"}).then(t=>{this.dataList=[t.data]})},remoteMethod(t){t&&""!==t?this.$common.debounce(()=>this.fetchData(t),200)():this.dataList=[]},change(){this.$nextTick(()=>{if(this.$emit("input",this.modelValue),!this.multi){const t=this.dataList.filter(t=>t._id==this.modelValue);t.length>0&&this.$emit("change",t[0])}})}}},c=r,d=s("2877"),u=Object(d["a"])(c,a,i,!1,null,null,null);e["a"]=u.exports},"21c0":function(t,e,s){"use strict";s("4342")},3796:function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"excel-upload"},[s("input",{ref:"upload-input",staticClass:"upload-input",attrs:{type:"file",accept:".xlsx, .xls"},on:{change:t.handleClick}}),s("div",{staticClass:"drop-box",on:{drop:t.handleDrop,dragover:t.handleDragover,dragenter:t.handleDragover,click:t.handleUpload}},[s("div",{staticClass:"icon el-icon-upload"}),s("div",{staticClass:"txt fs"},[t._v("点击或将文件拖拽到这里上传")]),s("div",{staticClass:"tip fs-xs"},[t._v("仅支持xlsx/xls/csv文件，且不超过1M")])])])},i=[],o=s("25ca"),n={props:{skinRow:{type:Number,default:1},beforeUpload:Function,onSuccess:Function,onError:Function},data(){return{loading:!1,excelData:{header:null,results:null}}},methods:{generateData({header:t,results:e}){this.excelData.header=t,this.excelData.results=e,this.onSuccess&&this.onSuccess(this.excelData)},handleDrop(t){if(t.stopPropagation(),t.preventDefault(),this.loading)return;const e=t.dataTransfer.files;if(1!==e.length)return void this.$message.error("只支持上传一个文件！");const s=e[0];if(!this.isExcel(s))return this.$message.error("仅支持 .xlsx, .xls, .csv文件类型"),!1;this.upload(s),t.stopPropagation(),t.preventDefault()},handleDragover(t){t.stopPropagation(),t.preventDefault(),t.dataTransfer.dropEffect="copy"},handleUpload(){this.$refs["upload-input"].click()},handleClick(t){const e=t.target.files,s=e[0];s&&this.upload(s)},upload(t){if(this.$refs["upload-input"].value=null,!this.beforeUpload)return void this.readerData(t);const e=this.beforeUpload(t);e&&this.readerData(t)},readerData(t){const e=this;return this.loading=!0,new Promise((s,a)=>{const i=new FileReader;i.onload=t=>{try{const a=t.target.result;console.log(o);const i=o["read"](a,{type:"array"}),n=i.SheetNames[0],l=i.Sheets[n],r=this.getHeaderRow(l),c={range:e.skinRow,defval:""},d=o["utils"].sheet_to_json(l,c);this.generateData({header:r,results:d}),this.loading=!1,s()}catch(i){a(i),this.onError&&this.onError(i),this.$message.error("Excel文件解析失败"),this.loading=!1}},i.readAsArrayBuffer(t)})},getHeaderRow(t){const e=[],s=o["utils"].decode_range(t["!ref"]);let a;const i=s.s.r+this.skinRow;for(a=s.s.c;a<=s.e.c;++a){const s=t[o["utils"].encode_cell({c:a,r:i})];let n=" ";s&&s.t&&(n=o["utils"].format_cell(s)),e.push(n)}return e},isExcel(t){return/\.(xlsx|xls|csv)$/.test(t.name)}}},l=n,r=(s("566b"),s("2877")),c=Object(r["a"])(l,a,i,!1,null,"a5ed51f2",null);e["a"]=c.exports},"3d4e":function(t,e,s){"use strict";s("dcfc")},4342:function(t,e,s){},"566b":function(t,e,s){"use strict";s("c604")},"64f8":function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("el-button",{attrs:{type:"default",icon:"el-icon-tickets",loading:t.dataLoading},on:{click:t.generate}},[t.dataLoading?s("span",[t._v("正在导出("+t._s(t.dataProgress?t.dataProgress+"%":"...")+")")]):s("span",[t._v("导出")])])},i=[],o=(s("3c5d"),s("a1b8")),n={name:"DownloadExcel",props:{type:{type:String,default:"xls"},data:{type:Array,required:!1,default:null},fields:{type:Object,default:()=>null},exportFields:{type:Object,default:()=>null},defaultValue:{type:String,required:!1,default:""},header:{default:null},footer:{default:null},name:{type:String,default:"data.xls"},fetch:{type:Function},progress:{type:Number,default:0},meta:{type:Array,default:()=>[]},worksheet:{type:String,default:"Sheet1"},beforeGenerate:{type:Function},beforeFinish:{type:Function},escapeCsv:{type:Boolean,default:!0},stringifyLongNum:{type:Boolean,default:!1}},data(){return{dataLoading:!1,dataProgress:0}},computed:{idName(){var t=(new Date).getTime();return"export_"+t},downloadFields(){return this.fields?this.fields:this.exportFields?this.exportFields:void 0}},watch:{progress:{immediate:!0,handler(t,e){e!=t&&(this.dataProgress=t)}}},methods:{async generate(){if(this.dataLoading)return;this.dataLoading=!0,"function"===typeof this.beforeGenerate&&await this.beforeGenerate();let t=this.data;if("function"!==typeof this.fetch&&t||(t=await this.fetch()),setTimeout(()=>{this.dataProgress=0,this.dataLoading=!1},300),!t||!t.length)return;const e=this.getProcessedJson(t,this.downloadFields);return"html"===this.type?this.export(this.jsonToXLS(e),this.name.replace(".xls",".html"),"text/html"):"csv"===this.type?this.export(this.jsonToCSV(e),this.name.replace(".xls",".csv"),"application/csv"):this.export(this.jsonToXLS(e),this.name,"application/vnd.ms-excel")},export:async function(t,e,s){const a=this.base64ToBlob(t,s);"function"===typeof this.beforeFinish&&await this.beforeFinish(),Object(o["a"])(a,e,s)},jsonToXLS(t){const e='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><meta name=ProgId content=Excel.Sheet> <meta name=Generator content="Microsoft Excel 11"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">\x3c!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>${worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--\x3e<style>br {mso-data-placement: same-cell;}</style></head><body><table>${table}</table></body></html>';let s="<thead>";const a=Object.keys(t[0]).length,i=this,o=this.header||this.$attrs.title;o&&(s+=this.parseExtraData(o,'<tr><th colspan="'+a+'">${data}</th></tr>')),s+="<tr>";for(const n in t[0])s+="<th>"+n+"</th>";return s+="</tr>",s+="</thead>",s+="<tbody>",t.map((function(t,e){s+="<tr>";for(const a in t)s+="<td>"+i.preprocessLongNum(i.valueReformattedForMultilines(t[a]))+"</td>";s+="</tr>"})),s+="</tbody>",null!=this.footer&&(s+="<tfoot>",s+=this.parseExtraData(this.footer,'<tr><td colspan="'+a+'">${data}</td></tr>'),s+="</tfoot>"),e.replace("${table}",s).replace("${worksheet}",this.worksheet)},jsonToCSV(t){const e=this;var s=[];const a=this.header||this.$attrs.title;a&&s.push(this.parseExtraData(a,"${data}\r\n"));for(const i in t[0])s.push(i),s.push(",");return s.pop(),s.push("\r\n"),t.map((function(t){for(const a in t){let i=t[a]+"";e.escapeCsv&&(i='="'+i+'"',i.match(/[,"\n]/)&&(i='"'+i.replace(/\"/g,'""')+'"')),s.push(i),s.push(",")}s.pop(),s.push("\r\n")})),null!=this.footer&&s.push(this.parseExtraData(this.footer,"${data}\r\n")),s.join("")},getProcessedJson(t,e){const s=this.getKeys(t,e),a=[],i=this;return t.map((function(t,e){const o={};for(const a in s){const e=s[a];o[a]=i.getValue(e,t)}a.push(o)})),a},getKeys(t,e){if(e)return e;const s={};for(const a in t[0])s[a]=a;return s},parseExtraData(t,e){let s="";if(Array.isArray(t))for(var a=0;a<t.length;a++)t[a]&&(s+=e.replace("${data}",t[a]));else s+=e.replace("${data}",t);return s},getValue(t,e){const s="object"!==typeof t?t:t.field,a="string"!==typeof s?[]:s.split(".");let i=this.defaultValue;return i=s?a.length>1?this.getValueFromNestedItem(e,a):this.parseValue(e[s]):e,t.hasOwnProperty("callback")&&(i=this.getValueFromCallback(i,t.callback)),i},valueReformattedForMultilines(t){return"string"===typeof t?t.replace(/\n/gi,"<br/>"):t},preprocessLongNum(t){if(this.stringifyLongNum){if(String(t).startsWith("0x"))return t;if(!isNaN(t)&&""!=t&&(t>99999999999||t<1e-13))return'="'+t+'"'}return t},getValueFromNestedItem(t,e){let s=t;for(const a of e)s&&(s=s[a]);return this.parseValue(s)},getValueFromCallback(t,e){if("function"!==typeof e)return this.defaultValue;const s=e(t);return this.parseValue(s)},parseValue(t){return t||0===t||"boolean"===typeof t?t:this.defaultValue},base64ToBlob(t,e){const s=window.btoa(window.unescape(encodeURIComponent(t))),a=atob(s);let i=a.length;const o=new Uint8ClampedArray(i);while(i--)o[i]=a.charCodeAt(i);return new Blob([o],{type:e})}}},l=n,r=(s("3d4e"),s("2877")),c=Object(r["a"])(l,a,i,!1,null,null,null);e["a"]=c.exports},"77af":function(t,e,s){"use strict";s("d5e1")},b122:function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("el-dialog",{attrs:{title:"选择商品",visible:t.dialogVisible,top:"2vh",width:"75%","before-close":t.close,"append-to-body":"","custom-class":"goodsSelectDialog"},on:{"update:visible":function(e){t.dialogVisible=e}}},[s("div",{staticClass:"dialog-warpper"},[s("div",{staticClass:"dflex-b padding-bottom-sm"},[s("div"),s("div",{staticClass:"dflex"},[s("el-input",{staticStyle:{width:"360px"},attrs:{"prefix-icon":"el-icon-search",clearable:"",placeholder:"输入商品名称、编号按回车键搜索"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.fetchDataList(e)}},model:{value:t.reqData.keyword,callback:function(e){t.$set(t.reqData,"keyword",e)},expression:"reqData.keyword"}},[s("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:t.handleSearch},slot:"append"})],1)],1)]),s("div",{staticClass:"dflex-s"},[s("div",{staticClass:"category"},[s("div",{staticClass:"title-box dflex-b"},[s("div",{staticClass:"padding"},[t._v("商品分类")])]),s("div",{staticClass:"cate-list"},[s("div",{staticClass:"item padding-sm",class:{active:""==t.reqData.cid},on:{click:function(e){return t.changeCategory()}}},[s("span",[t._v("全部分类")])]),t._l(t.categoryList,(function(e,a){return s("div",{key:e._id,staticClass:"item padding-sm",class:{active:t.reqData.cid==e._id},on:{click:function(s){return t.changeCategory(e)}}},[s("span",[t._v(t._s(e.name))])])}))],2)]),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.dataLoading,expression:"dataLoading"}],staticClass:"tablex",attrs:{data:t.dataList,border:"",fit:"",stripe:""}},[s("el-table-column",{attrs:{type:"index",width:"55",align:"center",fixed:"",label:"序号"}}),s("el-table-column",{attrs:{width:"100",align:"center",label:"数量",fixed:"",prop:"code"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("div",{class:{"is-active":e.row.goods_cnt>0}},[s("el-input",{key:e.row.goods_id,staticClass:"tac",attrs:{oninput:"value=value.match(/^-?\\d+(?:\\.\\d{0,2})?/)",placeholder:"数量"},on:{focus:function(s){return t.handleItemNumberFocus(e.row,e.$index)},change:function(s){return t.handleItemNumberChange(e.row,e.$index)}},model:{value:e.row.goods_cnt,callback:function(s){t.$set(e.row,"goods_cnt",s)},expression:"scope.row.goods_cnt"}})],1)]}}])}),s("el-table-column",{attrs:{"min-width":"230",align:"left",label:"商品名称",fixed:"","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){return[s("div",{staticClass:"dflex"},[s("div",{staticClass:"min-width:40px"},[s("el-avatar",{attrs:{shape:"square",size:40,fit:"cover",src:e.row.img||"/static/img/img-empty.png"}})],1),s("div",{staticClass:"padding-left-sm"},[s("div",[t._v(t._s(e.row.name))]),e.row.code?s("div",{staticClass:"ft-grey fs-xs"},[t._v("No."+t._s(e.row.code))]):t._e()])])]}}])}),s("el-table-column",{attrs:{"min-width":"160",align:"left",label:"规格属性",prop:"spec","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.spec_list&&e.row.spec_list.length>0?s("div",{},t._l(e.row.spec_list,(function(e,a){return s("div",{key:a,staticClass:"padding-right-sm"},[t._v(t._s(e.name)+"："+t._s(e.values.join("/")))])})),0):t._e(),s("div",[t._v(t._s(e.row.spec||""))])]}}])}),s("el-table-column",{attrs:{"min-width":"70",align:"center",label:"单位",prop:"unit"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.unit))]}}])}),s("el-table-column",{attrs:{"min-width":"100",align:"right",label:"批发价(元)"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("cent2yuan")(e.row.price)))]}}])}),s("el-table-column",{attrs:{"min-width":"100",align:"right",label:"零售价(元)"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("cent2yuan")(e.row.market_price)))]}}])}),s("el-table-column",{attrs:{"min-width":"100",align:"right",label:"可用库存"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.stock_num))]}}])})],1)],1)]),s("div",{staticClass:"dflex-b border-top padding-top-sm",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["goods-edit"],expression:"['goods-edit']"}],attrs:{type:"default",icon:"el-icon-plus"},on:{click:t.toAddGoodsPage}},[t._v("新增商品")]),s("el-pagination",{attrs:{background:"","page-size":t.pagination.pageSize,total:t.pagination.totalCount,"current-page":t.pagination.pageNo,"page-sizes":[10,15,20,30,50],layout:"total, prev, pager, next, sizes","hide-on-single-page":""},on:{"size-change":t.changePageSize,"current-change":t.changePageNo}}),s("div",[s("el-button",{on:{click:t.close}},[t._v("取 消")]),s("el-button",{attrs:{type:"primary"},on:{click:t.handleSubmit}},[t._v("确定提交")])],1)],1),s("AuxGoodsSkuDialog",{ref:"auxGoodsSkuDialog",attrs:{"enable-ok":"","main-price":t.mainPrice}})],1)},i=[],o=s("2197"),n=s("1ea0"),l=s("c031"),r={components:{AuxGoodsSkuDialog:n["a"]},props:{mainPrice:{type:String,default:"price"}},data(){return{dialogVisible:!1,cateParentId:"",categoryList:[...Object(l["c"])()],dataLoading:!1,dataList:[],pagination:{totalCount:1,pageSize:10,pageNo:1},reqData:{cid:"",keyword:""},selectedGoodsMap:{},selectedGoodsIds:[]}},methods:{open(){this.dialogVisible=!0,0==this.categoryList.length&&this.fetchCategory(),0==this.dataList.length?this.fetchDataList():this.dataList.forEach(t=>t.goods_cnt=""),this.selectedGoodsMap={},this.selectedGoodsIds=[]},close(){this.dialogVisible=!1},fetchCategory(){Object(o["a"])("goods/listGoodsCategory",{parentId:this.cateParentId},{functionName:"xunda"}).then(t=>{this.categoryList=t.data||[],Object(l["e"])(this.categoryList)})},fetchDataList(){this.dataLoading=!0;const t=Object.assign({},this.getReqData(),this.pagination);Object(o["a"])("goods/list",t,{functionName:"xunda"}).then(t=>{this.dataLoading=!1;const e=t.data||[];Object(l["f"])(e),this.dataList=e.map(t=>(t.goods_cnt=this.getCacheGoodsCount(t),t)),1===this.pagination.pageNo&&(this.pagination.totalCount=t.totalCount)})},getCacheGoodsCount(t){const e=this.selectedGoodsMap[t.goods_id]||[];return e.length>0?e[0].goods_cnt:""},addSelected(t){this.selectedGoodsMap[t.goods_id]||(this.selectedGoodsMap[t.goods_id]=[]),this.selectedGoodsMap[t.goods_id].push(t),this.selectedGoodsIds=Object.keys(this.selectedGoodsMap)},removeSelected(t){delete this.selectedGoodsMap[t],this.selectedGoodsIds=Object.keys(this.selectedGoodsMap)},handleItemNumberChange(t,e){const s=Number(t.goods_cnt);if(0===s)return void this.removeSelected(t.goods_id);const a=this.selectedGoodsMap[t.goods_id]||[];if(0==a.length){const e=Object.assign({},t);e.name=t.name,e.img=t.img,e.sku_id="",e.remark="",e.goods_cnt=s,this.addSelected(e)}else a.forEach(t=>t.goods_cnt=s)},handleItemNumberFocus(t){if(t.goods_cnt>0)return;if(!t.spec_list||0===t.spec_list.length)return;const e=Object(l["b"])(t.goods_id);this.$refs.auxGoodsSkuDialog.open({goods:e,confirm:s=>{s.map(t=>{const s=Object.assign({},t);return s._id=e._id,s.name=e.name,s.img=e.img,s.sku_id=t.sku_id,s.unit=t.unit,s.spec=t.spec,s.price=t.price,s.bid_price=t.bid_price,s.market_price=t.market_price,s.min_price=t.min_price,s.scale=t.scale,s.goods_id=e._id,s.goods_cnt=1,s}).forEach(t=>this.addSelected(t)),t.goods_cnt=1}})},getGoodsUnitSelectOptions(t){const e=t.unit_list||[];if(e.length>0){const s=e[0],a=[{label:"基本单位",children:[s]}],i=t.unit_list.filter(t=>t.unit!==s.unit);return i.length>0&&a.push({label:"辅助单位",children:i}),a}},getReqData(){return Object.assign({showStock:!0},this.reqData)},handleSearch(){this.fetchDataList()},changePageNo(t){this.pagination.pageNo=t,this.fetchDataList()},changePageSize(t){this.pagination.pageNo=1,this.pagination.pageSize=t,this.fetchDataList()},changeCategory(t){this.reqData.cid=t?t._id:"",this.pagination.pageNo=1,this.fetchDataList()},handleSubmit(){const t=[];this.selectedGoodsIds.forEach(e=>{t.push(...this.selectedGoodsMap[e])}),this.$emit("onSuccess",t),this.close()},toAddGoodsPage(){this.close(),this.$common.toPage("/goods/goods-create")}}},c=r,d=(s("77af"),s("2877")),u=Object(d["a"])(c,a,i,!1,null,null,null);e["a"]=u.exports},b866:function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"w-full"},[s("el-select",{staticClass:"w-full",attrs:{filterable:"",placeholder:"请选择成员",clearable:!0,multiple:t.multi},on:{change:t.change,focus:t.initLoad},model:{value:t.modelValue,callback:function(e){t.modelValue=e},expression:"modelValue"}},t._l(t.dataList,(function(t){return s("el-option",{key:t.value,attrs:{label:t.name,value:t.value}})})),1)],1)},i=[],o=s("2197"),n={name:"AuxSelectMember",props:{value:{type:[String,Array],default:()=>[]},multi:Boolean},data(){return{dataList:[],modelValue:[]}},watch:{value:{handler(t,e){this.modelValue=t,0===this.dataList.length&&t&&this.fetchData(t)},immediate:!0}},methods:{initLoad(){0===this.dataList.length&&this.fetchData()},fetchData(){Object(o["a"])("member/listMember",{pageSize:100,simple:!0},{functionName:"xunda"}).then(t=>{const e=(t.data||[]).map(t=>(t.name=t.member_name,t.value=t._id,t));this.dataList=e})},change(){this.$nextTick(()=>{if(this.$emit("input",this.modelValue),!this.multi){const t=this.dataList.filter(t=>t._id==this.modelValue);t.length>0&&this.$emit("change",t[0])}})}}},l=n,r=s("2877"),c=Object(r["a"])(l,a,i,!1,null,null,null);e["a"]=c.exports},c058:function(t,e,s){},c3dd:function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"w-full"},[s("el-select",{staticClass:"w-full",attrs:{filterable:"",placeholder:"请选择商品仓库",clearable:!0,multiple:t.multi,loading:t.loading},on:{change:t.change,focus:t.initLoad},model:{value:t.modelValue,callback:function(e){t.modelValue=e},expression:"modelValue"}},t._l(t.dataList,(function(t){return s("el-option",{key:t.value,attrs:{label:t.name,value:t.value}})})),1)],1)},i=[],o=s("2197"),n={name:"AuxSelectWarehouse",props:{value:{type:[String,Array],default:()=>[]},multi:Boolean},data(){return{loading:!1,dataList:[],modelValue:[]}},methods:{initLoad(){0===this.dataList.length&&this.fetchData()},fetchData(){Object(o["a"])("stock/listWarehouse",{pageSize:20,simple:!0},{functionName:"xunda"}).then(t=>{this.dataList=(t.data||[]).map(t=>(t.text=t.name,t.value=t._id,t))})},change(){this.$nextTick(()=>{this.$emit("input",this.modelValue),this.$emit("change",this.modelValue)})}}},l=n,r=s("2877"),c=Object(r["a"])(l,a,i,!1,null,null,null);e["a"]=c.exports},c604:function(t,e,s){},d262:function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("el-select",{staticClass:"w-full",attrs:{filterable:"",placeholder:"输入供应商名称/联系人/电话查询",clearable:!0},on:{change:t.change,focus:t.initLoad},model:{value:t.modelValue,callback:function(e){t.modelValue=e},expression:"modelValue"}},t._l(t.dataList,(function(t){return s("el-option",{key:t._id,attrs:{label:t.name,value:t._id}})})),1)},i=[],o=s("2197"),n={name:"AuxSelectSupplier",props:{value:{type:[String,Array],default:()=>""},multi:Boolean},data(){return{loading:!1,dataList:[],modelValue:""}},watch:{value:{handler(t,e){this.modelValue=t,0===this.dataList.length&&t&&this.fetchData()},immediate:!0}},methods:{initLoad(){this.fetchData()},fetchData(t=""){Object(o["a"])("supplier/listSupplier",{pageSize:12,simple:!0,keyword:t},{functionName:"xunda"}).then(t=>{this.loading=!1,this.dataList=t.data||[]})},change(){this.$nextTick(()=>{if(this.$emit("input",this.modelValue),!this.multi){const t=this.dataList.filter(t=>t._id==this.modelValue);t.length>0&&this.$emit("change",t[0])}})}}},l=n,r=s("2877"),c=Object(r["a"])(l,a,i,!1,null,null,null);e["a"]=c.exports},d5e1:function(t,e,s){},dcfc:function(t,e,s){},f455:function(t,e,s){"use strict";s("c058")},f63d:function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("el-cascader",{staticClass:"w-full",attrs:{options:t.treeList,props:{expandTrigger:"hover"},clearable:"",placeholder:"选择查询区域"},on:{change:t.change,focus:t.initLoad},model:{value:t.modelValue,callback:function(e){t.modelValue=e},expression:"modelValue"}})},i=[],o=s("2197"),n={name:"AuxPickerArea",props:{value:{type:Array,default:()=>[]}},data(){return{dataList:[],treeList:[],modelValue:[]}},watch:{value:{handler(t,e){this.modelValue=t,this.fetchData()},immediate:!0}},methods:{initLoad(){0===this.dataList.length&&this.fetchData()},fetchData(){Object(o["a"])("area/listAreaAll",{},{functionName:"xunda"}).then(t=>{const e=(t.data||[]).map(t=>(t.label=t.name,t.value=t._id,t));this.dataList=e,this.treeList=this.buildTree(e,"")})},buildTree(t,e){const s=t.filter(t=>e==t.parent_id).map(t=>Object.assign({},t));return s.forEach(e=>{const s=this.buildTree(t,e._id);s&&s.length>0&&(e.children=s)}),s},change(t){this.$nextTick(()=>{this.$emit("input",t);const e=this.dataList.filter(e=>t.includes(e.value));this.$emit("change",e)})}}},l=n,r=s("2877"),c=Object(r["a"])(l,a,i,!1,null,null,null);e["a"]=c.exports}}]);